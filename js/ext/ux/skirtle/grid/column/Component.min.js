/*!
 * Component Column
 * Version 1.1
 * Copyright(c) 2011-2013 Skirtle's Den
 * License: http://skirtlesden.com/ux/component-column
 */Ext.define("Skirtle.grid.column.Component",{alternateClassName:"Ext.ux.skirtle.grid.column.Component",alias:"widget.componentcolumn",extend:"Ext.grid.column.Column",requires:["Skirtle.CTemplate"],autoWidthComponents:!0,componentGC:!0,hasCustomRenderer:!0,lastFrameWidth:12,widthUpdateDelay:[10,400],constructor:function(e){var t=this;t.callParent(arguments);t.compIds=[];t.dataIndex=t.dataIndex||Ext.id(null,"cc-dataIndex-");t.tpl=t.createTemplate(t.tpl);t.renderer=t.createRenderer(t.renderer);t.registerColumnListeners()},addRefOwner:function(e){var t=this,n=t.refOwnerFn||(t.refOwnerFn=function(){return t});t.extVersion<40200?e.getBubbleTarget=n:e.getRefOwner=n},applyTemplate:function(e,t){Ext.isDefined(t)&&(e[this.dataIndex]=t);return this.tpl.apply(e)},beforeViewRefresh:function(){if(Ext.isIE){var e=this.compIds,t=0,n=e.length,r,i,s;for(;t<n;t++)(r=Ext.getCmp(e[t]))&&(i=r.getEl())&&(i=i.dom)&&(s=i.parentNode)&&s.removeChild(i)}},calculateFrameWidth:function(e){var t=e.getEl(),n=t&&t.parent(),r=n&&n.parent();if(r)return this.lastFrameWidth=n.getFrameWidth("lr")+r.getFrameWidth("lr")},createRenderer:function(e){var t=this;return function(n,r,i){var s=Ext.apply({},i.data,i.getAssociatedData());e&&(n=e.apply(this,arguments));n=t.processValue(n);return t.applyTemplate(s,n)}},createTemplate:function(e){return e&&e.isTemplate?e:Ext.create("Skirtle.CTemplate",e||["{",this.dataIndex,"}"])},destroyChild:function(e){e.destroy()},getRefItems:function(e){var t=this.callParent([e]),n=this.compIds,r=0,i=n.length,s;for(;r<i;r++)if(s=Ext.getCmp(n[r])){t.push(s);e&&s.getRefItems&&t.push.apply(t,s.getRefItems(!0))}return t},onChildAfterRender:function(e){this.resizeChild(e)},onChildBoxReady:function(e){this.resizeChild(e,!1)},onChildDestroy:function(e){Ext.Array.remove(this.compIds,e.getId())},onChildResize:function(){this.redoScrollbars()},onColumnResize:function(e){e.resizeAll()},onColumnShow:function(e){e.resizeAll()},onColumnVisibilityChange:function(e){var t=e.getRefItems(),n=0,r=t.length,i=!e.isHidden();Ext.suspendLayouts&&Ext.suspendLayouts();for(;n<r;++n)t[n].setVisible(i);Ext.resumeLayouts&&Ext.resumeLayouts(!0)},onDestroy:function(){Ext.destroy(this.getRefItems());this.callParent()},onRender:function(){this.registerViewListeners();this.callParent(arguments)},onViewChange:function(){var e=this,t=e.tpl;e.suspendResizing();if(t.isCTemplate){t.injectComponents();t.reset()}e.redoScrollbars();e.resumeResizing();e.performGC()},performGC:function(){var e=this.compIds,t=e.length-1,n,r;for(;t>=0;--t){n=Ext.getCmp(e[t]);r=n&&n.getEl();(!r||this.componentGC&&(!r.dom||Ext.getDom(Ext.id(r))!==r.dom))&&n&&!n.isDestroyed&&n.destroy()}},processValue:function(e){var t=this,n=t.compIds,r,i,s,o;Ext.isObject(e)&&!e.isComponent&&e.xtype&&(e=Ext.widget(e.xtype,e));if(e&&e.isComponent){r=e.getId();Ext.Array.contains(n,r)||n.push(r);t.addRefOwner(e);t.registerListeners(e);if(e.rendered){if(Ext.isIE){s=e.el.dom;o=s.parentNode;if(o){t.extVersion===40101&&Ext.core.DomHelper.insertBefore(s,{tag:"p"});o.removeChild(s)}}}else if(t.autoWidthComponents){i=t.getWidth()-t.lastFrameWidth;i=i>4?i:4;e.setWidth(i)}(Ext.isIE6||Ext.isIE7)&&t.isHidden()&&e.hide()}return e},redoScrollbars:function(){var e=this,t=e.up("tablepanel");if(t){if(e.resizeQueue){e.redoScrollbarsRequired=!0;return}if(e.extVersion<40100){t.invalidateScroller();t.determineScrollbars()}else t.doLayout()}},registerColumnListeners:function(){var e=this;if(e.autoWidthComponents){e.on("resize",e.onColumnResize);e.on("show",e.onColumnShow)}(Ext.isIE6||Ext.isIE7)&&e.on({hide:e.onColumnVisibilityChange,show:e.onColumnVisibilityChange})},registerListeners:function(e){var t=this;e.on("destroy",t.onChildDestroy,t);if(t.autoWidthComponents){e.on("afterrender",t.onChildAfterRender,t,{single:!0});!t.extVersion<40100&&e.on("boxready",t.onChildBoxReady,t,{single:!0})}e.on("resize",t.onChildResize,t)},registerViewListeners:function(){var e=this,t=e.up("tablepanel").getView();e.mon(t,"beforerefresh",e.beforeViewRefresh,e);e.mon(t,"refresh",e.onViewChange,e);e.mon(t,"itemupdate",e.onViewChange,e);e.mon(t,"itemadd",e.onViewChange,e);e.mon(t,"itemremove",e.onViewChange,e)},resizeAll:function(){var e=this;e.suspendResizing();e.resizeQueue=e.getRefItems();e.resumeResizing()},resizeChild:function(e,t){var n=this,r,i,s,o;if(n.resizingSuspended){o=n.resizeQueue;Ext.Array.contains(o,e)||o.push(e);return}r=n.calculateFrameWidth(e);if(Ext.isNumber(r)){i=n.getWidth()-r;s=e.getWidth();n.setChildWidth(e,i,s)&&t!==!1&&Ext.each(n.widthUpdateDelay,function(t){Ext.defer(n.resizeChild,t,n,[e,!1])})}},resumeResizing:function(){var e=this,t=0,n=e.resizeQueue,r=n.length;if(!--e.resizingSuspended){for(;t<r;++t)e.resizeChild(n[t]);e.resizeQueue=null;e.redoScrollbarsRequired&&e.redoScrollbars()}},setChildWidth:function(e,t,n){if(n===t)return!1;e.setWidth(t);return!0},suspendResizing:function(){var e=this;e.resizingSuspended=(e.resizingSuspended||0)+1;e.resizeQueue||(e.resizeQueue=[])}},function(e){var t=e.prototype,n=Ext.getVersion();t.extVersion=(n.getMajor()*100+n.getMinor())*100+n.getPatch();Ext.Element.prototype.syncContent&&n.toString()==="4.1.0"&&(t.extVersion=40101)});