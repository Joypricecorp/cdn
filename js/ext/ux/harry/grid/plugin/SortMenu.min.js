/**
 * @class Ext.ux.grid.plugin.SortMenu
 * @extends Ext.button.Button
 * 
 * @author Harald Hanek (c) 2011-2012
 * @license http://harrydeluxe.mit-license.org
 */Ext.define("Ext.ux.grid.plugin.SortMenu",{extend:"Ext.button.Button",uses:["Ext.menu.Menu"],alias:"plugin.ux.sortmenu",sortAscText:null,sortDescText:null,tplText:"Sort by {0}",sortState:"ASC",sortBtn:null,changed:!0,initComponent:function(){var e=this;e.groupid=Ext.id(e);e.sortmenu=Ext.create("Ext.menu.Menu",{items:[{text:""}]});e.sortmenu.on("beforeshow",e.createMenu,e);Ext.apply(e,{menu:e.sortmenu});e.callParent(arguments)},init:function(e){var t=this;t.grid=e;t.grid.on("afterlayout",t.onGridRender,t,{single:!0})},changeState:function(e,t){var n=this;n.changed=!0;t.sortState!==null&&t.text!=n.text&&n.setText(Ext.String.format(n.tplText,t.text||""))},onGridRender:function(e){var t=this;t.mon(t.grid.view.headerCt,"columnmove",t.changeState,t);t.mon(t.grid.view.headerCt,"sortchange",t.changeState,t);t.grid.view.headerCt.items.each(function(e){if(e.sortable&&e.getSortParam()&&e.sortState!==null){t.sortBtn=e;t.setText(Ext.String.format(t.tplText,e.text||""))}},t)},createMenu:function(){var e=this;if(!e.changed)return!0;e.sortmenu.removeAll();e.grid.view.headerCt.items.each(function(t){if(t.sortable&&t.getSortParam()){if(t.sortState!==null){e.sortBtn=t;e.sortState=t.sortState;e.setText(Ext.String.format(e.tplText,t.text))}e.sortmenu.add({text:t.text,group:"sortproperty_"+e.groupid,handler:function(){e.sortBtn=t;t.setSortState(e.sortState)},checked:t.sortState!==null,scope:e})}},e);e.sortmenu.add([{xtype:"menuseparator"},{text:e.sortAscText||e.grid.view.headerCt.sortAscText,checked:e.sortState=="ASC"?!0:!1,group:"sortdirection_"+e.groupid,handler:e.setSortDirection,scope:e,sortDirection:"ASC"},{text:e.sortDescText||e.grid.view.headerCt.sortDescText,checked:e.sortState=="DESC"?!0:!1,group:"sortdirection_"+e.groupid,handler:e.setSortDirection,scope:e,sortDirection:"DESC"}]);e.changed=!1},setSortDirection:function(e){var t=this;t.sortState=e.sortDirection;t.sortBtn.setSortState(t.sortState)}});