/**
 * @class Ext.app.PortalDropZone
 * @extends Ext.dd.DropTarget
 * Internal class that manages drag/drop for {@link Ext.app.PortalPanel}.
 */Ext.define("Ext.ux.Portal.DropZone",{extend:"Ext.dd.DropTarget",constructor:function(e,t){this.portal=e;Ext.dd.ScrollManager.register(e.body);Ext.ux.Portal.DropZone.superclass.constructor.call(this,e.body,t);e.body.ddScrollConfig=this.ddScrollConfig},ddScrollConfig:{vthresh:50,hthresh:-1,animate:!0,increment:200},createEvent:function(e,t,n,r,i,s){return{portal:this.portal,panel:n.panel,columnIndex:r,column:i,position:s,data:n,source:e,rawEvent:t,status:this.dropAllowed}},notifyOver:function(e,t,n){var r=t.getXY(),i=this.portal,s=e.proxy;this.grid||(this.grid=this.getGrid());var o=i.body.dom.clientWidth;if(!this.lastCW)this.lastCW=o;else if(this.lastCW!=o){this.lastCW=o;this.grid=this.getGrid()}var u=0,a=0,f=this.grid.columnX,l=f.length,c=!1;for(l;u<l;u++){a=f[u].x+f[u].w;if(r[0]<a){c=!0;break}}c||u--;var h,p=0,d=0,v=!1,m=i.items.getAt(u),g=m.items.items,y=!1;l=g.length;for(l;p<l;p++){h=g[p];d=h.el.getHeight();if(d===0)y=!0;else if(h.el.getY()+d/2>r[1]){v=!0;break}}p=(v&&h?p:m.items.getCount())+(y?-1:0);var b=this.createEvent(e,t,n,u,m,p);if(i.fireEvent("validatedrop",b)!==!1&&i.fireEvent("beforedragover",b)!==!1){s.getProxy().setWidth("auto");h?e.panelProxy.moveProxy(h.el.dom.parentNode,v?h.el.dom:null):e.panelProxy.moveProxy(m.el.dom,null);this.lastPos={c:m,col:u,p:y||v&&h?p:!1};this.scrollPos=i.body.getScroll();i.fireEvent("dragover",b);return b.status}return b.status},notifyOut:function(){delete this.grid},notifyDrop:function(e,t,n){delete this.grid;if(!this.lastPos)return;var r=this.lastPos.c,i=this.lastPos.col,s=this.lastPos.p,o=e.panel,u=this.createEvent(e,t,n,i,r,s!==!1?s:r.items.getCount());if(this.portal.fireEvent("validatedrop",u)!==!1&&this.portal.fireEvent("beforedrop",u)!==!1){Ext.suspendLayouts();o.el.dom.style.display="";e.panelProxy.hide();e.proxy.hide();s!==!1?r.insert(s,o):r.add(o);Ext.resumeLayouts(!0);this.portal.fireEvent("drop",u);var a=this.scrollPos.top;if(a){var f=this.portal.body.dom;setTimeout(function(){f.scrollTop=a},10)}}delete this.lastPos;return!0},getGrid:function(){var e=this.portal.body.getBox();e.columnX=[];this.portal.items.each(function(t){e.columnX.push({x:t.el.getX(),w:t.el.getWidth()})});return e},unreg:function(){Ext.dd.ScrollManager.unregister(this.portal.body);Ext.ux.Portal.DropZone.superclass.unreg.call(this)}});