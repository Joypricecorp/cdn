Ext.state.Manager.setProvider(new Ext.state.CookieProvider({expires:new Date((new Date).getTime()+6048e5)}));Ext.apply(Ext.tip.QuickTipManager.getQuickTip(),{showDelay:0});Ext.grid.RowEditor.prototype.cancelBtnText=_("ยกเลิก");Ext.grid.RowEditor.prototype.saveBtnText=_("บันทึก");Ext.apply(JP,{stk_cls_label:function(e){return e?e==5?_("ราคาต้นทุน"):JP.CDATA.cls[e]:"-"},isYes:function(e){return e===1||e==="1"||e==="y"||e==="Y"},filter:function(e,t,n){return new Ext.util.Filter({id:e,property:e,value:t,operator:n})},Money:function(e,t){var n=Ext.util.Format.number(e,t||"0,0.00");return JP.money(n)},TODO:function(e,t){var n=_("ข้อมูลนี้ยังไม่สมบูรณ์อยู่ระหว่างการดำเนินการ");t&&(n+="<br><b>ข้อมูลเบื้องต้น</b>: "+t);var r=function(){try{throw Error("")}catch(e){return e}}(),i=r.stack.split("\n")[4],s=i.split(":")[2];n+=Ext.String.format('<div class="src"><b>Source</b>: {0} <b>Line</b>: {1} <span class="file"><b>File</b>: {2}</span></div>',e.$className,s,i);Ext.Msg.show({title:"[TODO] อยู่ระหว่างการจัดทำ!",msg:n,modal:!1,cls:"x-todo-msg",icon:Ext.Msg.INFO,buttons:Ext.Msg.OK})},GHT:function(e,t,n){return"<span"+(n?' title="'+n+'"':"")+">"+e+'<span class="descr">'+(t||"&#160")+"</span>"+"</span>"},ICO:function(e){return"ico-"+e},ico:function(e,t){return JP.format("{0} ico-"+e,t||"")},tool:function(e){return"x-tool-img x-tool-"+e},icon:function(e,t){return t?JP.format("icon-scale-{0} icon-{1}",t,e):JP.format("icon-{0}",e)},iconText:function(e,t){return php.sprintf('<i class="icon-%s"></i>%s',e,t?t:"")},btn:function(e){e.setLoading=function(t){var n=$("span",e),r=$("i",e);r.data("cls")||r.data("cls",r.attr("class"));n.data("txt")||n.data("txt",n.html());t&&t!==!0&&n.html(t);t===!1&&n.html(n.data("txt"));r.attr("class",t?JP.icon("spin animate-spin"):r.data("cls"));$(e).attr("disabled",t)};return e},emptyMsg:function(e,t){return php.sprintf('<div class="x-empty x-empty-box"><div class="x-empty-title">%s</div><div class="x-empty-body">%s</div></div>',_(e),_(t))},Mask:function(){return JP.Loading},KeyClean:function(e){return e.replace(/[^a-zA-Z0-9]+/g,"")},THDate:function(e,t){var n=Ext.Date.format(e,"d/m/Y"),r=n.split("/"),i=parseInt(r[2]),s=/M/.test(t)?_("m"+r[1]):_("m_"+r[1]),o=" "+(/Y/.test(t)?i+543:i-2e3+43);return/h:i/i.test(t)?php.sprintf("%s %s%s %s:%s",r[0],s,o,Ext.Date.format(e,"H"),Ext.Date.format(e,"i")):php.sprintf("%s %s%s",r[0],s,o)},THDateRender:function(e,t,n,r,i,s,o){if(!e)return"";var u=this.headerCt.getHeaderAtIndex(i),a=u.format||"d/m/Y";return JP.THDate(e,a)},Ext:{ApplyItemToOwner:function(e,t){t.scope&&(t=t.scope);t.__proto__&&(t=t.__proto__);e.items.each(function(e,t){e.itemId&&(this[e.itemId]=e);e.menu&&JP.Ext.ApplyItemToOwner(e.menu,this);e.items&&JP.Ext.ApplyItemToOwner(e,this)},t)},RemoveWhenVer:function(e,t){if(Ext.Version.compare(Ext.versions.extjs.version,e)!=-1){cs.warn(php.sprintf("REMOVE ME!! This bug has fixed by %s.",e));t&&cs.log(t)}}},store:function(e){return Ext.widget("jp-store-common",e)}});var ExtFormFailure=function(e,t){Ext.Msg.setIcon(Ext.MessageBox.ERROR);switch(t.failureType){case Ext.form.Action.CLIENT_INVALID:Ext.Msg.alert("Failure","Form fields may not be submitted with invalid values");break;case Ext.form.Action.CONNECT_FAILURE:Ext.Msg.alert("Failure","Ajax communication failed");break;case Ext.form.Action.SERVER_INVALID:Ext.Msg.alert("Failure",t.result.msg||"An error has occurred. try agian later.")}};Ext.override(Ext.data.proxy.Server,{encodeFilters:function(e){var t=[],n=e.length,r=0;for(;r<n;r++)t[r]={property:e[r].property,operator:e[r].operator,value:e[r].value};return this.applyEncoding(t)}});Ext.define("Ext.AbstractComponent",{override:"Ext.AbstractComponent",one:function(e,t,n,r){return this.on(e,t,n,Ext.apply({single:!0},r||{}))}});Ext.define("Ext.toolbar.Paging",{override:"Ext.toolbar.Paging",border:!0,displayInfo:!0,displayMsg:"รายการที่ {0} - {1} จาก {2}",emptyMsg:"ไม่มีข้อมูล",dock:"bottom",getPagingItems:function(){var e=this;return[{itemId:"first",tooltip:e.firstText,overflowText:e.firstText,cls:Ext.baseCSSPrefix+"btn-tool",iconCls:"icon-to-start",disabled:!0,handler:e.moveFirst,scope:e},{itemId:"prev",tooltip:e.prevText,overflowText:e.prevText,cls:Ext.baseCSSPrefix+"btn-tool",iconCls:"icon-left-dir-1",disabled:!0,handler:e.movePrevious,scope:e},"-",e.beforePageText,{xtype:"numberfield",itemId:"inputItem",name:"inputItem",cls:Ext.baseCSSPrefix+"tbar-page-number",allowDecimals:!1,minValue:1,hideTrigger:!0,enableKeyEvents:!0,keyNavEnabled:!1,selectOnFocus:!0,submitValue:!1,isFormField:!1,width:e.inputItemWidth,margins:"-1 2 3 2",listeners:{scope:e,keydown:e.onPagingKeyDown,blur:e.onPagingBlur}},{xtype:"tbtext",itemId:"afterTextItem",text:Ext.String.format(e.afterPageText,1)},"-",{itemId:"next",tooltip:e.nextText,overflowText:e.nextText,cls:Ext.baseCSSPrefix+"btn-tool",iconCls:"icon-right-dir-1",disabled:!0,handler:e.moveNext,scope:e},{itemId:"last",tooltip:e.lastText,overflowText:e.lastText,cls:Ext.baseCSSPrefix+"btn-tool",iconCls:"icon-to-end",disabled:!0,handler:e.moveLast,scope:e},"-",{itemId:"refresh",tooltip:e.refreshText,overflowText:e.refreshText,cls:Ext.baseCSSPrefix+"btn-tool",iconCls:"icon-spin3",handler:e.doRefresh,scope:e}]}});Ext.define("Ext.menu.Menu",{override:"Ext.menu.Menu",offsets:[0,4],shadow:!1,showBy:function(e,t,n){var r=this,i;n==i&&(n=this.offsets);r.callParent([e,t,n]);r.hidden||r.setVerticalPosition();return r}});Ext.define("Ext.menu.xItem",{extend:"Ext.menu.Item",alias:"widget.xmenuitem",renderTpl:['<tpl if="plain">',"{text}","<tpl else>",'<a id="{id}-itemEl" class="'+Ext.baseCSSPrefix+"menu-item-link "+Ext.baseCSSPrefix+'menu-xitem-link" href="{href}" <tpl if="hrefTarget">target="{hrefTarget}"</tpl> hidefocus="true" unselectable="on">','<span id="{id}-textEl" class="'+Ext.baseCSSPrefix+'menu-item-text" <tpl if="arrowCls">style="margin-right: 17px;"</tpl> >{text}</span>','<img id="{id}-arrowEl" src="{blank}" class="{arrowCls}" />',"</a>","</tpl>"]});Ext.define("JP.Ext.toolbar.Toolbar",{extend:"Ext.toolbar.Toolbar",alias:"widget.jp-toolbar",afterRender:function(){this.callParent(arguments);var e=this.scope||this.topOwner||this.ownerCt;JP.Ext.ApplyItemToOwner(this,e)}});Ext.define("Ext.button.Button",{override:"Ext.button.Button",oldIconCls:null,enableSelection:null,_enableSelection:{type:null,nums:null,fn:null,isEnable:function(e,t){return t.length&&e.isDisabled()?!0:!t.length&&!e.isDisabled()?!1:null},isEnableByNums:function(e,t){return t.length==this.nums&&e.isDisabled()?!0:t.length!=this.nums&&!e.isDisabled()?!1:null},isEnableByFn:function(e,t,n,r){return this.fn.call(e,t,n,r)}},initComponent:function(){var e=this;e.callParent(arguments);if(!e.enableSelection)return;e.on("afterrender",function(){var t=e.up("panel");if(!(t instanceof Ext.grid.Panel))return;if(Ext.isNumber(e.enableSelection)&&e.enableSelection>0){e._enableSelection.type=1;e._enableSelection.nums=e.enableSelection}else if(Ext.isFunction(e.enableSelection)){e._enableSelection.type=2;e._enableSelection.fn=e.enableSelection}else if(Ext.isObject(e.enableSelection)){Ext.isNumber(e.enableSelection.nums)&&e.enableSelection.nums>0&&(e._enableSelection.nums=e.enableSelection.nums);Ext.isFunction(e.enableSelection.fn)&&(e._enableSelection.fn=e.enableSelection.fn);e._enableSelection.nums&&e._enableSelection.fn?e._enableSelection.type=3:e._enableSelection.nums?e._enableSelection.type=1:e._enableSelection.fn&&(e._enableSelection.type=2)}e.setDisabled(!0);t.on("selectionchange",e.onGridSelectionChange(),e)})},onGridSelectionChange:function(){var e=this,t=e._enableSelection;switch(t.type){case 1:return function(n,r,i){(isEnableByNums=t.isEnableByNums(e,r))!=null&&e.setDisabled(isEnableByNums?!1:!0)};case 2:return function(n,r,i){(isEnable=t.isEnable(e,r))!=null&&(isEnableByFn=t.isEnableByFn(e,r))!=null&&e.setDisabled(isEnable&&isEnableByFn?!1:!0)};case 3:return function(n,r,i){(isEnableByNums=t.isEnableByNums(e,r))!=null&&(isEnableByFn=t.isEnableByFn(e,n,r,i))!=null&&e.setDisabled(isEnableByNums&&isEnableByFn?!1:!0)};default:return function(n,r,i){(isEnable=t.isEnable(e,r))!=null&&e.setDisabled(isEnable?!1:!0)}}},setLoading:function(e,t,n){var r;JP.setMask(!e);var i=function(e){e.oldIconCls=e.iconCls;e.setIconCls(JP.icon("spin animate-spin"))};this.setDisabled(!!e);if(e){i(this);typeof e=="function"&&Ext.Function.defer(e,n?200:0,t||this,[this])}else this.setIconCls(this.oldIconCls)},loading:function(e){this.setLoading(e)}});Ext.define("Ext.dom.Element",{override:"Ext.dom.Element",setDisabled:function(e){e?this.set({disabled:"disabled"}):this.dom.removeAttribute("disabled")}});Ext.define("JP.Ext.form.field.Combo",{extend:"Ext.form.field.ComboBox",displayField:"text",valueField:"value",alias:"widget.jp-combo",loadValue:!0,loadValue_:null,expandOnFocus:!1,initComponent:function(){this.callParent(arguments);this.loadValue&&this.store&&this.getStore().on("load",function(){this.setValue(this.loadValue_)},this);this.expandOnFocus&&this.on("focus",function(){this.expand()},this)},setValue:function(e,t){this.loadValue_=e;this.callParent(arguments)}});Ext.define("JP.Ext.form.field.ComboBox",{extend:"JP.Ext.form.field.Combo",displayField:"def_text",valueField:"def_value",alias:"widget.jp-combobox"});Ext.define("JP.Ext.form.field.NComboBox",{extend:"JP.Ext.form.field.ComboBox",alias:"widget.ncombo",displayField:"text",valueField:"value",tpl:Ext.create("Ext.XTemplate","<ul>",'<tpl for=".">','<tpl if="value">','<li role="option" class="x-boundlist-item">{text}</li>',"<tpl else>",'<li role="option" class="x-boundlist-item x-boundlist-item-new">{text}</li>',"</tpl>","</tpl>","</ul>")});Ext.define("Ext.panel.Panel",{override:"Ext.panel.Panel",setLoading:function(e,t){JP.setMask(!e);e==1&&(e={floating:{shadow:!1}});return this.callParent([e,t])}});Ext.define("JP.Ext.panel.Panel.Detail",{extend:"Ext.panel.Panel",alias:"widget.panel-detail",hideCollapseTool:!0,collapsed:!0,collapsible:!1,titleCollapse:!1,floatable:!1,animCollapse:!1,autoScroll:!0,header:!1,border:!0,initComponent:function(){this.callParent(arguments);this.on("beforeexpand",function(e){e.splitter.show();e.show()});this.on("collapse",function(e){e.splitter.hide();e.hide()})}});Ext.define("Ext.picker.Date",{override:"Ext.picker.Date",shadow:!1});Ext.define("Ext.form.field.Date",{override:"Ext.form.field.Date",pickerOffset:[0,3]});Ext.define("JP.Ext.data.model.Factory",{alias:"widget.jp-model-factory",constructor:function(e){e.url&&Ext.Ajax.request({url:e.url,async:!1,success:function(t){var t=Ext.decode(t.responseText);e.fields=Ext.Array.merge(e.fields||[],t.rows||t||[])}});var t=e.name;delete e.url;delete e.name;Ext.define(t,Ext.apply({extend:"Ext.data.Model"},e))}});Ext.define("JP.Ext.data.Store",{extend:"Ext.data.Store",alias:"proxy.jp-store",pageSize:JP.PageSize});Ext.define("Ext.data.combo.Store",{extend:"JP.Ext.data.Store",alias:["widget.combostore","widget.jp-store-combo"],fields:[{name:"text"},{name:"value",type:"int"},{name:"def_text"},{name:"def_value",type:"int"}],appendFields:null,autoLoad:!1,remoteFilter:!1,pageSize:100,url:null,constructor:function(e){e.appendFields&&(this.fields=php.array_merge(this.fields,e.appendFields));Ext.apply(e,{proxy:{type:"jp-ajax",url:e.url,reader:{type:"json",root:"rows"}}});this.callParent(arguments)}});Ext.define("Ext.data.common.Store",{extend:"JP.Ext.data.Store",alias:["widget.commonstore","widget.jp-store-common"],remoteSort:!1,remoteFilter:!0,autoLoad:!1,pageSize:100,valueForceInt:!0,constructor:function(e){e.valueForceInt?e.fields=[{name:"text"},{name:"value",type:"int"},{name:"def_text"},{name:"def_value",type:"int"}]:e.fields=["text","value","def_text","def_value"];e.appendFields&&(e.fields=php.array_merge(e.fields,e.appendFields));e.url&&Ext.apply(e,{proxy:{type:"jp-ajax",url:e.url,reader:{type:"json",root:"rows"}}});if(Ext.isObject(e.data)){e.remoteFilter=!1;var t=e.data;e.data=[];for(var n in t)e.data.push({value:n,text:t[n],def_value:n,def_text:t[n]})}if(Ext.isArray(e.data)){e.remoteFilter=!1;var t=e.data;e.data=[];for(var r=0;r<t.length;r++)e.data.push({value:t[r][0],text:t[r][1],def_value:t[r][0],def_text:t[r][1]})}this.callParent(arguments)}});Ext.define("Ext.data.property.converter",{detectType:function(e){var t=this;switch(e.type){case"date":e.value=Ext.Date.parse(e.value,"Y-m-d");break;case"combo":e.renderer=function(e,n,r){return t.findDataLabel(r,e)};e.config=Ext.apply(e.config||{},{store:Ext.create("Ext.data.common.Store",{data:e.data})});break;case"multiselect":e.renderer=function(e,n,r){var i=[];Ext.each(e,function(e,t){i[t]=this.findDataLabel(r,e)},t);return i.join(",")};e.config=Ext.apply(e.config||{},{store:Ext.create("Ext.data.common.Store",{data:e.data})})}},findDataLabel:function(e,t){if(!t)return;var n=e.data.config.store.findRecord("value",t);return n.get("text")}});Ext.define("Ext.data.property.Store",{extend:"Ext.data.Store",alias:"proxy.propstore",constructor:function(){Ext.apply(this,{fields:[{name:"label",type:"string",convert:function(e,t){Ext.create("Ext.data.property.converter").detectType(t.data);return e}},{name:"name",type:"string"},{name:"type",type:"string"},{name:"value"},{name:"group",type:"int"},{name:"groupText",type:"string"},{name:"required",type:"boolean"},{name:"config",type:"auto"},{name:"renderer",type:"auto"},{name:"data",type:"auto"}],groupField:"groupText"});this.callParent(arguments)},loadSourceFromRaw:function(e){this.loadData(this.getEditorDataSource(e))},getEditorDataSource:function(e){var t=[];Ext.each(e,function(e,n){e=this.detectType(e);t[n]=e},this);return t},detectType:function(e){var t=this;switch(e.type){case"date":e.value=Ext.Date.parse(e.value,"Y-m-d");break;case"combo":e.renderer=function(e,n,r){return t.findDataLabel(r,e)};Ext.apply(e.config={},{store:Ext.create("Ext.data.common.Store",{data:e.data})});break;case"multiselect":e.renderer=function(e,n,r){var i=[];Ext.each(e,function(e,t){i[t]=this.findDataLabel(r,e)},t);return i.join(",")};cs.log(e);Ext.apply(e.config={},{store:Ext.create("Ext.data.common.Store",{data:e.data})})}return e},findDataLabel:function(e,t){if(!t)return;var n=e.data.config.store.findRecord("value",t);cs.log(n);return n.get("text")}});Ext.define("JP.Ext.data.proxy.Ajax",{extend:"Ext.data.proxy.Ajax",alias:"proxy.jp-ajax",constructor:function(){Ext.apply(this,{reader:{messageProperty:"msg",totalProperty:"total",type:"json",root:"rows"},writer:{type:"json",writeAllFields:!1,root:"rows"}});this.callParent(arguments);this.on("metachange",function(e,t){cs.log(t)});this.on("exception",function(e,t,n,r){JP.Loading&&JP.Loading.hide();cs.log(e);cs.log(t);cs.log(n);cs.log(r);try{var i=Ext.decode(t.responseText)}catch(s){cs.log(s);alert("Exception from proxy! Please check your connection.");var o=php.sprintf('%s<textarea class="x-msg-descr" style="min-height:150px;">%s\n\nclass: %s, method: %s</textarea>','<b style="margin-bottom:5px;">ERROR! Trying to decode response. Please reload the page.</b>',s.message,s.sourceClass,s.sourceMethod);Ext.Msg.show({title:"เกิดความผิดพลาดขึ้น!",msg:o,icon:Ext.Msg.ERROR,closable:JP.DEV});return}if(i&&i.msg){var o=i.msg;i.msg&&i.dmsg&&(o=i.msg+php.sprintf('<textarea class="x-msg-descr">%s\n\naction: %s</textarea>',i.dmsg,n.action));Ext.Msg.show({title:"เกิดความผิดพลาดขึ้น!",msg:o,icon:Ext.Msg.ERROR,buttons:Ext.Msg.OK})}else console.warn(i)},this)}});Ext.define("Ext.form.field.Filter",{extend:"Ext.form.field.Trigger",alias:"widget.filterfield",initComponent:function(){var e=this;e.onoff=function(e){var t="x-filter-";if(e){this.addCls(t+"on");this.removeCls(t+"off")}else{this.addCls(t+"off");this.removeCls(t+"on")}};Ext.apply(this,{listeners:{scope:e.handler.scope,specialkey:function(t,n){if(n.keyCode===Ext.EventObject.ENTER){var r=t.getValue().length>0;e.onoff(r)}}},onTriggerClick:function(){this.reset();this.focus();e.handler.scope.fireEvent(e.handler.event,"");e.onoff(!1)}});this.callParent(arguments)}});cs.warn("[DEPRECATED] extend JP.Ext.tree.Panel [alias:jp-tree] instead of Ext.tree.Panel");Ext.define("JP.Ext.tree.Panel",{extend:"Ext.tree.Panel",alias:"widget.jp-tree",defViewConfig:{loadMask:{floating:{shadow:!1}},deferEmptyText:!1,emptyText:'<div class="empty-text">ไม่มีข้อมูล...</div>',preserveScrollOnRefresh:!0,trackOver:!1,stripeRows:!1},selModel:{type:"rowmodel",allowDeselect:!0},reselectOnReload:!0,PrevIdxs:null,PrevPage:null,PrevCount:null,_prevIdx:null,constructor:function(e){this.viewConfig=Ext.apply(this.defViewConfig,this.viewConfig);this.callParent(arguments);if(this.reselectOnReload){this.store.on("beforeload",function(e){this.PrevPage=e.currentPage;this.PrevIdxs=this.getSelectionIndexs();this.getSelectionModel().deselectAll()},this);this.store.on("load",function(e,t){if(this._prevIdx){var n=e.getById(this._prevIdx);n&&(n=[n.index]);this.PrevIdxs=n;this.PrevPage=1;this._prevIdx=null}if(this.PrevIdxs&&this.PrevPage==e.currentPage){var r=this.getRecordByIdxs(this.PrevIdxs);r.length&&this.getSelectionModel().select(r)}},this)}},setPrevIdx:function(e){this._prevIdx=e},getColumnByDataIndex:function(e){var t=this.headerCt.getGridColumns();for(var n=0;n<t.length;n++)if(t[n].dataIndex==e)return n},getSelectionIndexs:function(){var e=this.getSelectionModel().getSelection(),t=null;if(e.length){t=[];Ext.each(e,function(e,n){t[n]=e.index})}return t},getRecordByIdxs:function(e){var t=[],n=0;for(;n<e.length;n++){var r=this.store.getAt(e[n]);r&&t.push(r)}return t},getSelected:function(){return this.getSelectionModel().getLastSelected()},hasSelection:function(){return this.getSelectionModel().hasSelection()},filter:function(e){this.getStore().filter(e)},clearFilter:function(e){this.getStore().clearFilter(e)},reload:function(e){this.getStore().removeAll();this.getStore().reload(e||null)},each:function(e,t,n){var r=0,i=function(n){if(!n)return;if(e.call(t||this,n,r)===!1)return!1;r++;var s=n.childNodes,o=s.length,u=0;if(!o)return;for(;u<o;u++)if(i(s[u])===!1)return!1;return};i(n==1?this.getStore().getRootNode():this.getStore().getRootNode().getChildAt(0))}});cs.warn("[DEPRECATED] extend JP.Ext.grid.Panel [alias: jp-grid] instead of Ext.grid.Panel");Ext.define("JP.Ext.grid.Panel",{extend:"Ext.grid.Panel",alias:"widget.jp-grid",layout:"fit",cls:"x-panel-rounded",columnLines:!0,border:!0,stateful:!0,selModel:{type:"rowmodel",allowDeselect:!0},reselectOnReload:!0,rememberSelection:!0,PrevIdxs:null,PrevPage:null,_prevIdx:null,_clearRememberSelection:!1,constructor:function(e){this.callParent(arguments);this.rememberSelection=this.reselectOnReload;if(this.rememberSelection){this.store.on("beforeload",function(e){if(this._clearRememberSelection){this.PrevIdxs=null;this._clearRememberSelection=!1}else{this.PrevPage=e.currentPage;this.PrevIdxs=this.getSelectionIndexs();this.getSelectionModel().deselectAll()}},this);this.store.on("load",function(e,t){if(this._prevIdx){var n=e.getById(this._prevIdx);n&&(n=[n.index]);this.PrevIdxs=n;this.PrevPage=1;this._prevIdx=null}if(this.PrevIdxs&&this.PrevPage==e.currentPage){var t=this.getRecordByIdxs(this.PrevIdxs);t.length&&this.getSelectionModel().select(t)}},this);this.store.on("filterchange",function(){this.PrevIdxs=null},this)}},initComponent:function(){var e={loadMask:{floating:{shadow:!1}},deferEmptyText:!1,emptyText:'<div class="empty-text">ไม่มีข้อมูล...</div>',trackOver:!1,stripeRows:!1};this.viewConfig=this.viewConfig?Ext.apply(e,this.viewConfig):e;this.callParent(arguments)},setPrevIdx:function(e){this._prevIdx=e},getColumnByDataIndex:function(e){var t=this.headerCt.getGridColumns();for(var n=0;n<t.length;n++)if(t[n].dataIndex==e)return n},getSelectionIds:function(){if(!this.getSelected())return null;var e=this.getSelectionModel().getSelection(),t=[];e.length&&Ext.each(e,function(e){e.idProperty&&t.push(e.get(e.idProperty))});return t.length?t:null},getSelectionIndexs:function(){var e=this.getSelectionModel().getSelection(),t=null;if(e.length){t=[];Ext.each(e,function(e,n){t[n]=e.index})}return t},getRecordByIdxs:function(e){var t=[],n=0;for(;n<e.length;n++){var r=this.store.getAt(e[n]);r&&t.push(r)}return t},deselect:function(e,t){this.getSelectionModel().deselect(e,t)},deselectAll:function(e){this.getSelectionModel().deselectAll(e);return this},select:function(e,t,n){this.getSelectionModel().select(e,t,n)},selectById:function(e){var t=this.store.getById(e);t&&this.getSelectionModel().select([t])},getById:function(e){return this.store.getById(e)},getSelected:function(){return this.getSelectionModel().getLastSelected()},getSelection:function(){return this.getSelectionModel().getSelection()},hasSelection:function(){return this.getSelectionModel().hasSelection()},filter:function(e){this.getStore().filter(e)},clearFilter:function(e){this.getStore().clearFilter(e)},reload:function(e){if(e===!0||e&&e.clearRememberSelection)this._clearRememberSelection=!0;typeof e=="function"&&(e={callback:e});this.getStore().reload(e||null)},newload:function(e,t){var n=function(n,r,i){if(typeof t=="number"){var s=this.getRecordByIdxs([t]);s.length&&this.getSelectionModel().select(s)}e&&e.call(this,n,r,i)};this.getStore().loadPage(1,{scope:this,callback:n})}});Ext.define("Ext.grid.column.XButton",{extend:"Ext.grid.column.Action",alias:["widget.xbuttoncolumn"],alternateClassName:"Ext.grid.XButtonColumn",labelText:"",defaultRenderer:function(e,t,n,r,i,s,o){var u=this,a=Ext.baseCSSPrefix,f=u.origScope||u,l=u.items,c=l.length,h=0,p,d,v,m;d=Ext.isFunction(u.origRenderer)?u.origRenderer.apply(f,arguments)||"":"";t.tdCls+=" "+Ext.baseCSSPrefix+"action-col-cell";for(;h<c;h++){p=l[h];v=p.disabled||(p.isDisabled?p.isDisabled.call(p.scope||f,o,r,i,p,n):!1);m=v?null:p.tooltip||(p.getTip?p.getTip.apply(p.scope||f,arguments):null);if(!p.hasActionConfiguration){p.stopSelection=u.stopSelection;p.disable=Ext.Function.bind(u.disableAction,u,[h],0);p.enable=Ext.Function.bind(u.enableAction,u,[h],0);p.hasActionConfiguration=!0}d+='<button type="button" class="btn btn-x"><i class="'+a+"action-col-icon "+a+"action-col-"+String(h)+" "+(v?a+"item-disabled":" ")+" "+(Ext.isFunction(p.getClass)?p.getClass.apply(p.scope||f,arguments):p.iconCls||u.iconCls||"")+'"'+(m?' data-qtip="'+m+'"':"")+" ></i></button>"}return d}});Ext.define("Ext.grid.column.Button",{extend:"Ext.grid.column.Action",alias:["widget.buttoncolumn"],alternateClassName:"Ext.grid.ButtonColumn",labelText:"",defaultRenderer:function(e,t,n,r,i,s,o){var u=this,a=Ext.baseCSSPrefix,f=u.origScope||u,l=u.items,c=l.length,h=0,p,d,v,m;d=Ext.isFunction(u.origRenderer)?u.origRenderer.apply(f,arguments)||"":"";t.tdCls+=" "+Ext.baseCSSPrefix+"action-col-cell";for(;h<c;h++){p=l[h];v=p.disabled||(p.isDisabled?p.isDisabled.call(p.scope||f,o,r,i,p,n):!1);m=v?null:p.tooltip||(p.getTip?p.getTip.apply(p.scope||f,arguments):null);if(!p.hasActionConfiguration){p.stopSelection=u.stopSelection;p.disable=Ext.Function.bind(u.disableAction,u,[h],0);p.enable=Ext.Function.bind(u.enableAction,u,[h],0);p.hasActionConfiguration=!0}var g=Ext.isFunction(p.getClass)?p.getClass.apply(p.scope||f,arguments):p.iconCls||u.iconCls||"";d+='<button type="button" class="button '+(v?a+"item-disabled":"")+'"'+(m?' data-qtip="'+m+'"':"")+">"+(g?'<i class="'+g+'"></i>':"")+(p.text?"<span>"+p.text+"</span>":"")+"</button>"}return d}});Ext.define("XX-JP.Ext.grid.plugin.RowEditing",{extend:"Ext.grid.plugin.RowEditing",alias:"plugin.jp-rowedit",showBtns:!0,focusColIdx:2,removePhantomsOnCancel:!0,init:function(e){var t=this;t.addEvents("canceledit");t.callParent(arguments);e.addEvents("canceledit");e.relayEvents(t,["canceledit"]);t.on("edit",function(e,t){delete t.record._blank})},getEditor:function(){var e=this;e.editor||(e.editor=e.initEditor());this.showBtns===!1&&e.editor.getFloatingButtons().hide();return e.editor},initEditor:function(){var e=this,t=e.grid,n=e.view,r=t.headerCt,i=["saveBtnText","cancelBtnText","errorsText","dirtyText"],s,o=i.length,u={autoCancel:e.autoCancel,errorSummary:e.errorSummary,fields:r.getGridColumns(),hidden:!0,view:n,editingPlugin:e,renderTo:n.el,focusContextCell:e.focusContextCell,onViewRefresh:e.onViewRefresh},a;for(s=0;s<o;s++){a=i[s];Ext.isDefined(e[a])&&(u[a]=e[a])}return Ext.create("Ext.grid.RowEditor",u)},onViewRefresh:function(e){var t=this,n=e.el.dom,r=t.context,i;n.appendChild(t.el.dom);if(r&&(i=r.store.indexOf(r.record))>=0){r.row=e.getNode(i);t.reposition();t.tooltip&&t.tooltip.isVisible()&&t.tooltip.setTarget(r.row);r.column.getEditor().focus()}else t.editingPlugin.cancelEdit()},focusContextCell:function(){var e=typeof this.editingPlugin.focusColIdx=="number",t=this.editingPlugin.focusColIdx,n=this.getEditor(e?t:this.context.colIdx);n&&n.focus&&n.focus()},startAdd:function(e,t){var n=this,r=n.grid.store.model.create(e);r._blank=!0;t=t&&t!=-1&&parseInt(t+1)<=parseInt(n.grid.store.getCount())?t:t==-1?parseInt(n.grid.store.getCount()):0;var i=n.grid.store.autoSync;n.grid.store.autoSync=!1;n.grid.store.insert(t,r);n.grid.store.autoSync=i;n.startEdit(t,0);n.editor.floatingButtons&&n.editor.form.isValid()&&n.editor.floatingButtons.child("#update").setDisabled(!1)},startEditByClick:function(){var e=this;if(!e.editing||e.clicksToMoveEditor===e.clicksToEdit){e.context&&e.context.record._blank&&e.cancelEdit();e.callParent(arguments)}},moveEditorByClick:function(){var e=this;if(e.editing){e.context&&e.context.record._blank&&e.cancelEdit();e.editing=!1;e.superclass.onCellClick.apply(e,arguments)}},cancelEdit:function(){var e=this;if(e.editing){e.getEditor().cancelEdit();e.callParent(arguments);e.fireEvent("canceledit",e.context);e.removePhantomsOnCancel&&(e.context.record._blank&&e.context.record.store?e.context.store.remove(e.context.record):e.context.record.reject())}}});Ext.define("JP.Ext.grid.plugin.RowEditing",{extend:"Ext.grid.plugin.RowEditing",alias:"plugin.jp-rowedit",showBtns:!0,focusColIdx:0,removePhantom:!0,constructor:function(){var e=this;e.callParent(arguments);e.clicksToMoveEditor||(e.clicksToMoveEditor=e.clicksToEdit);e.autoCancel=!!e.autoCancel;this.on("beforeedit",function(){var e=this.editor.items.getAt(this.focusColIdx);e&&e.focus&&Ext.defer(function(){e.focus()},10)},this);this.removePhantom&&this.on("canceledit",function(e,t){t.record.phantom&&t.store.remove(t.record)},this)},getEditor:function(){var e=this;e.editor||(e.editor=e.initEditor());this.showBtns===!1&&e.editor.getFloatingButtons().hide();return e.editor}});Ext.data.Types.DATE.convert=function(e){var t=this.dateReadFormat||this.dateFormat,n;if(!e)return null;if(e instanceof Date)return e;typeof e=="object"&&e.date&&(e=e.date);if(t)return Ext.Date.parse(e,t);n=Date.parse(e);return n?new Date(n):null};Ext.define("Ext.grid.column.Date",{override:"Ext.grid.column.Date",defaultRenderer:function(e){e&&typeof e=="object"&&e.date&&(e=e.date);return Ext.util.Format.date(e,this.format)}});Ext.define("Ext.grid.column.THDate",{extend:"Ext.grid.column.Date",alias:["widget.datecolumn-th"],requires:["Ext.Date"],alternateClassName:"Ext.grid.THDateColumn",format:"d/m/y",initComponent:function(){var e=this;e.format||(e.format=Ext.Date.defaultFormat);e.renderer=JP.THDateRender;e.callParent(arguments)}});Ext.define("Ext.grid.column.Money",{extend:"Ext.grid.column.Column",alias:["widget.moneycolumn"],alternateClassName:"Ext.grid.MoneyColumn",format:"0,000.00",decimal:2,align:"right",defaultRenderer:function(e){return JP.money(e||0,this.decimal)}});Ext.define("Ext.grid.RowNumberer",{override:"Ext.grid.RowNumberer",align:"center",renderer:function(e,t,n,r,i,s){var o=this.rowspan;o&&(t.tdAttr='rowspan="'+o+'"');t.tdCls=Ext.baseCSSPrefix+"grid-cell-special";var u=this.headerCt.getHeaderAtIndex(i),a=u.getPageData(s.store||s);return r+a.fromRecord},getPageData:function(e){var t=e.getTotalCount();return{total:t,currentPage:e.currentPage,pageCount:Math.ceil(t/e.pageSize),fromRecord:(e.currentPage-1)*e.pageSize+1,toRecord:Math.min(e.currentPage*e.pageSize,t)}}});Ext.define("JP.Ext.grid.feature.GroupingSummary",{extend:"Ext.grid.feature.GroupingSummary",alias:"feature.jp-groupingsummary",hideSummaryCollapse:!0,constructor:function(){this.callParent(arguments);if(this.hideSummaryCollapse){this.on("groupcollapse",function(){this.toggleSummaryRow(!1);this.grid.getView().refresh()},this);this.on("groupexpand",function(){this.toggleSummaryRow(!0);this.grid.getView().refresh()},this)}}});Ext.define("Ext.form.Basic",{override:"Ext.form.Basic",isInsert:!0,_pkField:null,constructor:function(){this.callParent(arguments);this.on("beforeaction",function(e,t){this.isInsert=this._isInsert()},this);this.on("actioncomplete",function(e,t){this.updatePk(t)},this)},_isInsert:function(){var e=!1,t=null,n=this;this.getFields().each(function(n){n.isPk&&(t=!0);if(n.isPk==1&&php.empty(n.getValue())){e=!0;return!1}});t||cs.warn("Can not found PK to config it just: isPk: true on some field.");return e},getPkField:function(){if(this._pkField)return this._pkField;this.getFields().each(function(e){if(e.isPk){this._pkField=e;return!1}},this);return this._pkField},updatePk:function(e){var t=e.result;this.setPkValue(null);this.getPkField()&&t[this.getPkField().getName()]&&this.setPkValue(t[this.getPkField().getName()])},setPkValue:function(e){var t=!1;this.getFields().each(function(n){if(n.isPk){t=!0;n.setValue(e);return!1}});if(t)return e;cs.warn("Can not found PK to config it just: isPk: true on some field.");return null},getPkValue:function(){return this.getPkField()?this.getPkField().getValue():null},getFieldValue:function(e){return this.findField(e).getValue()},setFieldValue:function(e,t){this.findField(e).setValue(t);return this},hasField:function(e){return!!this.findField(e)}});Ext.define("Ext.form.Panel",{override:"Ext.form.Panel",getField:function(e){return this.getForm().findField(e)},hasField:function(e){return this.getForm().hasField(e)},getFieldValue:function(e){return this.getField(e).getValue()},setFieldValue:function(e,t){this.getField(e).setValue(t);return this},setPkValue:function(e){this.getForm().setPkValue(e)},getPkValue:function(){return this.getForm().getPkValue()},failure:function(e,t){switch(t.failureType){case Ext.form.action.Action.CLIENT_INVALID:Ext.Msg.alert("Failure","Form fields may not be submitted with invalid values");break;case Ext.form.action.Action.CONNECT_FAILURE:Ext.Msg.alert("Failure","Ajax communication failed");break;case Ext.form.action.Action.SERVER_INVALID:Ext.Msg.alert("Failure",t.result.msg)}},submit:function(e){e=Ext.apply({failure:this.failure},e);this.form.submit(e)}});Ext.define("JP.Ext.window.Window",{extend:"Ext.window.Window",alias:"widget.jp-window",rememberResize:!0,_shown:!1,shadow:!1,hideMode:"display",ghost:!1,state:"null",layout:"fit",maximizable:!0,minimizable:!0,border:!1,hideMaximizeClose:!1,minWidth:200,constructor:function(){this.callParent(arguments);this.addEvents("hidden","shown");this.on("afterrender",function(){var e=this.getEl();e.addCls("animatedf BounceIn");e.on(JP.css3.events.animate.end,function(){if(this.state=="close"){this.hide();this.fireEvent("hidden",this)}else{this._showOver&&(!this._shown||!this.rememberResize)&&this.setBox(this._showOver.getBox());this.fireEvent("shown",this);this._shown=!0}},this)},this);this.on("beforehide",function(){var e=this.getEl(),t=this.state;e.removeCls("BounceIn");e.addCls("BounceOut");this.state="close";return t=="close"},this);this.on("hide",function(){var e=this.getEl();e.addCls("BounceIn");e.removeCls("BounceOut");this.state="closed"});this.on("maximize",function(){this.maxHeightMaximize();this.tools.minimize&&this.tools.minimize.hide()});this.on("minimize",function(){var e=this,t=this.tools;t.refresh&&t.refresh.hide();t.minimize&&t.minimize.hide();this.hideMaximizeClose&&t.close&&t.close.hide();e.collapse(null,!1);if(!e.hasSavedRestore){e.restoreSize=e.getSize();e.restorePos=e.getPosition(!0);e.hasSavedRestore=!0}e.minimized=!0;e.setWidth(250)});this.on("collapse",function(){var e=this.tools;e.restore&&e.restore.show()});this.on("resotre",function(){var e=this.tools;this.hideMaximizeClose&&e.close&&e.close.show()})},addTools:function(){this.callParent();!this.maximizable&&this.minimizable&&this.addTool({type:"restore",handler:Ext.Function.bind(this.restore,this,[]),hidden:!0})},showOver:function(e){this._showOver=e;this.show()},restore:function(e){var t=this,n=t.tools,r=t.header,i=t.restoreSize,s;if(n.minimize){n.minimize.show();s=!0}this.callParent(arguments);if(t.minimized){t.hasSavedRestore=null;if(r){r.suspendLayouts();if(n.restore){n.restore.hide();s=!0}if(t.collapseTool){t.collapseTool.show();s=!0}if(n.refresh){n.refresh.show();s=!0}t.resumeHeaderLayout(s)}t.minimized=!1;i.x=t.restorePos[0];i.y=t.restorePos[1];t.setBox(i,e=e||!!t.animateTarget?{callback:function(){t.el.enableShadow(!0);t.center();t.fireEvent("restore",t)}}:null);t.restorePos=t.restoreSize=null;if(t.dd){t.dd.enable();r&&r.addCls(r.indicateDragCls)}t.resizer&&t.resizer.enable();t.syncMonitorWindowResize();if(!e){t.el.enableShadow(!0);t.fireEvent("restore",t)}t.
expand(!1)}return t},maxHeightMaximize:function(){if(this.maxInternal)return;if(this.maximized){this.oldMaxHeight=this.maxHeight;this.maxHeight=undefined;this.maxInternal=!0;this.restore();this.maximize();this.maxInternal=!1}else this.maxHeight=this.oldMaxHeight}});Ext.define("JP.Ext.window.Dialog",{extend:"JP.Ext.window.Window",alias:"widget.jp-dialog",closeAction:"hide",padding:"15",buttonAlign:"right",closeButton:!0,minimizable:!1,modal:!0,initComponent:function(e){var t;this.buttons==t&&this.closeButton&&Ext.apply(this,{buttons:[{scope:this,text:_("ปิด"),scale:"medium",handler:function(){this.hide()}}]});this.callParent(arguments)}});cs.warn("[DEPRECATED] extend JP.Ext.panel.Panel [alias:jp-panel] instead of Ext.panel.Panel");Ext.define("JP.Ext.panel.Panel",{extend:"Ext.panel.Panel",alias:"widget.jp-panel"});Ext.define("JP.Viewport.Panel",{extend:"Ext.panel.Panel",alias:"widget.jp-viewport",heightControl:null,flex:1,afterFirstLayout:function(){var e=this;cs.log("init main layout ...");JP.Loading&&JP.Loading.hide();JP.layout.on("reset.ext-panel",function(t){e.fireResize(e.heightControl||t.page)});e.callParent(arguments);e.fireResize(this.heightControl||JP.layout.page)},fireResize:function(e){this.setSize(e.width||"auto",e.height||"auto")}});Ext.define("Ext.form.field.Date.TH",{extend:"Ext.form.field.Date",alias:"widget.datefield-th",initComponent:function(){this.year_pos=this.format.search(/y/i);this.callParent()},valueToRaw:function(e){return this.formatDate(this.parseDate(e))},rawToValue:function(e){return this.parseDate(e)||e||null}});Ext.app.Controller.getFullName=function(e,t,n){var r=e,i,s;if((i=e.indexOf(":"))>0){n=n+"."+e.substring(0,i);e=e.substring(i+1)}if((i=e.indexOf("@"))>0){r=e.substring(0,i);s=e.substring(i+1)+"."+r}else if(e.indexOf(".")>0&&(Ext.ClassManager.isCreated(e)||Ext.Loader.isAClassNameWithAKnownPrefix(e)))s=e;else{n||Ext.log.warn("Cannot find namespace for "+t+" "+e+", "+"assuming it is fully qualified class name");if(n){s=n+"."+t+"."+e;r=e}else s=e}return{absoluteName:s,shortName:r}};Ext.define("JP.Ext.app.Controller",{extend:"Ext.app.Controller",app:function(){return this.application},ctrl:function(e,t){var n=this.app().controllers.get(e);if(n){t&&t.call(this,n);return n}JP.Loading.show();$(".x-menu").css("visibility","hidden");var r=this;setTimeout(function(){var n=r.app().getController(e);n._initialized||n.init(r.app());t&&t.call(r,n);JP.Loading.hide()},100)},anthdr:function(e,t,n,r,i){var s=this.ctrl(e,function(e){e[t].apply(e,n);r&&r.call(i||e)});if(s){s[t].apply(s,n);r&&r.call(i||s)}}});Ext.define("JP.Ext.grid.feature.Summary",{extend:"Ext.grid.feature.Summary",alias:"feature.jp-summary",showSummaryRow:!0,onColumnHeaderLayout:function(){var e=this.view,t=e.headerCt.getVisibleGridColumns(),n,r=t.length,i,s=this.summaryBar.el,o;for(i=0;i<r;i++){n=t[i];n.flex&&(n.width=null);o=s.down(e.getCellSelector(n));if(o)if(n.hidden)o.setDisplayed(!1);else{o.setDisplayed(!0);o.setWidth(n.width||(n.lastBox?n.lastBox.width:100))}}}});Ext.Ajax.on("requestcomplete",function(e,t,n,r){JP.Loading.hide();if(JP.DEV&&/jdebug-console/i.test(t.responseText)){var i=Ext.decode(t.responseText);JConsoleLog.update(i["jdebug-console"])}$(".x-grid-view.x-grid-view-loading").removeClass("x-grid-view-loading")});Ext.Ajax.on("beforerequest",function(e){JP.setMask(!1);JP.Loading.show();var t=$(".x-grid-view .empty-text");t.length&&t.parent(".x-grid-view").addClass("x-grid-view-loading")});