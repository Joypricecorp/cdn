(function(e){return e.fn.ajaxChosen=function(t,n,r){var i,s,o,u;t==null&&(t={});n==null&&(n={});r=e.extend({default_multiple_text:"",default_single_text:"",default_no_result_text:"ไม่พบข้อมูล"},r||{});s={minTermLength:2,afterTypeDelay:500,jsonTermKey:"term",keepTypingMsg:"เพิ่มคำอีก...",lookingForMsg:"กำลังค้นหา"};u=this;i=null;o=e.extend({},s,e(u).data(),t);this.chosen(r);return this.each(function(){return e(this).next(".chzn-container").find(".search-field > input, .chzn-search > input").bind("keyup",function(){var t,r,s,a,f;a=e(this).attr("value");f=e.trim(e(this).attr("value"));r=f.length<o.minTermLength?o.keepTypingMsg:o.lookingForMsg+(" '"+f+"'");u.next(".chzn-container").find(".no-results").text(r);if(f===e(this).data("prevVal"))return!1;e(this).data("prevVal",f);this.timer&&clearTimeout(this.timer);if(f.length<o.minTermLength)return!1;t=e(this);o.data==null&&(o.data={});o.data[o.jsonTermKey]=f;o.dataCallback!=null&&(o.data=o.dataCallback(o.data));s=o.success;o.success=function(r){var i,o,f;if(r==null)return;f=[];u.find("option").each(function(){return e(this).is(":selected")?f.push(e(this).val()+"-"+e(this).text()):e(this).remove()});u.find("optgroup:empty").each(function(){return e(this).remove()});i=n(r,t);o=0;e.each(i,function(t,n){var r,i,s;o++;if(n.group){r=u.find("optgroup[label='"+n.text+"']");r.size()||(r=e("<optgroup />"));r.attr("label",n.text).appendTo(u);return e.each(n.items,function(t,n){var i,s;if(typeof n=="string"){s=t;i=n}else{s=n.value;i=n.text}if(e.inArray(s+"-"+i,f)===-1)return e("<option />").attr("value",s).html(i).appendTo(r)})}if(typeof n=="string"){s=t;i=n}else{s=n.value;i=n.text}if(e.inArray(s+"-"+i,f)===-1)return e("<option />").attr("value",s).html(i).appendTo(u)});if(o)u.trigger("liszt:updated");else{u.data().chosen.no_results_clear();u.data().chosen.no_results(t.attr("value"))}s!=null&&s(r);t.attr("value",a);u.data().chosen.search_field_scale();return t};return this.timer=setTimeout(function(){i&&i.abort();return i=e.ajax(o)},o.afterTypeDelay)})})}})(jQuery);