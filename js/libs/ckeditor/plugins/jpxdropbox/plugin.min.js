/*
 * Jpx Dropbox - CKEditor plugin for dropbox images manager. 
 * This plugin can be used to chooses and manage from your dropbox account. 
 *
 * @author liverbool
 * @contact nukboon@gmail.com
 * @copyright 2013 liverbool
 *
 */(function(){var e=console;CKEDITOR.plugins.add("jpxdropbox",{init:function(e){var t=this,n={url:t.path+"dbx/index.php",url_start:"/",dialog:{autoOpen:!1}};$.extend(n,e.config.jpxdropbox||{});var r=n.url.replace("index.php",""),i=$("body");i.append('<link rel="stylesheet" href="'+r+'assets/lib/plupload2/js/jquery.ui.plupload/css/jquery.ui.plupload.css" type="text/css">');i.append('<link rel="stylesheet" href="'+r+'assets/dbx.min.css" type="text/css" media="all">');i.append('<script src="'+r+'assets/lib/jquery.lazyload.jp.min.js" type="text/javascript"></script>');i.append('<script src="'+r+'assets/lib/plupload2/js/plupload.full.min.js" type="text/javascript"></script>');i.append('<script src="'+r+'assets/lib/plupload2/js/jquery.ui.plupload/jquery.ui.plupload.min.js" type="text/javascript"></script>');i.append('<script src="'+r+'assets/dbx.min.js" type="text/javascript"></script>');CKEDITOR.on("dialogDefinition",function(e){var r=this,i=e.data.definition.dialog,s;i.on("show",function(){var e=this.getContentElement("info","txtUrl"),r=$("#"+e.domId).addClass("jpx-ck-add-ct"),i=$("#"+e._.inputId),o=i.parent(".cke_dialog_ui_input_text"),u=$(".jpx-ck-add",o);if(!u.length){u=$('<a class="jpx-ck-add cke_dialog_ui_button"><span class="cke_dialog_ui_button">dropbox</span></a>').insertBefore(i);u.on("click",function(){if(JpxDropbox.instance==s){n.events===s&&(n.events={});n.events={choose:function(t){e.setValue(t);e.focus();this.close()}};JpxDropbox.instance=new JpxDropbox(n)}JpxDropbox.instance.open()});u.css({right:"0",padding:"4px 0",position:"absolute","border-top-left-radius":"0","border-bottom-left-radius":"0"});$("span",u).css({display:"inline-block","text-indent":"-1000px",background:'url("'+t.path+'cloud-add-20.png") center center no-repeat'});o.css({position:"relative"});i.css({"padding-right":u.outerWidth()})}})})}})})();