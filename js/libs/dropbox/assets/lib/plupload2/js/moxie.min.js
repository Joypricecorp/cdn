/**
 * mOxie - multi-runtime File API & XMLHttpRequest L2 Polyfill
 * v1.0a
 *
 * Copyright 2013, Moxiecode Systems AB
 * Released under GPL License.
 *
 * License: http://www.plupload.com/license
 * Contributing: http://www.plupload.com/contributing
 *
 * Date: 2012-11-13
 *//**
 * Compiled inline version. (Library mode)
 *//*jshint smarttabs:true, undef:true, latedef:true, curly:true, bitwise:true, camelcase:true *//*globals $code */(function(e,t){"use strict";function r(e,t){var r,i=[];for(var s=0;s<e.length;++s){r=n[e[s]]||o(e[s]);if(!r)throw"module definition dependecy not found: "+e[s];i.push(r)}t.apply(null,i)}function i(e,i,s){if(typeof e!="string")throw"invalid module definition, module id must be defined and be a string";if(i===t)throw"invalid module definition, dependencies must be specified";if(s===t)throw"invalid module definition, definition function must be specified";r(i,function(){n[e]=s.apply(null,arguments)})}function s(e){return!!n[e]}function o(t){var n=e,r=t.split(/[.\/]/);for(var i=0;i<r.length;++i){if(!n[r[i]])return;n=n[r[i]]}return n}function u(r){for(var i=0;i<r.length;i++){var s=e,o=r[i],u=o.split(/[.\/]/);for(var a=0;a<u.length-1;++a){s[u[a]]===t&&(s[u[a]]={});s=s[u[a]]}s[u[u.length-1]]=n[o]}}var n={};i("moxie/core/utils/Basic",[],function(){var e=function(e){var t;return e===t?"undefined":e===null?"null":e.nodeType?"node":{}.toString.call(e).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()},t=function(r){var i;n(arguments,function(o,u){u>0&&n(o,function(n,o){n!==i&&(e(r[o])!==e(n)||!~s(e(n),["array","object"])?r[o]=n:t(r[o],n))})});return r},n=function(e,t){var n,r,i,s;if(e){try{n=e.length}catch(o){n=s}if(n===s){for(r in e)if(e.hasOwnProperty(r)&&t(e[r],r)===!1)return}else for(i=0;i<n;i++)if(t(e[i],i)===!1)return}},r=function(t){var n;if(!t||e(t)!=="object")return!0;for(n in t)return!1;return!0},i=function(t,n){function s(r){e(t[r])==="function"&&t[r](function(e){++r<i&&!e?s(r):n(e)})}var r=0,i=t.length;e(n)!=="function"&&(n=function(){});(!t||!t.length)&&n();s(r)},s=function(e,t){if(t){if(Array.prototype.indexOf)return Array.prototype.indexOf.call(t,e);for(var n=0,r=t.length;n<r;n++)if(t[n]===e)return n}return-1},o=function(t,n){var r=[];e(t)!=="array"&&(t=[t]);e(n)!=="array"&&(n=[n]);for(var i in t)s(t[i],n)===-1&&r.push(t[i]);return r.length?r:!1},u=function(e){var t,n=[];for(t=0;t<e.length;t++)n[t]=e[t];return n},a=function(){var e=0;return function(t){var n=(new Date).getTime().toString(32),r;for(r=0;r<5;r++)n+=Math.floor(Math.random()*65535).toString(32);return(t||"o_")+n+(e++).toString(32)}}(),f=function(e){return e?String.prototype.trim?String.prototype.trim.call(e):e.toString().replace(/^\s*/,"").replace(/\s*$/,""):e},l=function(e){if(typeof e!="string")return e;var t={t:1099511627776,g:1073741824,m:1048576,k:1024},n;e=/^([0-9]+)([mgk]?)$/.exec(e.toLowerCase().replace(/[^0-9mkg]/g,""));n=e[2];e=+e[1];t.hasOwnProperty(n)&&(e*=t[n]);return e};return{guid:a,typeOf:e,extend:t,each:n,isEmptyObj:r,inSeries:i,inArray:s,arrayDiff:o,toArray:u,trim:f,parseSizeStr:l}});i("moxie/core/I18n",["moxie/core/utils/Basic"],function(e){var t={};return{addI18n:function(n){return e.extend(t,n)},translate:function(e){return t[e]||e},_:function(e){return this.translate(e)},sprintf:function(e){var t=[].slice.call(arguments,1),n="";e.split(/%[sdf]/).forEach(function(e){n+=e;t.length&&(n+=t.shift())});return n}}});i("moxie/core/utils/Mime",["moxie/core/utils/Basic","moxie/core/I18n"],function(e,t){var n="application/msword,doc dot,application/pdf,pdf,application/pgp-signature,pgp,application/postscript,ps ai eps,application/rtf,rtf,application/vnd.ms-excel,xls xlb,application/vnd.ms-powerpoint,ppt pps pot,application/zip,zip,application/x-shockwave-flash,swf swfl,application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,application/vnd.openxmlformats-officedocument.presentationml.template,potx,application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,application/x-javascript,js,application/json,json,audio/mpeg,mp3 mpga mpega mp2,audio/x-wav,wav,audio/mp4,m4a,audio/ogg,oga ogg,audio/aiff,aiff aif,audio/flac,flac,audio/aac,aac,audio/ac3,ac3,audio/x-ms-wma,wma,image/bmp,bmp,image/gif,gif,image/jpeg,jpg jpeg jpe,image/photoshop,psd,image/png,png,image/svg+xml,svg svgz,image/tiff,tiff tif,text/plain,asc txt text diff log,text/html,htm html xhtml,text/css,css,text/csv,csv,text/rtf,rtf,video/mpeg,mpeg mpg mpe m2v,video/quicktime,qt mov,video/mp4,mp4,video/x-m4v,m4v,video/x-flv,flv,video/x-ms-wmv,wmv,video/avi,avi,video/webm,webm,video/3gpp,3gpp 3gp,video/3gpp2,3g2,video/vnd.rn-realvideo,rv,video/ogg,ogv,video/x-matroska,mkv,application/vnd.oasis.opendocument.formula-template,otf,application/octet-stream,exe",r={mimes:{},extensions:{},addMimeType:function(e){var t=e.split(/,/),n,r,i;for(n=0;n<t.length;n+=2){i=t[n+1].split(/ /);for(r=0;r<i.length;r++)this.mimes[i[r]]=t[n];this.extensions[t[n]]=i}},extList2mimes:function(t){var n=this,r,i,s,o,u=[];e:for(i=0;i<t.length;i++){r=t[i].extensions.split(/\s*,\s*/);for(s=0;s<r.length;s++){if(r[s]==="*"){u=[];break e}o=n.mimes[r[s]];o&&!~e.inArray(o,u)&&u.push(o)}}return u},mimes2extList:function(n){var r=this,i=[],s=[];n=e.trim(n).split(/\s*,\s*/);n!=="*"&&e.each(n,function(t){var n=t.match(/^(\w+)\/(\*|\w+)$/);n&&(n[2]==="*"?e.each(r.extensions,function(e,t){(new RegExp("^"+n[1]+"/")).test(t)&&[].push.apply(i,r.extensions[t])}):r.extensions[t]&&[].push.apply(i,r.extensions[t]))});s.push({title:t.translate("Files"),extensions:i.length?i.join(","):"*"});s.mimes=n;return s},getFileExtension:function(e){var t=e&&e.match(/\.([^.]+)$/);return t?t[1].toLowerCase():""},getFileMime:function(e){return this.mimes[this.getFileExtension(e)]||""}};r.addMimeType(n);return r});i("moxie/core/utils/Env",["moxie/core/utils/Basic"],function(e){function i(e){var t,n;for(var i=0;i<e.length;i++){t=e[i].s1;n=e[i].prop;r=e[i].sv||e[i].id;if(t){if(t.indexOf(e[i].s2)!=-1)return e[i].id}else if(n)return e[i].id}}function s(e){var t=e.indexOf(r);if(t==-1)return;return parseFloat(e.substring(t+r.length+1))}var t=[{s1:navigator.userAgent,s2:"Android",id:"Android Browser",sv:"Version"},{s1:navigator.userAgent,s2:"Chrome",id:"Chrome"},{s1:navigator.vendor,s2:"Apple",id:"Safari",sv:"Version"},{prop:window.opera&&window.opera.buildNumber,id:"Opera",sv:"Version"},{s1:navigator.vendor,s2:"KDE",id:"Konqueror"},{s1:navigator.userAgent,s2:"Firefox",id:"Firefox"},{s1:navigator.vendor,s2:"Camino",id:"Camino"},{s1:navigator.userAgent,s2:"Netscape",id:"Netscape"},{s1:navigator.userAgent,s2:"MSIE",id:"IE",sv:"MSIE"},{s1:navigator.userAgent,s2:"Gecko",id:"Mozilla",sv:"rv"}],n=[{s1:navigator.platform,s2:"Win",id:"Windows"},{s1:navigator.platform,s2:"Mac",id:"Mac"},{s1:navigator.userAgent,s2:"iPhone",id:"iOS"},{s1:navigator.userAgent,s2:"iPad",id:"iOS"},{s1:navigator.userAgent,s2:"Android",id:"Android"},{s1:navigator.platform,s2:"Linux",id:"Linux"}],r,o=function(){var t={define_property:function(){return!1}(),create_canvas:function(){var e=document.createElement("canvas");return!!e.getContext&&!!e.getContext("2d")}(),return_response_type:function(t){if(!window.XMLHttpRequest)return!1;try{var n=new XMLHttpRequest;if(e.typeOf(n.responseType)!=="undefined"){n.open("get","infinity-8.me");n.responseType=t;return n.responseType!==t?!1:!0}}catch(r){}return!1},use_data_uri:function(){var e=new Image;e.onload=function(){t.use_data_uri=e.width===1&&e.height===1};setTimeout(function(){e.src="data:image/gif;base64,R0lGODlhAQABAIAAAP8AAAAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw=="},1);return!1}(),use_data_uri_over32kb:function(){return t.use_data_uri&&(u.browser!=="IE"||u.version>=9)},use_data_uri_of:function(e){return t.use_data_uri&&e<33e3||t.use_data_uri_over32kb()},use_fileinput:function(){var e=document.createElement("input");e.setAttribute("type","file");return!e.disabled}};return function(n){var r=[].slice.call(arguments);r.shift();return e.typeOf(t[n])==="function"?t[n].apply(this,r):!!t[n]}}(),u={can:o,browser:i(t),version:s(navigator.userAgent)||s(navigator.appVersion),OS:i(n),swf_url:"../flash/Moxie.swf",xap_url:"../silverlight/Moxie.xap",global_event_dispatcher:"moxie.core.EventTarget.instance.dispatchEvent"};return u});i("moxie/core/utils/Dom",["moxie/core/utils/Env"],function(e){var t=function(e){return typeof e!="string"?e:document.getElementById(e)},n=function(e,t){var n;if(e.className==="")return!1;n=new RegExp("(^|\\s+)"+t+"(\\s+|$)");return n.test(e.className)},r=function(e,t){n(e,t)||(e.className=e.className===""?t:e.className.replace(/\s+$/,"")+" "+t)},i=function(e,t){var n=new RegExp("(^|\\s+)"+t+"(\\s+|$)");e.className=e.className.replace(n,function(e,t,n){return t===" "&&n===" "?" ":""})},s=function(e,t){if(e.currentStyle)return e.currentStyle[t];if(window.getComputedStyle)return window.getComputedStyle(e,null)[t]},o=function(t,n){function f(e){var t,n,r=0,i=0;if(e){n=e.getBoundingClientRect();t=o.compatMode==="CSS1Compat"?o.documentElement:o.body;r=n.left+t.scrollLeft;i=n.top+t.scrollTop}return{x:r,y:i}}var r=0,i=0,s,o=document,u,a;t=t;n=n||o.body;if(t&&t.getBoundingClientRect&&e.browser==="IE"&&(!o.documentMode||o.documentMode<8)){u=f(t);a=f(n);return{x:u.x-a.x,y:u.y-a.y}}s=t;while(s&&s!=n&&s.nodeType){r+=s.offsetLeft||0;i+=s.offsetTop||0;s=s.offsetParent}s=t.parentNode;while(s&&s!=n&&s.nodeType){r-=s.scrollLeft||0;i-=s.scrollTop||0;s=s.parentNode}return{x:r,y:i}},u=function(e){return{w:e.offsetWidth||e.clientWidth,h:e.offsetHeight||e.clientHeight}};return{get:t,hasClass:n,addClass:r,removeClass:i,getStyle:s,getPos:o,getSize:u}});i("moxie/core/Exceptions",["moxie/core/utils/Basic"],function(e){function t(e,t){var n;for(n in e)if(e[n]===t)return n;return null}return{RuntimeError:function(){function r(e){this.code=e;this.name=t(n,e);this.message=this.name+": RuntimeError "+this.code}var n={NOT_INIT_ERR:1,NOT_SUPPORTED_ERR:9,JS_ERR:4};e.extend(r,n);r.prototype=Error.prototype;return r}(),OperationNotAllowedException:function(){function t(e){this.code=e;this.name="OperationNotAllowedException"}e.extend(t,{NOT_ALLOWED_ERR:1});t.prototype=Error.prototype;return t}(),ImageError:function(){function r(e){this.code=e;this.name=t(n,e);this.message=this.name+": ImageError "+this.code}var n={WRONG_FORMAT:1};e.extend(r,n);r.prototype=Error.prototype;return r}(),FileException:function(){function r(e){this.code=e;this.name=t(n,e);this.message=this.name+": FileException "+this.code}var n={NOT_FOUND_ERR:1,SECURITY_ERR:2,ABORT_ERR:3,NOT_READABLE_ERR:4,ENCODING_ERR:5,NO_MODIFICATION_ALLOWED_ERR:6,INVALID_STATE_ERR:7,SYNTAX_ERR:8};e.extend(r,n);r.prototype=Error.prototype;return r}(),DOMException:function(){function r(e){this.code=e;this.name=t(n,e);this.message=this.name+": DOMException "+this.code}var n={INDEX_SIZE_ERR:1,DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,INVALID_ACCESS_ERR:15,VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25};e.extend(r,n);r.prototype=Error.prototype;return r}(),EventException:function(){function t(e){this.code=e;this.name="EventException"}e.extend(t,{UNSPECIFIED_EVENT_TYPE_ERR:0});t.prototype=Error.prototype;return t}()}});i("moxie/core/EventTarget",["moxie/core/Exceptions","moxie/core/utils/Basic"],function(e,n){function r(){var r={};n.extend(this,{uid:null,init:function(){this.uid||(this.uid=n.guid("uid_"))},addEventListener:function(e,t,i,s){var o=this,u;e=n.trim(e);if(/\s/.test(e)){n.each(e.split(/\s+/),function(e){o.addEventListener(e,t,i,s)});return}e=e.toLowerCase();i=parseInt(i,10)||0;u=r[this.uid]&&r[this.uid][e]||[];u.push({fn:t,priority:i,scope:s||this});r[this.uid]||(r[this.uid]={});r[this.uid][e]=u},hasEventListener:function(e){return e?!!r[this.uid]&&!!r[this.uid][e]:!!r[this.uid]},removeEventListener:function(e,t){e=e.toLowerCase();var i=r[this.uid]&&r[this.uid][e],s;if(i){if(t){for(s=i.length-1;s>=0;s--)if(i[s].fn===t){i.splice(s,1);break}}else i=[];if(!i.length){delete r[this.uid][e];n.isEmptyObj(r[this.uid])&&delete r[this.uid]}}},removeAllEventListeners:function(){r[this.uid]&&delete r[this.uid]},dispatchEvent:function(t){var i,s,o,u,a={};if(n.typeOf(t)!=="string"){u=t;if(n.typeOf(u.type)!=="string")throw new e.EventException(e.EventException.UNSPECIFIED_EVENT_TYPE_ERR);t=u.type;if(u.total&&u.loaded){a.total=u.total;a.loaded=u.loaded}a.async=u.async||!1}t.indexOf("::")!==-1?function(e){i=e[0];t=e[1]}(t.split("::")):i=this.uid;t=t.toLowerCase();s=r[i]&&r[i][t];if(s){s.sort(function(e,t){return t.priority-e.priority});o=[].slice.call(arguments);o.shift();a.type=t;o.unshift(a);var f=[];n.each(s,function(e){o[0].target=e.scope;a.async?f.push(function(t){setTimeout(function(){t(e.fn.apply(e.scope,o)===!1)},1)}):f.push(function(t){t(e.fn.apply(e.scope,o)===!1)})});f.length&&n.inSeries(f)}return!0},bind:function(){this.addEventListener.apply(this,arguments)},unbind:function(){this.removeEventListener.apply(this,arguments)},unbindAll:function(){this.removeAllEventListeners.apply(this,arguments)},trigger:function(){this.dispatchEvent.apply(this,arguments)},convertEventPropsToHandlers:function(e){var r;n.typeOf(e)!=="array"&&(e=[e]);for(var i=0;i<e.length;i++){r="on"+e[i];n.typeOf(this[r])==="function"?this.addEventListener(e[i],this[r]):this[r]===t&&(this[r]=null)}}})}r.instance=new r;return r});i("moxie/core/utils/Encode",[],function(){var e=function(e){return unescape(encodeURIComponent(e))},t=function(e){return decodeURIComponent(escape(e))},n=function(e,n){if(typeof window.atob=="function")return n?t(window.atob(e)):window.atob(e);var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i,s,o,u,a,f,l,c,h=0,p=0,d="",v=[];if(!e)return e;e+="";do{u=r.indexOf(e.charAt(h++));a=r.indexOf(e.charAt(h++));f=r.indexOf(e.charAt(h++));l=r.indexOf(e.charAt(h++));c=u<<18|a<<12|f<<6|l;i=c>>16&255;s=c>>8&255;o=c&255;f==64?v[p++]=String.fromCharCode(i):l==64?v[p++]=String.fromCharCode(i,s):v[p++]=String.fromCharCode(i,s,o)}while(h<e.length);d=v.join("");return n?t(d):d},r=function(t,n){n&&e(t);if(typeof window.btoa=="function")return window.btoa(t);var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i,s,o,u,a,f,l,c,h=0,p=0,d="",v=[];if(!t)return t;do{i=t.charCodeAt(h++);s=t.charCodeAt(h++);o=t.charCodeAt(h++);c=i<<16|s<<8|o;u=c>>18&63;a=c>>12&63;f=c>>6&63;l=c&63;v[p++]=r.charAt(u)+r.charAt(a)+r.charAt(f)+r.charAt(l)}while(h<t.length);d=v.join("");var m=t.length%3;return(m?d.slice(0,m-3):d)+"===".slice(m||3)};return{utf8_encode:e,utf8_decode:t,atob:n,btoa:r}});i("moxie/runtime/Runtime",["moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/EventTarget"],function(e,t,n){function s(n,r,s,o,u){function h(t,r){var i=this,s=n&&n.required_caps;if(c!==null)return c;s&&!e.isEmptyObj(t)&&e.each(s,function(e,n){if(t.hasOwnProperty(n)){var r=i.can(n,e,t)?"client":"browser";if(c&&c!==r)return c=!1;c=r}});c===null&&(c=r||"browser");c&&s&&!this.can(s)&&(c=!1)}var a=this,f,l=e.guid(r+"_"),c=null;i[l]=this;s=e.extend({access_binary:!1,access_image_binary:!1,display_media:!1,do_cors:!1,drag_and_drop:!1,resize_image:!1,report_upload_progress:!1,return_response_headers:!1,return_response_type:!1,return_status_code:!0,send_custom_headers:!1,select_folder:!1,select_multiple:!0,send_binary_string:!1,send_browser_cookies:!0,send_multipart:!0,slice_blob:!1,stream_upload:!1,summon_file_dialog:!1,upload_filesize:!0,use_http_method:!0},s);f=function(){var t={};return{exec:function(e,n,r,i){if(f[n]){t[e]||(t[e]={context:this,instance:new f[n]});if(t[e].instance[r])return t[e].instance[r].apply(this,i)}},removeInstance:function(e){delete t[e]},removeAllInstances:function(){var n=this;e.each(t,function(t,r){e.typeOf(t.instance.destroy)==="function"&&t.instance.destroy.call(t.context);n.removeInstance(r)})}}}();e.extend(this,{initialized:!1,uid:l,type:r,shimid:l+"_container",clients:0,options:n,can:function(t,n){var r=arguments[2]||s;e.typeOf(t)==="string"&&e.typeOf(n)==="undefined"&&(t=function(t){var n={};e.each(t,function(e){n[e]=!0});return n}(t.split(",")));if(e.typeOf(t)==="object"){for(var i in t)if(!this.can(i,t[i],r))return!1;return!0}return e.typeOf(r[t])==="function"?r[t].call(this,n):n===r[t]},getMode:function(){return c||!1},getShimContainer:function(){var n,r=t.get(this.shimid);if(!r){n=this.options.container?t.get(this.options.container):document.body;r=document.createElement("div");r.id=this.shimid;r.className="moxie-shim moxie-shim-"+this.type;e.extend(r.style,{position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"});n.appendChild(r);n=null}return r},getShim:function(){return f},shimExec:function(e,t){var n=[].slice.call(arguments,2);return a.getShim().exec.call(this,this.uid,e,t,n)},exec:function(e,t){var n=[].slice.call(arguments,2);return a[e]&&a[e][t]?a[e][t].apply(this,n):a.shimExec.apply(this,arguments)},destroy:function(){if(!a)return;var e=t.get(this.shimid);e&&e.parentNode.removeChild(e);f&&f.removeAllInstances();this.unbindAll();delete i[this.uid];this.uid=null;l=a=f=c=e=null}});h.call(this,o,u)}var r={},i={};s.order="html5,flash,silverlight,html4";s.getRuntime=function(e){return i[e]?i[e]:!1};s.addConstructor=function(e,t){t.prototype=n.instance;r[e]=t};s.getConstructor=function(e){return r[e]||null};s.getInfo=function(e){var t=s.getRuntime(e);return t?{uid:t.uid,type:t.type,can:t.can}:null};s.can=function(e,t){var n,r=s.getConstructor(e),i;if(r){n=new r({required_caps:t});i=n.getMode();n.destroy();return!!i}return!1};s.thatCan=function(e,t){var n=(t||s.order).split(/\s*,\s*/);for(var r in n)if(s.can(n[r],e))return n[r];return null};s.capTrue=function(){return!0};s.capFalse=function(){return!1};s.capTest=function(e){return function(){return!!e}};return s});i("moxie/runtime/RuntimeClient",["moxie/core/Exceptions","moxie/core/utils/Basic","moxie/runtime/Runtime"],function(e,t,n){return function(){var i;t.extend(this,{connectRuntime:function(r){function u(t){var o,a;if(!t.length){s.trigger("RuntimeError",new e.RuntimeError(e.RuntimeError.NOT_INIT_ERR));i=null;return}o=t.shift();a=n.getConstructor(o);if(!a){u(t);return}i=new a(r);i.bind("Init",function(){i.initialized=!0;setTimeout(function(){i.clients++;s.trigger("RuntimeInit",i)},1)});i.bind("Error",function(){i.destroy();u(t)});if(!i.getMode()){i.trigger("Error");return}i.init()}var s=this,o;t.typeOf(r)==="string"?o=r:t.typeOf(r.ruid)==="string"&&(o=r.ruid);if(o){i=n.getRuntime(o);if(i){i.clients++;return i}throw new e.RuntimeError(e.RuntimeError.NOT_INIT_ERR)}u((r.runtime_order||n.order).split(/\s*,\s*/))},getRuntime:function(){if(i&&i.uid)return i;i=null;return null},disconnectRuntime:function(){if(i&&--i.clients<=0){i.destroy();i=null}}})}});i("moxie/file/Blob",["moxie/core/utils/Basic","moxie/core/utils/Encode","moxie/runtime/RuntimeClient"],function(e,t,n){function i(s,o){function u(t,n,s){var o,u=r[this.uid];if(e.typeOf(u)!=="string"||!u.length)return null;o=new i(null,{type:s,size:n-t});o.detach(u.substr(t,o.size));return o}if(s){n.call(this);this.connectRuntime(s)}o?e.typeOf(o)==="string"&&(o={data:o}):o={};e.extend(this,{uid:o.uid||e.guid("uid_"),ruid:s,size:o.size||0,type:o.type||"",slice:function(e,t,n){return this.isDetached()?u.apply(this,arguments):this.getRuntime().exec.call(this,"Blob","slice",this.getSource(),e,t,n)},getSource:function(){return r[this.uid]?r[this.uid]:null},detach:function(e){if(this.ruid){this.getRuntime().exec.call(this,"Blob","destroy",r[this.uid]);this.disconnectRuntime();this.ruid=null}e=e||"";var n=e.match(/^data:([^;]*);base64,/);if(n){this.type=n[1];e=t.atob(e.substring(e.indexOf("base64,")+7))}this.size=e.length;r[this.uid]=e},isDetached:function(){return!this.ruid&&e.typeOf(r[this.uid])==="string"},destroy:function(){this.detach();delete r[this.uid]}});o.data?this.detach(o.data):r[this.uid]=o}var r={};return i});i("moxie/file/File",["moxie/core/utils/Basic","moxie/core/utils/Mime","moxie/file/Blob"],function(e,t,n){function r(r,i){var s,o;i||(i={});i.type&&i.type!==""?o=i.type:o=t.getFileMime(i.name);if(i.name){s=i.name.replace(/\\/g,"/");s=s.substr(s.lastIndexOf("/")+1)}else{var u=o.split("/")[0];s=e.guid((u!==""?u:"file")+"_");t.extensions[o]&&(s+="."+t.extensions[o][0])}n.apply(this,arguments);e.extend(this,{type:o||"",name:s||e.guid("file_"),lastModifiedDate:i.lastModifiedDate||(new Date).toLocaleString()})}r.prototype=n.prototype;return r});i("moxie/file/FileInput",["moxie/core/utils/Basic","moxie/core/utils/Mime","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/core/EventTarget","moxie/core/I18n","moxie/file/File","moxie/runtime/RuntimeClient"],function(e,t,n,r,i,s,o,u){function f(i){var f=this,l,c,h;e.inArray(e.typeOf(i),["string","node"])!==-1&&(i={browse_button:i});c=n.get(i.browse_button);if(!c)throw new r.DOMException(r.DOMException.NOT_FOUND_ERR);h={accept:[{title:s.translate("All Files"),extensions:"*"}],name:"file",multiple:!1,required_caps:!1,container:c.parentNode||document.body};i=typeof i=="object"?e.extend({},h,i):h;typeof i.accept=="string"&&(i.accept=t.mimes2extList(i.accept));l=n.get(i.container);l||(l=document.body);n.getStyle(l,"position")==="static"&&(l.style.position="relative");l=c=null;u.call(f);e.extend(f,{uid:e.guid("uid_"),ruid:null,files:null,init:function(){f.convertEventPropsToHandlers(a);f.bind("RuntimeInit",function(t,r){f.ruid=r.uid;f.bind("Ready",function(){f.trigger("Refresh")},999);f.bind("Change",function(){var t=r.exec.call(f,"FileInput","getFiles");f.files=[];e.each(t,function(e){f.files.push(new o(f.ruid,e))})},999);f.bind("Refresh",function(){var t,s,o,u;o=n.get(i.browse_button);u=n.get(r.shimid);if(o){t=n.getPos(o,n.get(i.container));s=n.getSize(o);u&&e.extend(u.style,{top:t.y+"px",left:t.x+"px",width:s.w+"px",height:s.h+"px"})}u=o=null});r.exec.call(f,"FileInput","init",i)});f.connectRuntime(i)},disable:function(t){var n=this.getRuntime();n&&n.exec.call(this,"FileInput","disable",e.typeOf(t)==="undefined"?!0:t)},refresh:function(){f.trigger("Refresh")},destroy:function(){var t=this.getRuntime();if(t){t.exec.call(this,"FileInput","destroy");this.disconnectRuntime()}e.typeOf(this.files)==="array"&&e.each(this.files,function(e){e.destroy()});this.files=null}})}var a=["ready","change","cancel","mouseenter","mouseleave","mousedown","mouseup"];f.prototype=i.instance;return f});i("moxie/file/FileDrop",["moxie/core/I18n","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/core/utils/Basic","moxie/file/File","moxie/runtime/RuntimeClient","moxie/core/EventTarget","moxie/core/utils/Mime"],function(e,t,n,r,i,s,o,u){function f(n){var o=this,f;typeof n=="string"&&(n={drop_zone:n});f={accept:[{title:e.translate("All Files"),extensions:"*"}],required_caps:{drag_and_drop:!0}};n=typeof n=="object"?r.extend({},f,n):f;n.container=t.get(n.drop_zone)||document.body;t.getStyle(n.container,"position")==="static"&&(n.container.style.position="relative");typeof n.accept=="string"&&(n.accept=u.mimes2extList(n.accept));s.call(o);r.extend(o,{uid:r.guid("uid_"),ruid:null,files:null,init:function(){o.convertEventPropsToHandlers(a);o.bind("RuntimeInit",function(e,t){o.ruid=t.uid;o.bind("Drop",function(){var e=t.exec.call(o,"FileDrop","getFiles");o.files=[];r.each(e,function(e){o.files.push(new i(o.ruid,e))})},999);t.exec.call(o,"FileDrop","init",n);o.dispatchEvent("ready")});o.connectRuntime(n)},destroy:function(){var e=this.getRuntime();if(e){e.exec.call(this,"FileDrop","destroy");this.disconnectRuntime()}this.files=null}})}var a=["ready","dragenter","dragleave","drop","error"];f.prototype=o.instance;return f});i("moxie/file/FileReader",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/core/EventTarget","moxie/runtime/RuntimeClient"],function(e,t,n,r){function s(){function n(e,n){this.readyState=s.EMPTY;this.error=null;if(this.readyState===s.LOADING||!n.ruid||!n.uid)throw new t.DOMException(t.DOMException.INVALID_STATE_ERR);this.convertEventPropsToHandlers(i);this.bind("Error",function(e,t){this.readyState=s.DONE;this.result=null;this.error=t;this.trigger("loadend")},999);this.bind("LoadStart",function(){this.readyState=s.LOADING},999);this.bind("Load",function(){this.readyState=s.DONE;this.trigger("loadend")},999);this.connectRuntime(n.ruid).exec.call(this,"FileReader","read",e,n)}r.call(this);e.extend(this,{uid:e.guid("uid_"),readyState:s.EMPTY,result:null,error:null,readAsBinaryString:function(e){this.result="";n.call(this,"readAsBinaryString",e)},readAsDataURL:function(e){n.call(this,"readAsDataURL",e)},readAsArrayBuffer:function(e){n.call(this,"readAsArrayBuffer",e)},readAsText:function(e){n.call(this,"readAsText",e)},abort:function(){this.result=null;if(!!~e.inArray(this.readyState,[s.EMPTY,s.DONE]))return;this.readyState===s.LOADING&&(this.readyState=s.DONE);var t=this.getRuntime();t&&t.exec.call(this,"FileReader","abort");this.bind("Abort",function(){this.trigger("loadend")})},destroy:function(){this.abort();var e=this.getRuntime();if(e){e.exec.call(this,"FileReader","destroy");this.disconnectRuntime()}}})}var i=["loadstart","progress","load","abort","error","loadend"];s.EMPTY=0;s.LOADING=1;s.DONE=2;s.prototype=n.instance;return s});i("moxie/core/utils/Url",[],function(){var e=function(e){var t=["source","scheme","authority","userInfo","user","pass","host","port","relative","path","directory","file","query","fragment"],n=t.length,r={http:80,https:443},i={},s=/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/,o=s.exec(e||"");while(n--)o[n]&&(i[t[n]]=o[n]);if(/^[^\/]/.test(i.path)&&!i.scheme){var u=document.location.pathname;/(\/|\/[^\.]+)$/.test(u)||(u=u.replace(/[^\/]+$/,""));i.host=document.location.hostname;i.path=u+(i.path||"")}i.scheme||(i.scheme=document.location.protocol.replace(/:$/,""));i.host||(i.host=document.location.hostname);i.port||(i.port=document.location.port||r[i.scheme]||80);i.port=parseInt(i.port,10);i.path||(i.path="/");delete i.source;return i},t=function(t){var n={http:80,https:443},r=e(t);return r.scheme+"://"+r.host+(r.port!==n[r.scheme]?":"+r.port:"")+r.path+(r.query?r.query:"")},n=function(t){function n(e){return[e.scheme,e.host,e.port].join("/")}typeof t=="string"&&(t=e(t));return n(e())===n(t)};return{parseUrl:e,resolveUrl:t,hasSameOrigin:n}});i("moxie/runtime/RuntimeTarget",["moxie/core/utils/Basic","moxie/runtime/RuntimeClient","moxie/core/EventTarget"],function(e,t,n){function r(){this.uid=e.guid("uid_");t.call(this);this.destroy=function(){this.disconnectRuntime();this.unbindAll()}}r.prototype=n.instance;return r});i("moxie/file/FileReaderSync",["moxie/core/utils/Basic","moxie/runtime/RuntimeClient","moxie/core/utils/Encode"],function(e,t,n){return function(){function r(e,t){if(!t.isDetached()){var u=this.connectRuntime(t.ruid).exec.call(this,"FileReaderSync","read",e,t);this.disconnectRuntime();return u}var r=t.getSource();switch(e){case"readAsBinaryString":return r;case"readAsDataURL":return"data:"+t.type+";base64,"+n.btoa(r);case"readAsText":var i="";for(var s=0,o=r.length;s<o;s++)i+=String.fromCharCode(r[s]);return i}}t.call(this);e.extend(this,{uid:e.guid("uid_"),readAsBinaryString:function(e){return r.call(this,"readAsBinaryString",e)},readAsDataURL:function(e){return r.call(this,"readAsDataURL",e)},readAsText:function(e){return r.call(this,"readAsText",e)}})}});i("moxie/xhr/FormData",["moxie/core/Exceptions","moxie/core/utils/Basic","moxie/file/Blob"],function(e,t,n){function r(){var e,r={},i="";t.extend(this,{append:function(i,s){var o=this,u=t.typeOf(s);if(s instanceof n){e&&delete r[e];e=i;r[i]=[s]}else if("array"===u){i+="[]";t.each(s,function(e){o.append.call(o,i,e)})}else if("object"===u)t.each(s,function(e,t){o.append.call(o,i+"["+t+"]",e)});else{s=s.toString();r[i]||(r[i]=[]);r[i].push(s)}},hasBlob:function(){return!!e},getBlob:function(){return r[e]&&r[e][0]||null},getBlobName:function(){return e||null},each:function(e){t.each(r,function(n,r){t.each(n,function(t){e(t,r)})})},destroy:function(){e=null;i="";r={}}})}return r});i("moxie/xhr/XMLHttpRequest",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/core/EventTarget","moxie/core/utils/Encode","moxie/core/utils/Url","moxie/runtime/RuntimeTarget","moxie/file/Blob","moxie/file/FileReaderSync","moxie/xhr/FormData","moxie/core/utils/Env","moxie/core/utils/Mime"],function(e,t,n,r,i,s,o,u,a,f,l){function h(){this.uid=e.guid("uid_")}function m(){function R(e,t){if(!u.hasOwnProperty(e))return;if(arguments.length===1)return f.can("define_property")?u[e]:n[e];f.can("define_property")?u[e]=t:n[e]=t}function U(){return!window.XMLHttpRequest||f.browser==="IE"&&f.version<8?function(){var e=["Msxml2.XMLHTTP.6.0","Microsoft.XMLHTTP"];for(var t=0;t<e.length;t++)try{return new ActiveXObject(e[t])}catch(n){}}():new window.XMLHttpRequest}function z(e){var t=e.responseXML,n=e.responseText;if(f.browser==="IE"&&n&&t&&!t.documentElement&&/[^\/]+\/[^\+]+\+xml/.test(e.getResponseHeader("Content-Type"))){t=new window.ActiveXObject("Microsoft.XMLDOM");t.async=!1;t.validateOnParse=!1;t.loadXML(n)}if(t)if(f.browser==="IE"&&t.parseError!==0||!t.documentElement||t.documentElement.tagName==="parsererror")return null;return t}function W(){var t=this,n=0;q=d;j=U();j.onreadystatechange=function r(){if(R("readyState")>m.HEADERS_RECEIVED){R("status",j.status);R("statusText",j.statusText)}R("readyState",j.readyState);j.readyState!==m.OPENED&&t.dispatchEvent("readystatechange");switch(R("readyState")){case m.OPENED:if(!r.loadstartDispatched){t.dispatchEvent("loadstart");r.loadstartDispatched=!0}break;case m.HEADERS_RECEIVED:try{M&&(n=j.getResponseHeader("Content-Length")||0)}catch(e){}break;case m.LOADING:var i=0;try{j.responseText&&(i=j.responseText.length)}catch(e){i=0}t.dispatchEvent({type:"progress",lengthComputable:!!n,total:parseInt(n,10),loaded:i});break;case m.DONE:j.onreadystatechange=function(){};if(j.status===0){O=!0;t.dispatchEvent("error")}else{R("responseText",j.responseText);R("responseXML",z(j));R("response",R("responseType")==="document"?R("responseXML"):R("responseText"));F=j.getAllResponseHeaders();t.dispatchEvent("load")}j=null;t.dispatchEvent("loadend")}};j.open(b,y,g,E,S);e.isEmptyObj(w)||e.each(w,function(e,t){j.setRequestHeader(t,e)});j.send()}function X(t){function r(){j.destroy();j=null;n.dispatchEvent("loadend");n=null}function i(i){j.bind("LoadStart",function(e){R("readyState",m.LOADING);n.dispatchEvent(e);L&&n.upload.dispatchEvent(e)});j.bind("Progress",function(e){R("readyState",m.LOADING);n.dispatchEvent("readystatechange");n.dispatchEvent(e)});j.bind("UploadProgress",function(e){L&&n.upload.dispatchEvent({type:"progress",lengthComputable:!1,total:e.total,loaded:e.loaded})});j.bind("Load",function(t){R("readyState",m.DONE);R("status",Number(i.exec.call(j,"XMLHttpRequest","getStatus")||0));R("statusText",c[R("status")]||"");R("response",i.exec.call(j,"XMLHttpRequest","getResponse",R("responseType")));~e.inArray(R("responseType"),["text",""])?R("responseText",R("response")):R("responseType")==="document"&&R("responseXML",R("response"));F=i.exec.call(j,"XMLHttpRequest","getAllResponseHeaders");n.dispatchEvent("readystatechange");if(R("status")>0){L&&n.upload.dispatchEvent(t);n.dispatchEvent(t)}else{O=!0;n.dispatchEvent("error")}r()});j.bind("Abort",function(e){n.dispatchEvent(e);r()});j.bind("Error",function(e){O=!0;R("readyState",m.DONE);n.dispatchEvent("readystatechange");A=!0;n.dispatchEvent(e);r()});i.exec.call(j,"XMLHttpRequest","send",{url:y,method:b,async:g,user:E,password:S,headers:w,mimeType:N,encoding:T,responseType:n.responseType,withCredentials:n.withCredentials,options:B},t)}var n=this;q=v;j=new s;B.required_caps=e.extend({},B.required_caps,{return_response_type:n.responseType});if(B.ruid)i(j.connectRuntime(B));else{j.bind("RuntimeInit",function(e,t){i(t)});j.bind("RuntimeError",function(e,t){n.dispatchEvent("RuntimeError",t)});j.connectRuntime(B)}}function V(e){_=(new Date).getTime();$.call(this)?W.call(this,e):X.call(this,e)}function $(){return M&&(b==="HEAD"||b==="GET"&&!!~e.inArray(R("responseType"),["","text","document"])||b==="POST"&&w["Content-Type"]==="application/x-www-form-urlencoded")}function J(){R("responseText","");R("responseXML",null);R("response",null);R("status",0);R("statusText","");_=D=null}var n=this,u={timeout:0,readyState:m.UNSENT,withCredentials:!1,status:0,statusText:"",responseType
:"",responseXML:null,responseText:null,response:null},g=!0,y,b,w={},E,S,T=null,N=null,C=!1,k=!1,L=!1,A=!1,O=!1,M=!1,_,D,P=null,H=null,B={},j,F="",I,q=d;e.extend(this,u,{uid:e.guid("uid_"),upload:new h,open:function(n,s,o,u,a){var f;if(!n||!s)throw new t.DOMException(t.DOMException.SYNTAX_ERR);if(/[\u0100-\uffff]/.test(n)||r.utf8_encode(n)!==n)throw new t.DOMException(t.DOMException.SYNTAX_ERR);!~e.inArray(n.toUpperCase(),["CONNECT","DELETE","GET","HEAD","OPTIONS","POST","PUT","TRACE","TRACK"])||(b=n.toUpperCase());if(!!~e.inArray(b,["CONNECT","TRACE","TRACK"]))throw new t.DOMException(t.DOMException.SECURITY_ERR);s=r.utf8_encode(s);f=i.parseUrl(s);M=i.hasSameOrigin(f);y=i.resolveUrl(s);if((u||a)&&!M)throw new t.DOMException(t.DOMException.INVALID_ACCESS_ERR);E=u||f.user;S=a||f.pass;g=o||!0;if(g===!1&&(R("timeout")||R("withCredentials")||R("responseType")!==""))throw new t.DOMException(t.DOMException.INVALID_ACCESS_ERR);C=!g;k=!1;w={};J.call(this);R("readyState",m.OPENED);this.convertEventPropsToHandlers(["readystatechange"]);this.dispatchEvent("readystatechange")},setRequestHeader:function(n,i){var s=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","content-transfer-encoding","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"];if(R("readyState")!==m.OPENED||k)throw new t.DOMException(t.DOMException.INVALID_STATE_ERR);if(/[\u0100-\uffff]/.test(n)||r.utf8_encode(n)!==n)throw new t.DOMException(t.DOMException.SYNTAX_ERR);n=e.trim(n).toLowerCase();if(!!~e.inArray(n,s)||/^(proxy\-|sec\-)/.test(n))return!1;w[n]?w[n]+=", "+i:w[n]=i;return!0},getAllResponseHeaders:function(){return F||""},getResponseHeader:function(t){t=t.toLowerCase();if(O||!!~e.inArray(t,["set-cookie","set-cookie2"]))return null;if(F&&F!==""){if(!I){I={};e.each(F.split(/\r\n/),function(t){var n=t.split(/:\s+/);if(n.length===2){n[0]=e.trim(n[0]);I[n[0].toLowerCase()]={header:n[0],value:e.trim(n[1])}}})}if(I.hasOwnProperty(t))return I[t].header+": "+I[t].value}return null},overrideMimeType:function(n){var r,i;if(!!~e.inArray(R("readyState"),[m.LOADING,m.DONE]))throw new t.DOMException(t.DOMException.INVALID_STATE_ERR);n=e.trim(n.toLowerCase());if(/;/.test(n)&&(r=n.match(/^([^;]+)(?:;\scharset\=)?(.*)$/))){n=r[1];r[2]&&(i=r[2])}if(!l.mimes[n])throw new t.DOMException(t.DOMException.SYNTAX_ERR);P=n;H=i},send:function(n,i){e.typeOf(i)==="string"?B={ruid:i}:i?B=i:B={};this.convertEventPropsToHandlers(p);this.upload.convertEventPropsToHandlers(p);if(this.readyState!==m.OPENED||k)throw new t.DOMException(t.DOMException.INVALID_STATE_ERR);if(!$())if(n instanceof o){B.ruid=n.ruid;N=n.type}else if(n instanceof a){if(n.hasBlob()){var s=n.getBlob();B.ruid=s.ruid;N=s.type}}else if(typeof n=="string"){T="UTF-8";N="text/plain;charset=UTF-8";n=r.utf8_encode(n)}this.withCredentials||(this.withCredentials=B.required_caps&&B.required_caps.send_browser_cookies&&!M);L=!C&&this.upload.hasEventListener();O=!1;A=!n;if(!C){k=!0;!A}V.call(this,n)},abort:function(){var n;O=!0;C=!1;if(!~e.inArray(R("readyState"),[m.UNSENT,m.OPENED,m.DONE])){R("readyState",m.DONE);k=!1;if(q===d){j.abort();this.dispatchEvent("readystatechange");this.dispatchEvent("abort");this.dispatchEvent("loadend");if(!A){this.upload.dispatchEvent("abort");this.upload.dispatchEvent("loadend")}}else{if(e.typeOf(j.getRuntime)!=="function"||!(n=j.getRuntime()))throw new t.DOMException(t.DOMException.INVALID_STATE_ERR);n.exec.call(j,"XMLHttpRequest","abort",A)}A=!0}else R("readyState",m.UNSENT)},destroy:function(){if(j){e.typeOf(j.destroy)==="function"&&j.destroy();j=null}this.unbindAll();if(this.upload){this.upload.unbindAll();this.upload=null}}})}var c={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",306:"Reserved",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",426:"Upgrade Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",510:"Not Extended"};h.prototype=n.instance;var p=["loadstart","progress","abort","error","load","timeout","loadend"],d=1,v=2;m.UNSENT=0;m.OPENED=1;m.HEADERS_RECEIVED=2;m.LOADING=3;m.DONE=4;m.prototype=n.instance;return m});i("moxie/runtime/Transporter",["moxie/core/utils/Basic","moxie/core/utils/Encode","moxie/runtime/RuntimeClient","moxie/core/EventTarget"],function(e,t,n,r){function i(){function l(){u=a=0;o=this.result=null}function c(t,n){var r=this;s=n;r.bind("TransportingProgress",function(t){a=t.loaded;a<u&&e.inArray(r.state,[i.IDLE,i.DONE])===-1&&h.call(r)},999);r.bind("TransportingComplete",function(){a=u;r.state=i.DONE;o=null;r.result=s.exec.call(r,"Transporter","getAsBlob",t||"")},999);r.state=i.BUSY;r.trigger("TransportingStarted");h.call(r)}function h(){var e=this,n,r=u-a;f>r&&(f=r);n=t.btoa(o.substr(a,f));s.exec.call(e,"Transporter","receive",n,u)}var r,s,o,u,a,f;n.call(this);e.extend(this,{uid:e.guid("uid_"),state:i.IDLE,result:null,transport:function(t,n,i){var s=this;i=e.extend({chunk_size:204798},i);if(r=i.chunk_size%3)i.chunk_size+=3-r;f=i.chunk_size;l.call(this);o=t;u=t.length;if(e.typeOf(i)==="string"||i.ruid)c.call(s,n,this.connectRuntime(i));else{var a=function(e,t){s.unbind("RuntimeInit",a);c.call(s,n,t)};this.bind("RuntimeInit",a);this.connectRuntime(i)}},abort:function(){var e=this;e.state=i.IDLE;if(s){s.exec.call(e,"Transporter","clear");e.trigger("TransportingAborted")}l.call(e)},destroy:function(){this.unbindAll();s=null;this.disconnectRuntime();l.call(this)}})}i.IDLE=0;i.BUSY=1;i.DONE=2;i.prototype=r.instance;return i});i("moxie/core/JSON",[],function(){return!!window.JSON&&JSON.parse||function(){var e,n,r={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"	"},i,s=function(t){throw{name:"SyntaxError",message:t,at:e,text:i}},o=function(t){t&&t!==n&&s("Expected '"+t+"' instead of '"+n+"'");n=i.charAt(e);e+=1;return n},u=function(){var e,t="";if(n==="-"){t="-";o("-")}while(n>="0"&&n<="9"){t+=n;o()}if(n==="."){t+=".";while(o()&&n>="0"&&n<="9")t+=n}if(n==="e"||n==="E"){t+=n;o();if(n==="-"||n==="+"){t+=n;o()}while(n>="0"&&n<="9"){t+=n;o()}}e=+t;if(!!isFinite(e))return e;s("Bad number")},a=function(){var e,t,i="",u;if(n==='"')while(o()){if(n==='"'){o();return i}if(n==="\\"){o();if(n==="u"){u=0;for(t=0;t<4;t+=1){e=parseInt(o(),16);if(!isFinite(e))break;u=u*16+e}i+=String.fromCharCode(u)}else{if(typeof r[n]!="string")break;i+=r[n]}}else i+=n}s("Bad string")},f=function(){while(n&&n<=" ")o()},l=function(){switch(n){case"t":o("t");o("r");o("u");o("e");return!0;case"f":o("f");o("a");o("l");o("s");o("e");return!1;case"n":o("n");o("u");o("l");o("l");return null}s("Unexpected '"+n+"'")},c,h=function(){var e=[];if(n==="["){o("[");f();if(n==="]"){o("]");return e}while(n){e.push(c());f();if(n==="]"){o("]");return e}o(",");f()}}s("Bad array")},p=function(){var e,t={};if(n==="{"){o("{");f();if(n==="}"){o("}");return t}while(n){e=a();f();o(":");Object.hasOwnProperty.call(t,e)&&s('Duplicate key "'+e+'"');t[e]=c();f();if(n==="}"){o("}");return t}o(",");f()}}s("Bad object")};c=function(){f();switch(n){case"{":return p();case"[":return h();case'"':return a();case"-":return u();default:return n>="0"&&n<="9"?u():l()}};return function(r,o){var u;i=r;e=0;n=" ";u=c();f();n&&s("Syntax error");return typeof o=="function"?function a(e,n){var r,i,s=e[n];if(s&&typeof s=="object")for(r in s)if(Object.prototype.hasOwnProperty.call(s,r)){i=a(s,r);i!==t?s[r]=i:delete s[r]}return o.call(e,n,s)}({"":u},""):u}}()});i("moxie/image/Image",["moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/file/FileReaderSync","moxie/xhr/XMLHttpRequest","moxie/runtime/RuntimeClient","moxie/runtime/Transporter","moxie/core/utils/Env","moxie/core/EventTarget","moxie/file/Blob","moxie/file/File","moxie/core/utils/Encode","moxie/core/JSON"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){function d(){function r(t){t||(t=this.getRuntime().exec.call(this,"Image","getInfo"));if(t)if(e.typeOf(t.meta)==="string")try{this.meta=h(t.meta)}catch(n){}else this.meta=t.meta;e.extend(this,{size:parseInt(t.size,10),width:parseInt(t.width,10),height:parseInt(t.height,10),type:t.type});this.name===""&&(this.name=t.name)}function a(t){var r=e.typeOf(t);try{if(t instanceof d){if(!t.size)throw new n.DOMException(n.DOMException.INVALID_STATE_ERR);v.apply(this,arguments)}else if(t instanceof f){if(!~e.inArray(t.type,["image/jpeg","image/png"]))throw new n.ImageError(n.ImageError.WRONG_FORMAT);m.apply(this,arguments)}else if(e.inArray(r,["blob","file"])!==-1)a.call(this,new l(null,t),arguments[1]);else if(r==="string")/^data:[^;]*;base64,/.test(t)?a.call(this,new f(null,{data:t}),arguments[1]):g.apply(this,arguments);else{if(r!=="node"||t.nodeName!=="img")throw new n.DOMException(n.DOMException.TYPE_MISMATCH_ERR);a.call(this,t.src,arguments[1])}}catch(i){this.trigger("error")}}function v(t,n){var r=this.connectRuntime(t.ruid);this.ruid=r.uid;r.exec.call(this,"Image","loadFromImage",t,e.typeOf(n)==="undefined"?!0:n)}function m(t,n){function i(e){r.ruid=e.uid;e.exec.call(r,"Image","loadFromBlob",t)}var r=this;r.name=t.name||"";if(t.isDetached()){this.bind("RuntimeInit",function(e,t){i(t)});this.connectRuntime(e.extend({required_caps:{access_image_binary:!0,resize_image:!0}},n))}else i(this.connectRuntime(t.ruid))}function g(e,t){var n=this,r;r=new i;r.open("get",e);r.responseType="blob";r.onprogress=function(e){n.trigger(e)};r.onload=function(){m.call(n,r.response,!0)};r.onerror=function(e){n.trigger(e)};r.onloadend=function(){r.destroy()};r.bind("RuntimeError",function(e,t){n.trigger("RuntimeError",t)});r.send(null,t)}s.call(this);e.extend(this,{uid:e.guid("uid_"),ruid:null,name:"",size:0,width:0,height:0,type:"",meta:{},clone:function(){this.load.apply(this,arguments)},load:function(){this.bind("Load Resize",function(){r.call(this)},999);this.convertEventPropsToHandlers(p);a.apply(this,arguments)},downsize:function(t,r,i,s){if(!this.size)throw new n.DOMException(n.DOMException.INVALID_STATE_ERR);if(!t&&!r||e.typeOf(i)==="undefined")i=!1;t=t||this.width;r=r||this.height;s=e.typeOf(s)==="undefined"?!0:!!s;this.getRuntime().exec.call(this,"Image","downsize",t,r,i,s)},crop:function(e,t,n){this.downsize(e,t,!0,n)},getAsCanvas:function(){if(!u.can("create_canvas"))throw new n.RuntimeError(n.RuntimeError.NOT_SUPPORTED_ERR);var e=this.connectRuntime(this.ruid);return e.exec.call(this,"Image","getAsCanvas")},getAsBlob:function(e,t){if(!this.size)throw new n.DOMException(n.DOMException.INVALID_STATE_ERR);e||(e="image/jpeg");e==="image/jpeg"&&!t&&(t=90);return this.getRuntime().exec.call(this,"Image","getAsBlob",e,t)},getAsDataURL:function(e,t){if(!this.size)throw new n.DOMException(n.DOMException.INVALID_STATE_ERR);return this.getRuntime().exec.call(this,"Image","getAsDataURL",e,t)},getAsBinaryString:function(e,t){var n=this.getAsDataURL(e,t);return c.atob(n.substring(n.indexOf("base64,")+7))},embed:function(r){function g(){if(u.can("create_canvas")){var t=s.getAsCanvas();if(t){r.appendChild(t);t=null;s.destroy();i.trigger("embedded");return}}var l=s.getAsDataURL(a,f);if(!l)throw new n.ImageError(n.ImageError.WRONG_FORMAT);if(u.can("use_data_uri_of",l.length)){r.innerHTML='<img src="'+l+'" width="'+s.width+'" height="'+s.height+'" />';s.destroy();i.trigger("embedded")}else{var d=new o;d.bind("TransportingComplete",function(){m=i.connectRuntime(this.result.ruid);i.bind("Embedded",function(){e.extend(m.getShimContainer().style,{top:"0px",left:"0px",width:s.width+"px",height:s.height+"px"});m=null},999);m.exec.call(i,"ImageView","display",this.result.uid,p,v);s.destroy()});d.transport(c.atob(l.substring(l.indexOf("base64,")+7)),a,e.extend({},h,{required_caps:{display_media:!0},runtime_order:"flash,silverlight",container:r}))}}var i=this,s,a,f,l,h=arguments[1]||{},p=this.width,v=this.height,m;if(!(r=t.get(r)))throw new n.DOMException(n.DOMException.INVALID_NODE_TYPE_ERR);if(!this.size)throw new n.DOMException(n.DOMException.INVALID_STATE_ERR);a=h.type||this.type||"image/jpeg";f=h.quality||90;l=e.typeOf(h.crop)!=="undefined"?h.crop:!1;if(h.width){p=h.width;v=h.height||p}else{var y=t.getSize(r);if(y.w&&y.h){p=y.w;v=y.h}}s=new d;s.bind("Resize",function(){g.call(i)});s.bind("Load",function(){s.downsize(p,v,l,!1)});s.clone(this,!1);return s},destroy:function(){if(this.ruid){this.getRuntime().exec.call(this,"Image","destroy");this.disconnectRuntime()}this.unbindAll()}})}var p=["progress","load","error","resize","embedded"];d.prototype=a.instance;return d});i("moxie/runtime/html5/Runtime",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/Runtime","moxie/core/utils/Env"],function(e,t,n,r){function o(o){var u=this,a=n.capTest,f=n.capTrue,l=e.extend({access_binary:a(window.FileReader||window.File&&window.File.getAsDataURL),access_image_binary:function(){return u.can("access_binary")&&!!s.Image},display_media:a(r.can("create_canvas")||r.can("use_data_uri_over32kb")),do_cors:a(window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest),drag_and_drop:a(function(){var e=document.createElement("div");return("draggable"in e||"ondragstart"in e&&"ondrop"in e)&&(r.browser!=="IE"||r.version>9)}()),return_response_headers:f,return_response_type:function(e){return e==="json"?!0:r.can("return_response_type",e)},report_upload_progress:a(window.XMLHttpRequest&&(new XMLHttpRequest).upload),resize_image:function(){return u.can("access_binary")&&r.can("create_canvas")},select_folder:a(r.browser==="Chrome"&&r.version>=21),select_multiple:a(r.browser!=="Safari"||r.OS!=="Windows"),send_binary_string:a(window.XMLHttpRequest&&((new XMLHttpRequest).sendAsBinary||window.Uint8Array&&window.ArrayBuffer)),send_custom_headers:a(window.XMLHttpRequest),send_multipart:function(){return!!(window.XMLHttpRequest&&(new XMLHttpRequest).upload&&window.FormData)||u.can("send_binary_string")},slice_blob:a(window.File&&(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice)),stream_upload:function(){return u.can("slice_blob")&&u.can("send_multipart")},summon_file_dialog:a(function(){return r.browser==="Firefox"&&r.version>=4||r.browser==="Opera"&&r.version>=12||r.browser==="IE"&&r.version>=10||!!~e.inArray(r.browser,["Chrome","Safari"])}()),upload_filesize:f},arguments[2]);n.call(this,o,arguments[1]||i,l);e.extend(this,{init:function(){if(!window.File||!r.can("use_fileinput")){this.trigger("Error",new t.RuntimeError(t.RuntimeError.NOT_INIT_ERR));return}this.trigger("Init")},destroy:function(e){return function(){e.call(u);e=u=null}}(this.destroy)});e.extend(this.getShim(),s)}var i="html5",s={};n.addConstructor(i,o);return s});i("moxie/runtime/html5/file/Blob",["moxie/runtime/html5/Runtime","moxie/file/Blob"],function(e,t){function n(){function e(e,t,n){var r;if(!window.File.prototype.slice)return(r=window.File.prototype.webkitSlice||window.File.prototype.mozSlice)?r.call(e,t,n):null;try{e.slice();return e.slice(t,n)}catch(i){return e.slice(t,n-t)}}this.slice=function(){return new t(this.getRuntime().uid,e.apply(this,arguments))}}return e.Blob=n});i("moxie/core/utils/Events",["moxie/core/utils/Basic"],function(e){function r(){this.returnValue=!1}function i(){this.cancelBubble=!0}var t={},n="moxie_"+e.guid(),s=function(s,o,u,a){var f,l;o=o.toLowerCase();if(s.addEventListener){f=u;s.addEventListener(o,f,!1)}else if(s.attachEvent){f=function(){var e=window.event;e.target||(e.target=e.srcElement);e.preventDefault=r;e.stopPropagation=i;u(e)};s.attachEvent("on"+o,f)}s[n]||(s[n]=e.guid());t.hasOwnProperty(s[n])||(t[s[n]]={});l=t[s[n]];l.hasOwnProperty(o)||(l[o]=[]);l[o].push({func:f,orig:u,key:a})},o=function(r,i,s){var o,u;i=i.toLowerCase();if(!(r[n]&&t[r[n]]&&t[r[n]][i]))return;o=t[r[n]][i];for(var a=o.length-1;a>=0;a--)if(o[a].orig===s||o[a].key===s){r.removeEventListener?r.removeEventListener(i,o[a].func,!1):r.detachEvent&&r.detachEvent("on"+i,o[a].func);o[a].orig=null;o[a].func=null;o.splice(a,1);if(s!==u)break}o.length||delete t[r[n]][i];if(e.isEmptyObj(t[r[n]])){delete t[r[n]];try{delete r[n]}catch(f){r[n]=u}}},u=function(r,i){if(!r||!r[n])return;e.each(t[r[n]],function(e,t){o(r,t,i)})};return{addEvent:s,removeEvent:o,removeAllEvents:u}});i("moxie/runtime/html5/file/FileInput",["moxie/runtime/html5/Runtime","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Events","moxie/core/utils/Mime"],function(e,t,n,r,i){function s(){var e=[],s;t.extend(this,{init:function(o){var u=this,a=u.getRuntime(),f,l,c;s=o;e=[];c=s.accept.mimes||i.extList2mimes(s.accept);l=a.getShimContainer();l.innerHTML='<input id="'+a.uid+'" type="file" style="font-size:999px;opacity:0;"'+(s.multiple&&a.can("select_multiple")?"multiple":"")+(s.directory&&a.can("select_folder")?"webkitdirectory directory":"")+' accept="'+c.join(",")+'" />';f=n.get(a.uid);t.extend(f.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"});(function(){var e,t,i;e=n.get(s.browse_button);if(a.can("summon_file_dialog")){n.getStyle(e,"position")==="static"&&(e.style.position="relative");t=parseInt(n.getStyle(e,"z-index"),10)||1;e.style.zIndex=t;l.style.zIndex=t-1;r.addEvent(e,"click",function(e){f&&!f.disabled&&f.click();e.preventDefault()},u.uid)}i=a.can("summon_file_dialog")?e:l;r.addEvent(i,"mouseover",function(){u.trigger("mouseenter")},u.uid);r.addEvent(i,"mouseout",function(){u.trigger("mouseleave")},u.uid);r.addEvent(i,"mousedown",function(){u.trigger("mousedown")},u.uid);r.addEvent(n.get(s.container),"mouseup",function(){u.trigger("mouseup")},u.uid)})();f.onchange=function(){e=[];s.directory?t.each(this.files,function(t){t.name!=="."&&e.push(t)}):e=[].slice.call(this.files);this.value="";u.trigger("change")};u.trigger({type:"ready",async:!0})},getFiles:function(){return e},disable:function(e){var t=this.getRuntime(),r;if(r=n.get(t.uid))r.disabled=!!e},destroy:function(){var t=this.getRuntime(),i=t.getShimContainer();r.removeAllEvents(i,this.uid);r.removeAllEvents(s&&n.get(s.container),this.uid);r.removeAllEvents(s&&n.get(s.browse_button),this.uid);i&&(i.innerHTML="");e=s=null}})}return e.FileInput=s});i("moxie/runtime/html5/file/FileDrop",["moxie/runtime/html5/Runtime","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Events","moxie/core/utils/Mime"],function(e,t,n,r,i){function s(){function o(e){var n=s.accept.mimes||i.extList2mimes(s.accept),r=e.type||i.getFileMime(e.name)||"";return!n.length||t.inArray(r,n)!==-1?!0:!1}function u(e,n){var r=[];t.each(e,function(e){r.push(function(t){a(e,t)})});t.inSeries(r,function(){n()})}function a(t,n){t.isFile?t.file(function(t){o(t)&&e.push(t);n()},function(){n()}):t.isDirectory?f(t,n):n()}function f(e,t){function i(e){r.readEntries(function(t){if(t.length){[].push.apply(n,t);i(e)}else e()},e)}var n=[],r=e.createReader();i(function(){u(n,t)})}var e=[],s;t.extend(this,{init:function(n){var i=this,a;s=n;a=s.container;r.addEvent(a,"dragover",function(e){e.preventDefault();e.stopPropagation();e.dataTransfer.dropEffect="copy"},i.uid);r.addEvent(a,"drop",function(n){n.preventDefault();n.stopPropagation();e=[];if(n.dataTransfer.items&&n.dataTransfer.items[0].webkitGetAsEntry){var r=[];t.each(n.dataTransfer.items,function(e){r.push(e.webkitGetAsEntry())});u(r,function(){i.trigger("drop")})}else{t.each(n.dataTransfer.files,function(t){o(t)&&e.push(t)});i.trigger("drop")}},i.uid);r.addEvent(a,"dragenter",function(e){e.preventDefault();e.stopPropagation();i.trigger("dragenter")},i.uid);r.addEvent(a,"dragleave",function(e){e.preventDefault();e.stopPropagation();i.trigger("dragleave")},i.uid)},getFiles:function(){return e},destroy:function(){r.removeAllEvents(s&&n.get(s.container),this.uid);e=s=null}})}return e.FileDrop=s});i("moxie/runtime/html5/file/FileReader",["moxie/runtime/html5/Runtime","moxie/core/utils/Basic"],function(e,t){function n(){this.read=function(e,n){var r=this,i=new window.FileReader;(function(){function n(e){!~t.inArray(e.type,["progress","load"])||(r.result=i.result);r.trigger(e)}function s(){t.each(e,function(e){i.removeEventListener(e,n)});i.removeEventListener("loadend",s)}var e=["loadstart","progress","load","abort","error"];t.each(e,function(e){i.addEventListener(e,n)});i.addEventListener("loadend",s)})();t.typeOf(i[e])==="function"&&i[e](n.getSource())}}return e.FileReader=n});i("moxie/runtime/html5/xhr/XMLHttpRequest",["moxie/runtime/html5/Runtime","moxie/core/utils/Basic","moxie/file/File","moxie/file/Blob","moxie/xhr/FormData","moxie/core/Exceptions","moxie/core/utils/Env","moxie/core/JSON"],function(e,t,n,r,i,s,o,u){function a(){function l(e){var t="----moxieboundary"+(new Date).getTime(),n="--",i="\r\n",o="",u=this.getRuntime();if(!u.can("send_binary_string"))throw new s.RuntimeError(s.RuntimeError.NOT_SUPPORTED_ERR);a.setRequestHeader("Content-Type","multipart/form-data; boundary="+t);e.each(function(e,s){e instanceof r?o+=n+t+i+'Content-Disposition: form-data; name="'+s+'"; filename="'+unescape(encodeURIComponent(e.name||"blob"))+'"'+i+"Content-Type: "+e.type+i+i+e.getSource()+i:o+=n+t+i+'Content-Disposition: form-data; name="'+s+'"'+i+i+unescape(encodeURIComponent(e))+i});o+=n+t+n+i;return o}var e=this,a,f;t.extend(this,{send:function(n,s){var u=this,c=!1,h,p,d,v=o.browser==="Mozilla"&&o.version>=4&&o.version<7,m=o.browser==="Android Browser";if((v||m)&&s instanceof i&&s.hasBlob()&&!s.getBlob().isDetached()){p=s.getBlob().getSource();if(p instanceof window.Blob&&window.FileReader){d=new window.FileReader;d.onload=function(){s.append(s.getBlobName(),new r(null,{type:p.type,data:d.result}));e.send.call(u,n,s)};d.readAsBinaryString(p);return}}a=new window.XMLHttpRequest;f=n.url.replace(/^.+?\/([\w\-\.]+)$/,"$1").toLowerCase();a.open(n.method,n.url,n.async,n.user,n.password);t.isEmptyObj(n.headers)||t.each(n.headers,function(e,t){a.setRequestHeader(t,e)});""!==n.responseType&&("json"===n.responseType&&!o.can("return_response_type","json")?a.responseType="text":a.responseType=n.responseType);n.withCredentials&&(a.withCredentials=!0);(function(){function n(e){u.trigger(e)}function r(e){u.trigger({type:"UploadProgress",loaded:e.loaded,total:e.total})}function i(){t.each(e,function(e){a.removeEventListener(e,n)});a.removeEventListener("loadend",i);a.upload&&a.upload.removeEventListener("progress",r);a=null}var e=["loadstart","progress","abort","error","load","timeout"];t.each(e,function(e){a.addEventListener(e,n)});a.upload&&a.upload.addEventListener("progress",r);a.addEventListener("loadend",i)})();if(s instanceof r){s.isDetached()&&(c=!0);s=s.getSource()}else if(s instanceof i)if(s.hasBlob()&&s.getBlob().isDetached()){s=l.call(u,s);c=!0}else{h=new window.FormData;s.each(function(e,t){e instanceof r?h.append(t,e.getSource()):h.append(t,e)});s=h}c?a.sendAsBinary?a.sendAsBinary(s):function(){var e=new Uint8Array(s.length);for(var t=0;t<s.length;t++)e[t]=s.charCodeAt(t)&255;a.send(e.buffer)}():a.send(s)},getStatus:function(){try{if(a)return a.status}catch(e){}},getResponse:function(e){var t=this.getRuntime();try{if(a){if("blob"===e){var r=new n(t.uid,a.response);try{var i=a.getResponseHeader("Content-Disposition");if(i){var s=i.match(/filename=([\'\"'])([^\1]+)\1/);s&&(f=s[2])}}catch(l){}r.name=f;return r}return"json"===e&&!o.can("return_response_type","json")?a.status===200?u(a.response):null:a.response}}catch(l){}},getAllResponseHeaders:function(){try{return a.getAllResponseHeaders()}catch(e){}return""},abort:function(){a&&a.abort()},destroy:function(){e=f=null}})}return e.XMLHttpRequest=a});i("moxie/runtime/html5/utils/BinaryReader",[],function(){return function(){function r(t,r){var i=e?0:-8*(r-1),s=0,o;for(o=0;o<r;o++)s|=n.charCodeAt(t+o)<<Math.abs(i+o*8);return s}function i(e,t,r){r=arguments.length===3?r:n.length-t-1;n=n.substr(0,t)+e+n.substr(r+t)}function s(t,n,r){var s="",o=e?0:-8*(r-1),u;for(u=0;u<r;u++)s+=String.fromCharCode(n>>Math.abs(o+u*8)&255);i(s,t,r)}var e=!1,n;return{II:function(n){if(n===t)return e;e=n},init:function(t){e=!1;n=t},SEGMENT:function(e,t,r){switch(arguments.length){case 1:return n.substr(e,n.length-e-1);case 2:return n.substr(e,t);case 3:i(r,e,t);break;default:return n}},BYTE:function(e){return r(e,1)},SHORT:function(e){return r(e,2)},LONG:function(e,n){if(n===t)return r(e,4);s(e,n,4)},SLONG:function(e){var t=r(e,4);return t>2147483647?t-4294967296:t},STRING:function(e,t){var n="";for(t+=e;e<t;e++)n+=String.fromCharCode(r(e,1));return n}}}});i("moxie/runtime/html5/image/JPEGHeaders",["moxie/runtime/html5/utils/BinaryReader"],function(e){return function t(n){var r=[],i,s,o,u=0;i=new e;i.init(n);if(i.SHORT(0)!==65496)return;s=2;while(s<=n.length){o=i.SHORT(s);if(o>=65488&&o<=65495){s+=2;continue}if(o===65498||o===65497)break;u=i.SHORT(s+2)+2;o>=65505&&o<=65519&&r.push({hex:o,name:"APP"+(o&15),start:s,length:u,segment:i.SEGMENT(s,u)});s+=u}i.init(null);return{headers:r,restore:function(e){var t,n;i.init(e);s=i.SHORT(2)==65504?4+i.SHORT(4):2;for(n=0,t=r.length;n<t;n++){i.SEGMENT(s,0,r[n].segment);s+=r[n].length}e=i.SEGMENT();i.init(null);return e},strip:function(e){var n,r,s;r=new t(e);n=r.headers;r.purge();i.init(e);s=n.length;while(s--)i.SEGMENT(n[s].start,n[s].length,"");e=i.SEGMENT();i.init(null);return e},get:function(e){var t=[];for(var n=0,i=r.length;n<i;n++)r[n].name===e.toUpperCase()&&t.push(r[n].segment);return t},set:function(e,t){var n=[],i,s,o;typeof t=="string"?n.push(t):n=t;for(i=s=0,o=r.length;i<o;i++){if(r[i].name===e.toUpperCase()){r[i].segment=n[s];r[i].length=n[s].length;s++}if(s>=n.length)break}},purge:function(){r=[];i.init(null);i=null}}}});i("moxie/runtime/html5/image/ExifParser",["moxie/core/utils/Basic","moxie/runtime/html5/utils/BinaryReader"],function(e,n){return function(){function f(e,n){var r=i.SHORT(e),s,o,f,l,c,h,p,d,v=[],m={};for(s=0;s<r;s++){p=h=e+12*s+2;f=n[i.SHORT(p)];if(f===t)continue;l=i.SHORT(p+=2);c=i.LONG(p+=2);p+=4;v=[];switch(l){case 1:case 7:c>4&&(p=i.LONG(p)+u.tiffHeader);for(o=0;o<c;o++)v[o]=i.BYTE(p+o);break;case 2:c>4&&(p=i.LONG(p)+u.tiffHeader);m[f]=i.STRING(p,c-1);continue;case 3:c>2&&(p=i.LONG(p)+u.tiffHeader);for(o=0;o<c;o++)v[o]=i.SHORT(p+o*2);break;case 4:c>1&&(p=i.LONG(p)+u.tiffHeader);for(o=0;o<c;o++)v[o]=i.LONG(p+o*4);break;case 5:p=i.LONG(p)+u.tiffHeader;for(o=0;o<c;o++)v[o]=i.LONG(p+o*4)/i.LONG(p+o*4+4);break;case 9:p=i.LONG(p)+u.tiffHeader;for(o=0;o<c;o++)v[o]=i.SLONG(p+o*4);break;case 10:p=i.LONG(p)+u.tiffHeader;for(o=0;o<c;o++)v[o]=i.SLONG(p+o*4)/i.SLONG(p+o*4+4);break;default:continue}d=c==1?v[0]:v;a.hasOwnProperty(f)&&typeof d!="object"?m[f]=a[f][d]:m[f]=d}return m}function l(){var e=u.tiffHeader;i.II(i.SHORT(e)==18761);if(i.SHORT(e+=2)!==42)return!1;u.IFD0=u.tiffHeader+i.LONG(e+=2);o=f(u.IFD0,s.tiff);if("ExifIFDPointer"in o){u.exifIFD=u.tiffHeader+o.ExifIFDPointer;delete o.ExifIFDPointer}if("GPSInfoIFDPointer"in o){u.gpsIFD=u.tiffHeader+o.GPSInfoIFDPointer;delete o.GPSInfoIFDPointer}return!0}function c(e,t,n){var r,o,a,f=0;if(typeof t=="string"){var l=s[e.toLowerCase()];for(var c in l)if(l[c]===t){t=c;break}}r=u[e.toLowerCase()+"IFD"];o=i.SHORT(r);for(var h=0;h<o;h++){a=r+12*h+2;if(i.SHORT(a)==t){f=a+8;break}}if(!f)return!1;i.LONG(f,n);return!0}var i,s,o,u={},a;i=new n;s={tiff:{274:"Orientation",270:"ImageDescription",271:"Make",272:"Model",305:"Software",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"}};a={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire.",1:"Flash fired.",5:"Strobe return light not detected.",7:"Strobe return light detected.",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}};return{init:function(e){u={tiffHeader:10};if(e===t||!e.length)return!1;i.init(e);return i.SHORT(0)===65505&&i.STRING(4,5).toUpperCase()==="EXIF\0"?l():!1},TIFF:function(){return o},EXIF:function(){var t;t=f(u.exifIFD,s.exif);if(t.ExifVersion&&e.typeOf(t.ExifVersion)==="array"){for(var n=0,r="";n<t.ExifVersion.length;n++)r+=String.fromCharCode(t.ExifVersion[n]);t.ExifVersion=r}return t},GPS:function(){var t;t=f(u.gpsIFD,s.gps);t.GPSVersionID&&e.typeOf(t.GPSVersionID)==="array"&&(t.GPSVersionID=t.GPSVersionID.join("."));return t},setExif:function(e,t){return e!=="PixelXDimension"&&e!=="PixelYDimension"?!1:c("exif",e,t)},getBinary:function(){return i.SEGMENT()},purge:function(){i.init(null);i=o=null;u={}}}}});i("moxie/runtime/html5/image/JPEG",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/html5/image/JPEGHeaders","moxie/runtime/html5/utils/BinaryReader","moxie/runtime/html5/image/ExifParser"],function(e,t,n,r,i){function s(s){function h(){var e=0,t,n;while(e<=o.length){t=u.SHORT(e+=2);if(t>=65472&&t<=65475){e+=5;return{height:u.SHORT(e),width:u.SHORT(e+=2)}}n=u.SHORT(e+=2);e+=n-2}return null}function p(){if(!f||!a||!u)return;f.purge();a.purge();u.init(null);o=l=a=f=u=null}var o,u,a,f,l,c;o=s;u=new r;u.init(o);if(u.SHORT(0)!==65496)throw new t.ImageError(t.ImageError.WRONG_FORMAT);a=new n(s);f=new i;c=!!f.init(a.get("app1")[0]);l=h.call(this);e.extend(this,{type:"image/jpeg",size:o.length,width:l&&l.width||0,height:l&&l.height||0,setExif:function(t,n){if(!c)return!1;e.typeOf(t)==="object"?e.each(t,function(e,t){f.setExif(t,e)}):f.setExif(t,n);a.set("app1",f.getBinary())},writeHeaders:function(){return arguments.length?a.restore(arguments[0]):o=a.restore(o)},stripHeaders:function(e){return a.strip(e)},purge:function(){p.call(this)}});c&&(this.meta={tiff:f.TIFF(),exif:f.EXIF(),gps:f.GPS()})}return s});i("moxie/runtime/html5/image/PNG",["moxie/core/Exceptions","moxie/core/utils/Basic","moxie/runtime/html5/utils/BinaryReader"],function(e,t,n){function r(r){function f(){
var e,t;e=c.call(this,8);if(e.type=="IHDR"){t=e.start;return{width:s.LONG(t),height:s.LONG(t+=4)}}return null}function l(){if(!s)return;s.init(null);i=a=o=u=s=null}function c(e){var t,n,r,i;t=s.LONG(e);n=s.STRING(e+=4,4);r=e+=4;i=s.LONG(e+t);return{length:t,type:n,start:r,CRC:i}}var i,s,o,u,a;i=r;s=new n;s.init(i);(function(){var t=0,n=0,r=[35152,20039,3338,6666];for(n=0;n<r.length;n++,t+=2)if(r[n]!=s.SHORT(t))throw new e.ImageError(e.ImageError.WRONG_FORMAT)})();a=f.call(this);t.extend(this,{type:"image/png",size:i.length,width:a.width,height:a.height,purge:function(){l.call(this)}});l.call(this)}return r});i("moxie/runtime/html5/image/ImageInfo",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/html5/image/JPEG","moxie/runtime/html5/image/PNG"],function(e,t,n,r){return function(i){var s=[n,r],o;o=function(){for(var e=0;e<s.length;e++)try{return new s[e](i)}catch(n){}throw new t.ImageError(t.ImageError.WRONG_FORMAT)}();e.extend(this,{type:"",size:0,width:0,height:0,setExif:function(){},writeHeaders:function(e){return e},stripHeaders:function(e){return e},purge:function(){}});e.extend(this,o);this.purge=function(){o.purge();o=null}}});i("moxie/runtime/html5/image/MegaPixel",[],function(){function e(e,r,i){var s=e.naturalWidth,o=e.naturalHeight,u=i.width,a=i.height,f=i.x||0,l=i.y||0,c=r.getContext("2d");if(t(e)){s/=2;o/=2}var h=1024,p=document.createElement("canvas");p.width=p.height=h;var d=p.getContext("2d"),v=n(e,s,o),m=0;while(m<o){var g=m+h>o?o-m:h,y=0;while(y<s){var b=y+h>s?s-y:h;d.clearRect(0,0,h,h);d.drawImage(e,-y,-m);var w=y*u/s+f<<0,E=Math.ceil(b*u/s),S=m*a/o/v+l<<0,x=Math.ceil(g*a/o/v);c.drawImage(p,0,0,b,g,w,S,E,x);y+=h}m+=h}p=d=null}function t(e){var t=e.naturalWidth,n=e.naturalHeight;if(t*n>1048576){var r=document.createElement("canvas");r.width=r.height=1;var i=r.getContext("2d");i.drawImage(e,-t+1,0);return i.getImageData(0,0,1,1).data[3]===0}return!1}function n(e,t,n){var r=document.createElement("canvas");r.width=1;r.height=n;var i=r.getContext("2d");i.drawImage(e,0,0);var s=i.getImageData(0,0,1,n).data,o=0,u=n,a=n;while(a>o){var f=s[(a-1)*4+3];f===0?u=a:o=a;a=u+o>>1}r=null;var l=a/n;return l===0?1:l}return{isSubsampled:t,renderTo:e}});i("moxie/runtime/html5/image/Image",["moxie/runtime/html5/Runtime","moxie/core/utils/Basic","moxie/core/Exceptions","moxie/core/utils/Encode","moxie/file/Blob","moxie/runtime/html5/image/ImageInfo","moxie/runtime/html5/image/MegaPixel","moxie/core/utils/Mime","moxie/core/utils/Env"],function(e,t,n,r,i,s,o,u,a){function f(){function m(){if(!c&&!f)throw new n.ImageError(n.DOMException.INVALID_STATE_ERR);return c||f}function g(e){return r.atob(e.substring(e.indexOf("base64,")+7))}function y(e,t){return"data:"+(t||"")+";base64,"+r.btoa(e)}function b(e){var t=this;f=new Image;f.onerror=function(){N.call(this);throw new n.ImageError(n.ImageError.WRONG_FORMAT)};f.onload=function(){t.trigger("load")};f.src=/^data:[^;]*;base64,/.test(e)?e:y(e,p.type)}function w(e,t){var n;if(!window.FileReader)return t(e.getAsDataURL());n=new FileReader;n.onload=function(){t(this.result)};n.readAsDataURL(e)}function E(e,n,r,i){var s=this,o,u,a,f,l,h,p,g,y;v=i;y=this.meta&&this.meta.tiff&&this.meta.tiff.Orientation||1;if(t.inArray(y,[5,6,7,8])!==-1){var b=e;e=n;n=b}h=m();a=r?Math.max:Math.min;u=a(e/h.width,n/h.height);if(u>1&&(!r||i)){this.trigger("Resize");return}p=Math.round(h.width*u);g=Math.round(h.height*u);c||(c=document.createElement("canvas"));o=c.getContext("2d");if(r){c.width=e;c.height=n}else{c.width=p;c.height=g}f=p>c.width?Math.round((p-c.width)/2):0;l=g>c.height?Math.round((g-c.height)/2):0;v||T(c.width,c.height,y);S.call(this,h,c,-f,-l,p,g);this.width=c.width;this.height=c.height;d=!0;s.trigger("Resize")}function S(e,t,n,r,i,s){if(a.OS==="iOS")o.renderTo(e,t,{width:i,height:s,x:n,y:r});else{var u=t.getContext("2d");u.drawImage(e,n,r,i,s)}}function T(e,t,n){switch(n){case 5:case 6:case 7:case 8:c.width=t;c.height=e;break;default:c.width=e;c.height=t}var r=c.getContext("2d");switch(n){case 2:r.translate(e,0);r.scale(-1,1);break;case 3:r.translate(e,t);r.rotate(Math.PI);break;case 4:r.translate(0,t);r.scale(1,-1);break;case 5:r.rotate(.5*Math.PI);r.scale(1,-1);break;case 6:r.rotate(.5*Math.PI);r.translate(0,-t);break;case 7:r.rotate(.5*Math.PI);r.translate(e,-t);r.scale(-1,1);break;case 8:r.rotate(-0.5*Math.PI);r.translate(-e,0)}}function N(){if(l){l.purge();l=null}h=f=c=null;d=!1}var e=this,f,l,c,h,p,d=!1,v=!0;t.extend(this,{loadFromBlob:function(e){var t=this,r=t.getRuntime(),i=arguments.length>1?arguments[1]:!0;if(!r.can("access_binary"))throw new n.RuntimeError(n.RuntimeError.NOT_SUPPORTED_ERR);if(e.isDetached()){p={name:e.name,size:e.size,type:e.type};h=e.getSource();b.call(this,h);return}p=e.getSource();w(p,function(e){i&&(h=g(e));b.call(t,e)})},loadFromImage:function(e,t){this.meta=e.meta;p={name:e.name,size:e.size,type:e.type};b.call(this,t?h=e.getAsBinaryString():e.getAsDataURL())},getInfo:function(){var e=this.getRuntime(),t;!l&&h&&e.can("access_image_binary")&&(l=new s(h));t={width:m().width||0,height:m().height||0,type:p.type||u.getFileMime(p.name),size:h&&h.length||p.size||0,name:p.name||"",meta:l&&l.meta||this.meta||{}};return t},downsize:function(){E.apply(this,arguments)},getAsCanvas:function(){c&&(c.id=this.uid+"_canvas");return c},getAsBlob:function(t,n){t!==this.type&&E.call(this,this.width,this.height,!1);return new i(null,{type:t,data:e.getAsBinaryString.call(this,t,n)})},getAsDataURL:function(e){var t=arguments[1]||90;if(!d)return f.src;if("image/jpeg"!==e)return c.toDataURL("image/png");try{return c.toDataURL("image/jpeg",t/100)}catch(n){return c.toDataURL("image/jpeg")}},getAsBinaryString:function(t,n){if(!d){h||(h=g(e.getAsDataURL(t,n)));return h}if("image/jpeg"!==t)h=g(e.getAsDataURL(t,n));else{var r;n||(n=90);try{r=c.toDataURL("image/jpeg",n/100)}catch(i){r=c.toDataURL("image/jpeg")}h=g(r);if(l){h=l.stripHeaders(h);if(v){l.meta&&l.meta.exif&&l.setExif({PixelXDimension:this.width,PixelYDimension:this.height});h=l.writeHeaders(h)}l.purge();l=null}}d=!1;return h},destroy:function(){e=null;N.call(this);this.getRuntime().getShim().removeInstance(this.uid)}})}return e.Image=f});i("moxie/runtime/flash/Runtime",["moxie/core/utils/Basic","moxie/core/utils/Env","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/runtime/Runtime"],function(e,t,n,r,i){function u(u){function l(){var e;try{e=navigator.plugins["Shockwave Flash"];e=e.description}catch(t){try{e=(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")}catch(n){e="0.0"}}e=e.match(/\d+/g);return parseFloat(e[0]+"."+e[1])}var a=this,f;u=e.extend({swf_url:t.swf_url},u);i.call(this,u,s,{access_binary:function(e){return e&&a.getMode()==="browser"},access_image_binary:function(e){return e&&a.getMode()==="browser"},display_media:i.capTrue,do_cors:i.capTrue,drag_and_drop:!1,report_upload_progress:function(){return a.getMode()==="client"},resize_image:i.capTrue,return_response_headers:!1,return_response_type:function(t){return!e.arrayDiff(t,["","text","json","document"])||a.getMode()==="browser"},return_status_code:function(t){return a.getMode()==="browser"||!e.arrayDiff(t,[200,404])},select_multiple:i.capTrue,send_binary_string:function(e){return e&&a.getMode()==="browser"},send_browser_cookies:function(e){return e&&a.getMode()==="browser"},send_custom_headers:function(e){return e&&a.getMode()==="browser"},send_multipart:i.capTrue,slice_blob:i.capTrue,stream_upload:function(e){return e&&a.getMode()==="browser"},summon_file_dialog:!1,upload_filesize:function(t){return e.parseSizeStr(t)<=2097152||a.getMode()==="client"},use_http_method:function(t){return!e.arrayDiff(t,["GET","POST"])}},{access_binary:!1,access_image_binary:!1,return_response_type:function(t){return!e.arrayDiff(t,["","text","json","document"])},return_status_code:function(t){return!e.arrayDiff(t,[200,404])},send_binary_string:!1,send_browser_cookies:!1,send_custom_headers:!1,stream_upload:!0,upload_filesize:function(t){return e.parseSizeStr(t)>=2097152}},"client");e.extend(this,{getShim:function(){return n.get(this.uid)},shimExec:function(e,t){var n=[].slice.call(arguments,2);return a.getShim().exec(this.uid,e,t,n)},init:function(){var n,i,s;if(l()<10){this.trigger("Error",new r.RuntimeError(r.RuntimeError.NOT_INIT_ERR));return}s=this.getShimContainer();e.extend(s.style,{position:"absolute",top:"-8px",left:"-8px",width:"9px",height:"9px",overflow:"hidden"});n='<object id="'+this.uid+'" type="application/x-shockwave-flash" data="'+u.swf_url+'" ';t.browser==="IE"&&(n+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" ');n+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+u.swf_url+'" />'+'<param name="flashvars" value="uid='+escape(this.uid)+"&target="+t.global_event_dispatcher+'" />'+'<param name="wmode" value="transparent" />'+'<param name="allowscriptaccess" value="always" />'+"</object>";if(t.browser==="IE"){i=document.createElement("div");s.appendChild(i);i.outerHTML=n;i=s=null}else s.innerHTML=n;f=setTimeout(function(){a&&!a.initialized&&a.trigger("Error",new r.RuntimeError(r.RuntimeError.NOT_INIT_ERR))},5e3)},destroy:function(e){return function(){e.call(a);clearTimeout(f);u=f=e=a=null}}(this.destroy)},o)}var s="flash",o={};i.addConstructor(s,u);return o});i("moxie/runtime/flash/file/Blob",["moxie/runtime/flash/Runtime","moxie/file/Blob"],function(e,t){var n={slice:function(e,n,r,i){var s=this.getRuntime();n<0?n=Math.max(e.size+n,0):n>0&&(n=Math.min(n,e.size));r<0?r=Math.max(e.size+r,0):r>0&&(r=Math.min(r,e.size));e=s.shimExec.call(this,"Blob","slice",n,r,i||"");e&&(e=new t(s.uid,e));return e}};return e.Blob=n});i("moxie/runtime/flash/file/FileInput",["moxie/runtime/flash/Runtime"],function(e){var t={init:function(e){this.getRuntime().shimExec.call(this,"FileInput","init",{name:e.name,accept:e.accept,multiple:e.multiple});this.trigger("ready")}};return e.FileInput=t});i("moxie/runtime/flash/file/FileReader",["moxie/runtime/flash/Runtime","moxie/core/utils/Encode"],function(e,t){function n(e,n){switch(n){case"readAsText":return t.atob(e,"utf8");case"readAsBinaryString":return t.atob(e);case"readAsDataURL":return e}return null}var r={read:function(e,t){var r=this,i=r.getRuntime();e==="readAsDataURL"&&(r.result="data:"+(t.type||"")+";base64,");r.bind("Progress",function(t,i){i&&(r.result+=n(i,e))},999);return i.shimExec.call(this,"FileReader","readAsBase64",t.uid)}};return e.FileReader=r});i("moxie/runtime/flash/file/FileReaderSync",["moxie/runtime/flash/Runtime","moxie/core/utils/Encode"],function(e,t){function n(e,n){switch(n){case"readAsText":return t.atob(e,"utf8");case"readAsBinaryString":return t.atob(e);case"readAsDataURL":return e}return null}var r={read:function(e,t){var r,i=this.getRuntime();r=i.shimExec.call(this,"FileReaderSync","readAsBase64",t.uid);if(!r)return null;e==="readAsDataURL"&&(r="data:"+(t.type||"")+";base64,"+r);return n(r,e,t.type)}};return e.FileReaderSync=r});i("moxie/runtime/flash/xhr/XMLHttpRequest",["moxie/runtime/flash/Runtime","moxie/core/utils/Basic","moxie/file/Blob","moxie/file/File","moxie/file/FileReaderSync","moxie/xhr/FormData","moxie/runtime/Transporter","moxie/core/JSON"],function(e,t,n,r,i,s,o,u){var a={send:function(e,r){function a(){e.transport=u.getMode();u.shimExec.call(i,"XMLHttpRequest","send",e,r)}function f(e,t){u.shimExec.call(i,"XMLHttpRequest","appendBlob",e,t.uid);r=null;a()}function l(e,t){var n=new o;n.bind("TransportingComplete",function(){f(e,this.result)});n.transport(t.getSource(),t.type,{ruid:u.uid})}var i=this,u=i.getRuntime();t.isEmptyObj(e.headers)||t.each(e.headers,function(e,t){u.shimExec.call(i,"XMLHttpRequest","setRequestHeader",t,e.toString())});if(r instanceof s){var c;r.each(function(e,t){e instanceof n?c=t:u.shimExec.call(i,"XMLHttpRequest","append",t,e)});if(!r.hasBlob()){r=null;a()}else{var h=r.getBlob();h.isDetached()?l(c,h):f(c,h)}}else if(r instanceof n){u.shimExec.call(i,"XMLHttpRequest","setRequestHeader","Content-Type",r.type||"application/octet-stream");r=r.uid;a()}else a()},getResponse:function(e){var n,s,o=this.getRuntime();s=o.shimExec.call(this,"XMLHttpRequest","getResponseAsBlob");if(s){s=new r(o.uid,s);if("blob"===e)return s;if(!!~t.inArray(e,["","text"])){n=new i;return n.readAsText(s)}if("arraybuffer"!==e&&"json"===e){n=new i;try{return u(n.readAsText(s))}catch(a){return null}}}return null},abort:function(e){var t=this.getRuntime();t.shimExec.call(this,"XMLHttpRequest","abort");this.dispatchEvent("readystatechange");this.dispatchEvent("abort");!e}};return e.XMLHttpRequest=a});i("moxie/runtime/flash/runtime/Transporter",["moxie/runtime/flash/Runtime","moxie/file/Blob"],function(e,t){var n={getAsBlob:function(e){var n=this.getRuntime(),r=n.shimExec.call(this,"Transporter","getAsBlob",e);return r?new t(n.uid,r):null}};return e.Transporter=n});i("moxie/runtime/flash/image/Image",["moxie/runtime/flash/Runtime","moxie/core/utils/Basic","moxie/runtime/Transporter","moxie/file/Blob","moxie/file/FileReaderSync"],function(e,t,n,r,i){var s={loadFromBlob:function(e){function i(e){r.shimExec.call(t,"Image","loadFromBlob",e.uid);t=r=null}var t=this,r=t.getRuntime();if(e.isDetached()){var s=new n;s.bind("TransportingComplete",function(){i(s.result.getSource())});s.transport(e.getSource(),e.type,{ruid:r.uid})}else i(e.getSource())},loadFromImage:function(e){var t=this.getRuntime();return t.shimExec.call(this,"Image","loadFromImage",e.uid)},getAsBlob:function(e,t){var n=this.getRuntime(),i=n.shimExec.call(this,"Image","getAsBlob",e,t);return i?new r(n.uid,i):null},getAsDataURL:function(){var e=this.getRuntime(),t=e.Image.getAsBlob.apply(this,arguments),n;if(!t)return null;n=new i;return n.readAsDataURL(t)}};return e.Image=s});i("moxie/runtime/silverlight/Runtime",["moxie/core/utils/Basic","moxie/core/utils/Env","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/runtime/Runtime"],function(e,t,n,r,i){function u(u){function l(e){var t=!1,n=null,r,i,s,o,u,a=0;try{try{n=new ActiveXObject("AgControl.AgControl");n.IsVersionSupported(e)&&(t=!0);n=null}catch(f){var l=navigator.plugins["Silverlight Plug-In"];if(l){r=l.description;r==="1.0.30226.2"&&(r="2.0.30226.2");i=r.split(".");while(i.length>3)i.pop();while(i.length<4)i.push(0);s=e.split(".");while(s.length>4)s.pop();do{o=parseInt(s[a],10);u=parseInt(i[a],10);a++}while(a<s.length&&o===u);o<=u&&!isNaN(o)&&(t=!0)}}}catch(c){t=!1}return t}var a=this,f;u=e.extend({xap_url:t.xap_url},u);i.call(this,u,s,{access_binary:i.capTrue,access_image_binary:i.capTrue,display_media:i.capTrue,do_cors:i.capTrue,drag_and_drop:!1,report_upload_progress:i.capTrue,resize_image:i.capTrue,return_response_headers:function(e){return e&&a.getMode()==="client"},return_response_type:i.capTrue,return_status_code:function(t){return a.getMode()==="client"||!e.arrayDiff(t,[200,404])},select_multiple:i.capTrue,send_binary_string:i.capTrue,send_browser_cookies:function(e){return e&&a.getMode()==="browser"},send_custom_headers:function(e){return e&&a.getMode()==="client"},send_multipart:i.capTrue,slice_blob:i.capTrue,stream_upload:!0,summon_file_dialog:!1,upload_filesize:i.capTrue,use_http_method:function(t){return a.getMode()==="client"||!e.arrayDiff(t,["GET","POST"])}},{return_response_headers:!0,return_status_code:function(t){return e.arrayDiff(t,[200,404])},send_browser_cookies:!1,send_custom_headers:!0,use_http_method:function(t){return e.arrayDiff(t,["GET","POST"])}});e.extend(this,{getShim:function(){return n.get(this.uid).content.Moxie},shimExec:function(e,t){var n=[].slice.call(arguments,2);return a.getShim().exec(this.uid,e,t,n)},init:function(){var e;if(!l("2.0.31005.0")||t.browser==="Opera"){this.trigger("Error",new r.RuntimeError(r.RuntimeError.NOT_INIT_ERR));return}e=this.getShimContainer();e.innerHTML='<object id="'+this.uid+'" data="data:application/x-silverlight," type="application/x-silverlight-2" width="100%" height="100%" style="outline:none;">'+'<param name="source" value="'+u.xap_url+'"/>'+'<param name="background" value="Transparent"/>'+'<param name="windowless" value="true"/>'+'<param name="enablehtmlaccess" value="true"/>'+'<param name="initParams" value="uid='+this.uid+",target="+t.global_event_dispatcher+'"/>'+"</object>";f=setTimeout(function(){a&&!a.initialized&&a.trigger("Error",new r.RuntimeError(r.RuntimeError.NOT_INIT_ERR))},t.OS!=="Windows"?1e4:5e3)},destroy:function(e){return function(){e.call(a);clearTimeout(f);u=f=e=a=null}}(this.destroy)},o)}var s="silverlight",o={};i.addConstructor(s,u);return o});i("moxie/runtime/silverlight/file/Blob",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/Blob"],function(e,t,n){return e.Blob=t.extend({},n)});i("moxie/runtime/silverlight/file/FileInput",["moxie/runtime/silverlight/Runtime"],function(e){var t={init:function(e){function t(e){var t="";for(var n=0;n<e.length;n++)t+=(t!==""?"|":"")+e[n].title+" | *."+e[n].extensions.replace(/,/g,";*.");return t}this.getRuntime().shimExec.call(this,"FileInput","init",t(e.accept),e.name,e.multiple);this.trigger("ready")}};return e.FileInput=t});i("moxie/runtime/silverlight/file/FileDrop",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Dom","moxie/core/utils/Events"],function(e,t,n){var r={init:function(){var e=this,r=e.getRuntime(),i;i=r.getShimContainer();n.addEvent(i,"dragover",function(e){e.preventDefault();e.stopPropagation();e.dataTransfer.dropEffect="copy"},e.uid);n.addEvent(i,"dragenter",function(e){e.preventDefault();var n=t.get(r.uid).dragEnter(e);n&&e.stopPropagation()},e.uid);n.addEvent(i,"drop",function(e){e.preventDefault();var n=t.get(r.uid).dragDrop(e);n&&e.stopPropagation()},e.uid);return r.shimExec.call(this,"FileDrop","init")}};return e.FileDrop=r});i("moxie/runtime/silverlight/file/FileReader",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/FileReader"],function(e,t,n){return e.FileReader=t.extend({},n)});i("moxie/runtime/silverlight/file/FileReaderSync",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/FileReaderSync"],function(e,t,n){return e.FileReaderSync=t.extend({},n)});i("moxie/runtime/silverlight/xhr/XMLHttpRequest",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/xhr/XMLHttpRequest"],function(e,t,n){return e.XMLHttpRequest=t.extend({},n)});i("moxie/runtime/silverlight/runtime/Transporter",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/runtime/Transporter"],function(e,t,n){return e.Transporter=t.extend({},n)});i("moxie/runtime/silverlight/image/Image",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/image/Image"],function(e,t,n){return e.Image=t.extend({},n)});i("moxie/runtime/html4/Runtime",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/Runtime","moxie/core/utils/Env"],function(e,t,n,r){function o(o){var u=this,a=n.capTest,f=n.capTrue;n.call(this,o,i,{access_binary:a(window.FileReader||window.File&&File.getAsDataURL),access_image_binary:!1,display_media:a(s.Image&&(r.can("create_canvas")||r.can("use_data_uri_over32kb"))),do_cors:!1,drag_and_drop:!1,resize_image:function(){return s.Image&&u.can("access_binary")&&r.can("create_canvas")},report_upload_progress:!1,return_response_headers:!1,return_response_type:function(t){return!!~e.inArray(t,["json","text","document",""])},return_status_code:function(t){return!e.arrayDiff(t,[200,404])},select_multiple:!1,send_binary_string:!1,send_custom_headers:!1,send_multipart:!0,slice_blob:!1,stream_upload:!0,summon_file_dialog:a(function(){return r.browser==="Firefox"&&r.version>=4||r.browser==="Opera"&&r.version>=12||r.browser==="IE"&&r.version>=10||!!~e.inArray(r.browser,["Chrome","Safari"])}()),upload_filesize:f,use_http_method:function(t){return!e.arrayDiff(t,["GET","POST"])}});e.extend(this,{init:function(){if(!r.can("use_fileinput")){this.trigger("Error",new t.RuntimeError(t.RuntimeError.NOT_INIT_ERR));return}this.trigger("Init")},destroy:function(e){return function(){e.call(u);e=u=null}}(this.destroy)});e.extend(this.getShim(),s)}var i="html4",s={};n.addConstructor(i,o);return s});i("moxie/runtime/html4/file/FileInput",["moxie/runtime/html4/Runtime","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Events","moxie/core/utils/Mime","moxie/core/utils/Env"],function(e,t,n,r,i,s){function o(){function f(){var i=this,l=i.getRuntime(),c,h,p,d,v,m;m=t.guid("uid_");c=l.getShimContainer();if(e){p=n.get(e+"_form");p&&t.extend(p.style,{top:"100%"})}d=document.createElement("form");d.setAttribute("id",m+"_form");d.setAttribute("method","post");d.setAttribute("enctype","multipart/form-data");d.setAttribute("encoding","multipart/form-data");t.extend(d.style,{overflow:"hidden",position:"absolute",top:0,left:0,width:"100%",height:"100%"});v=document.createElement("input");v.setAttribute("id",m);v.setAttribute("type","file");v.setAttribute("name","Filedata");v.setAttribute("accept",u.join(","));t.extend(v.style,{fontSize:"999px",opacity:0});d.appendChild(v);c.appendChild(d);t.extend(v.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"});s.browser==="IE"&&s.version<10&&t.extend(v.style,{filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=0)"});v.onchange=function(){var e;if(!this.value)return;this.files?e=this.files[0]:e={name:this.value};o=[e];this.onchange=function(){};f.call(i);i.bind("change",function(){var e=n.get(m),t=n.get(m+"_form"),r;if(i.files.length&&e&&t){r=i.files[0];e.setAttribute("id",r.uid);t.setAttribute("id",r.uid+"_form");t.setAttribute("target",r.uid+"_iframe")}e=t=null},998);v=d=null;i.trigger("change")};if(l.can("summon_file_dialog")){h=n.get(a.browse_button);r.removeEvent(h,"click",i.uid);r.addEvent(h,"click",function(e){v&&!v.disabled&&v.click();e.preventDefault()},i.uid)}e=m;c=p=h=null;i.trigger({type:"ready",async:!0})}var e,o=[],u=[],a;t.extend(this,{init:function(e){var t=this,s=t.getRuntime(),o;a=e;u=e.accept.mimes||i.extList2mimes(e.accept);o=s.getShimContainer();(function(){var i,u,a;i=n.get(e.browse_button);if(s.can("summon_file_dialog")){n.getStyle(i,"position")==="static"&&(i.style.position="relative");u=parseInt(n.getStyle(i,"z-index"),10)||1;i.style.zIndex=u;o.style.zIndex=u-1}a=s.can("summon_file_dialog")?i:o;r.addEvent(a,"mouseover",function(){t.trigger("mouseenter")},t.uid);r.addEvent(a,"mouseout",function(){t.trigger("mouseleave")},t.uid);r.addEvent(a,"mousedown",function(){t.trigger("mousedown")},t.uid);r.addEvent(n.get(e.container),"mouseup",function(){t.trigger("mouseup")},t.uid);i=null})();f.call(this);o=null},getFiles:function(){return o},disable:function(t){var r;if(r=n.get(e))r.disabled=!!t},destroy:function(){var t=this.getRuntime(),i=t.getShimContainer();r.removeAllEvents(i,this.uid);r.removeAllEvents(a&&n.get(a.container),this.uid);r.removeAllEvents(a&&n.get(a.browse_button),this.uid);i&&(i.innerHTML="");e=o=u=a=null}})}return e.FileInput=o});i("moxie/runtime/html4/file/FileReader",["moxie/runtime/html4/Runtime","moxie/runtime/html5/file/FileReader"],function(e,t){return e.FileReader=t});i("moxie/runtime/html4/xhr/XMLHttpRequest",["moxie/runtime/html4/Runtime","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Url","moxie/core/Exceptions","moxie/core/utils/Events","moxie/file/Blob","moxie/xhr/FormData","moxie/core/JSON"],function(e,t,n,r,i,s,o,u,a){function f(){function c(e){var t=this,r,i,o,u,a=!1;if(!l)return;r=l.id.replace(/_iframe$/,"");i=n.get(r+"_form");if(i){o=i.getElementsByTagName("input");u=o.length;while(u--)switch(o[u].getAttribute("type")){case"hidden":o[u].parentNode.removeChild(o[u]);break;case"file":a=!0}o=[];a||i.parentNode.removeChild(i);i=null}setTimeout(function(){s.removeEvent(l,"load",t.uid);l.parentNode&&l.parentNode.removeChild(l);var n=t.getRuntime().getShimContainer();n.children.length||n.parentNode.removeChild(n);n=l=null;e()},1)}var e,f,l;t.extend(this,{send:function(a,h){function b(){var n=d.getShimContainer()||document.body,i=document.createElement("div");i.innerHTML='<iframe id="'+v+'_iframe" name="'+v+'_iframe" src="javascript:&quot;&quot;" style="display:none"></iframe>';l=i.firstChild;n.appendChild(l);s.addEvent(l,"load",function(){var n;try{n=l.contentWindow.document||l.contentDocument||window.frames[l.id].document;if(/^4\d{2}\s/.test(n.title)&&n.getElementsByTagName("address").length)e=n.title.replace(/^(\d+).*$/,"$1");else{e=200;f=t.trim(n.body.innerHTML);p.trigger({type:"progress",loaded:f.length,total:f.length});y&&p.trigger({type:"uploadprogress",loaded:y.size||1025,total:y.size||1025})}}catch(i){if(!r.hasSameOrigin(a.url)){c.call(p,function(){p.trigger("error")});return}e=404}c.call(p,function(){p.trigger("load")})},p.uid)}var p=this,d=p.getRuntime(),v,m,g,y;e=f=null;if(h instanceof u&&h.hasBlob()){y=h.getBlob();v=y.uid;g=n.get(v);m=n.get(v+"_form");if(!m)throw new i.DOMException(i.DOMException.NOT_FOUND_ERR)}else{v=t.guid("uid_");m=document.createElement("form");m.setAttribute("id",v+"_form");m.setAttribute("method",a.method);m.setAttribute("enctype","multipart/form-data");m.setAttribute("encoding","multipart/form-data");m.setAttribute("target",v+"_iframe");d.getShimContainer().appendChild(m)}h instanceof u&&h.each(function(e,n){if(e instanceof o)g&&g.setAttribute("name",n);else{var r=document.createElement("input");t.extend(r,{type:"hidden",name:n,value:e});m.appendChild(r)}});m.setAttribute("action",a.url);b();m.submit();p.trigger("loadstart")},getStatus:function(){return e},getResponse:function(e){if("json"===e){if(t.typeOf(f)==="string")try{return a(f.replace(/^\s*<pre[^>]*>/,"").replace(/<\/pre>\s*$/,""))}catch(n){return null}}else"document"===e;return f},abort:function(){var e=this;l&&l.contentWindow&&(l.contentWindow.stop?l.contentWindow.stop():l.contentWindow.document.execCommand?l.contentWindow.document.execCommand("Stop"):l.src="about:blank");c.call(this,function(){e.dispatchEvent("abort")})}})}return e.XMLHttpRequest=f});i("moxie/runtime/html4/image/Image",["moxie/runtime/html4/Runtime","moxie/runtime/html5/image/Image"],function(e,t){return e.Image=t});u(["moxie/core/utils/Basic","moxie/core/I18n","moxie/core/utils/Mime","moxie/core/utils/Env","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/core/EventTarget","moxie/core/utils/Encode","moxie/runtime/Runtime","moxie/runtime/RuntimeClient","moxie/file/Blob","moxie/file/File","moxie/file/FileInput","moxie/file/FileDrop","moxie/file/FileReader","moxie/core/utils/Url","moxie/runtime/RuntimeTarget","moxie/file/FileReaderSync","moxie/xhr/FormData","moxie/xhr/XMLHttpRequest","moxie/runtime/Transporter","moxie/core/JSON","moxie/image/Image","moxie/core/utils/Events"])})(this);(function(){"use strict";var e={},t=moxie.core.utils.Basic.inArray;(function n(r){var i,s;for(i in r){s=typeof r[i];s==="object"&&!~t(i,["Exceptions","Env","Mime"])?n(r[i]):s==="function"&&(e[i]=r[i])}})(window.moxie);e.Env=window.moxie.core.utils.Env;e.Mime=window.moxie.core.utils.Mime;e.Exceptions=window.moxie.core.Exceptions;window.mOxie=e;window.o||(window.o=e);return e})();