/**
 * mOxie - multi-runtime File API & XMLHttpRequest L2 Polyfill
 * v1.0a
 *
 * Copyright 2013, Moxiecode Systems AB
 * Released under GPL License.
 *
 * License: http://www.plupload.com/license
 * Contributing: http://www.plupload.com/contributing
 *
 * Date: 2012-11-13
 */!function(e,t){"use strict";function n(e,t){for(var n,r=[],i=0;i<e.length;++i){if(n=u[e[i]]||s(e[i]),!n)throw"module definition dependecy not found: "+e[i];r.push(n)}t.apply(null,r)}function r(e,r,i){if("string"!=typeof e)throw"invalid module definition, module id must be defined and be a string";if(r===t)throw"invalid module definition, dependencies must be specified";if(i===t)throw"invalid module definition, definition function must be specified";n(r,function(){u[e]=i.apply(null,arguments)})}function i(e){return!!u[e]}function s(t){for(var n=e,r=t.split(/[.\/]/),i=0;i<r.length;++i){if(!n[r[i]])return;n=n[r[i]]}return n}function o(n){for(var r=0;r<n.length;r++){for(var i=e,s=n[r],o=s.split(/[.\/]/),a=0;a<o.length-1;++a)i[o[a]]===t&&(i[o[a]]={}),i=i[o[a]];i[o[o.length-1]]=u[s]}}var u={},a="moxie/core/utils/Basic",f="moxie/core/I18n",l="moxie/core/utils/Mime",c="moxie/core/utils/Env",h="moxie/core/utils/Dom",p="moxie/core/Exceptions",d="moxie/core/EventTarget",v="moxie/core/utils/Encode",m="moxie/runtime/Runtime",g="moxie/runtime/RuntimeClient",y="moxie/file/Blob",b="moxie/file/File",w="moxie/file/FileInput",E="moxie/file/FileDrop",S="moxie/file/FileReader",x="moxie/core/utils/Url",T="moxie/runtime/RuntimeTarget",N="moxie/file/FileReaderSync",C="moxie/xhr/FormData",k="moxie/xhr/XMLHttpRequest",L="moxie/runtime/Transporter",A="moxie/core/JSON",O="moxie/image/Image",M="moxie/runtime/html5/Runtime",_="moxie/runtime/html5/file/Blob",D="moxie/core/utils/Events",P="moxie/runtime/html5/file/FileInput",H="moxie/runtime/html5/file/FileDrop",B="moxie/runtime/html5/file/FileReader",j="moxie/runtime/html5/xhr/XMLHttpRequest",F="moxie/runtime/html5/utils/BinaryReader",I="moxie/runtime/html5/image/JPEGHeaders",q="moxie/runtime/html5/image/ExifParser",R="moxie/runtime/html5/image/JPEG",U="moxie/runtime/html5/image/PNG",z="moxie/runtime/html5/image/ImageInfo",W="moxie/runtime/html5/image/MegaPixel",X="moxie/runtime/html5/image/Image",V="moxie/runtime/flash/Runtime",$="moxie/runtime/flash/file/Blob",J="moxie/runtime/flash/file/FileInput",K="moxie/runtime/flash/file/FileReader",Q="moxie/runtime/flash/file/FileReaderSync",G="moxie/runtime/flash/xhr/XMLHttpRequest",Y="moxie/runtime/flash/runtime/Transporter",Z="moxie/runtime/flash/image/Image",et="moxie/runtime/silverlight/Runtime",tt="moxie/runtime/silverlight/file/Blob",nt="moxie/runtime/silverlight/file/FileInput",rt="moxie/runtime/silverlight/file/FileDrop",it="moxie/runtime/silverlight/file/FileReader",st="moxie/runtime/silverlight/file/FileReaderSync",ot="moxie/runtime/silverlight/xhr/XMLHttpRequest",ut="moxie/runtime/silverlight/runtime/Transporter",at="moxie/runtime/silverlight/image/Image",ft="moxie/runtime/html4/Runtime",lt="moxie/runtime/html4/file/FileInput",ct="moxie/runtime/html4/file/FileReader",ht="moxie/runtime/html4/xhr/XMLHttpRequest",pt="moxie/runtime/html4/image/Image";r(a,[],function(){var e=function(e){var t;return e===t?"undefined":null===e?"null":e.nodeType?"node":{}.toString.call(e).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()},t=function(r){var i;return n(arguments,function(o,u){u>0&&n(o,function(n,o){n!==i&&(e(r[o])===e(n)&&~s(e(n),["array","object"])?t(r[o],n):r[o]=n)})}),r},n=function(e,t){var n,r,i,s;if(e){try{n=e.length}catch(o){n=s}if(n===s){for(r in e)if(e.hasOwnProperty(r)&&t(e[r],r)===!1)return}else for(i=0;n>i;i++)if(t(e[i],i)===!1)return}},r=function(t){var n;if(!t||"object"!==e(t))return!0;for(n in t)return!1;return!0},i=function(t,n){function r(i){"function"===e(t[i])&&t[i](function(e){++i<s&&!e?r(i):n(e)})}var i=0,s=t.length;"function"!==e(n)&&(n=function(){}),t&&t.length||n(),r(i)},s=function(e,t){if(t){if(Array.prototype.indexOf)return Array.prototype.indexOf.call(t,e);for(var n=0,r=t.length;r>n;n++)if(t[n]===e)return n}return-1},o=function(t,n){var r=[];"array"!==e(t)&&(t=[t]),"array"!==e(n)&&(n=[n]);for(var i in t)-1===s(t[i],n)&&r.push(t[i]);return r.length?r:!1},u=function(e){var t,n=[];for(t=0;t<e.length;t++)n[t]=e[t];return n},a=function(){var e=0;return function(t){var n=(new Date).getTime().toString(32),r;for(r=0;5>r;r++)n+=Math.floor(65535*Math.random()).toString(32);return(t||"o_")+n+(e++).toString(32)}}(),f=function(e){return e?String.prototype.trim?String.prototype.trim.call(e):e.toString().replace(/^\s*/,"").replace(/\s*$/,""):e},l=function(e){if("string"!=typeof e)return e;var t={t:1099511627776,g:1073741824,m:1048576,k:1024},n;return e=/^([0-9]+)([mgk]?)$/.exec(e.toLowerCase().replace(/[^0-9mkg]/g,"")),n=e[2],e=+e[1],t.hasOwnProperty(n)&&(e*=t[n]),e};return{guid:a,typeOf:e,extend:t,each:n,isEmptyObj:r,inSeries:i,inArray:s,arrayDiff:o,toArray:u,trim:f,parseSizeStr:l}}),r(f,[a],function(e){var t={};return{addI18n:function(n){return e.extend(t,n)},translate:function(e){return t[e]||e},_:function(e){return this.translate(e)},sprintf:function(e){var t=[].slice.call(arguments,1),n="";return e.split(/%[sdf]/).forEach(function(e){n+=e,t.length&&(n+=t.shift())}),n}}}),r(l,[a,f],function(e,t){var n="application/msword,doc dot,application/pdf,pdf,application/pgp-signature,pgp,application/postscript,ps ai eps,application/rtf,rtf,application/vnd.ms-excel,xls xlb,application/vnd.ms-powerpoint,ppt pps pot,application/zip,zip,application/x-shockwave-flash,swf swfl,application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,application/vnd.openxmlformats-officedocument.presentationml.template,potx,application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,application/x-javascript,js,application/json,json,audio/mpeg,mp3 mpga mpega mp2,audio/x-wav,wav,audio/mp4,m4a,audio/ogg,oga ogg,audio/aiff,aiff aif,audio/flac,flac,audio/aac,aac,audio/ac3,ac3,audio/x-ms-wma,wma,image/bmp,bmp,image/gif,gif,image/jpeg,jpg jpeg jpe,image/photoshop,psd,image/png,png,image/svg+xml,svg svgz,image/tiff,tiff tif,text/plain,asc txt text diff log,text/html,htm html xhtml,text/css,css,text/csv,csv,text/rtf,rtf,video/mpeg,mpeg mpg mpe m2v,video/quicktime,qt mov,video/mp4,mp4,video/x-m4v,m4v,video/x-flv,flv,video/x-ms-wmv,wmv,video/avi,avi,video/webm,webm,video/3gpp,3gpp 3gp,video/3gpp2,3g2,video/vnd.rn-realvideo,rv,video/ogg,ogv,video/x-matroska,mkv,application/vnd.oasis.opendocument.formula-template,otf,application/octet-stream,exe",r={mimes:{},extensions:{},addMimeType:function(e){var t=e.split(/,/),n,r,i;for(n=0;n<t.length;n+=2){for(i=t[n+1].split(/ /),r=0;r<i.length;r++)this.mimes[i[r]]=t[n];this.extensions[t[n]]=i}},extList2mimes:function(t){var n=this,r,i,s,o,u=[];e:for(i=0;i<t.length;i++)for(r=t[i].extensions.split(/\s*,\s*/),s=0;s<r.length;s++){if("*"===r[s]){u=[];break e}o=n.mimes[r[s]],o&&!~e.inArray(o,u)&&u.push(o)}return u},mimes2extList:function(n){var r=this,i=[],s=[];return n=e.trim(n).split(/\s*,\s*/),"*"!==n&&e.each(n,function(t){var n=t.match(/^(\w+)\/(\*|\w+)$/);n&&("*"===n[2]?e.each(r.extensions,function(e,t){(new RegExp("^"+n[1]+"/")).test(t)&&[].push.apply(i,r.extensions[t])}):r.extensions[t]&&[].push.apply(i,r.extensions[t]))}),s.push({title:t.translate("Files"),extensions:i.length?i.join(","):"*"}),s.mimes=n,s},getFileExtension:function(e){var t=e&&e.match(/\.([^.]+)$/);return t?t[1].toLowerCase():""},getFileMime:function(e){return this.mimes[this.getFileExtension(e)]||""}};return r.addMimeType(n),r}),r(c,[a],function(e){function t(e){for(var t,n,r=0;r<e.length;r++)if(t=e[r].s1,n=e[r].prop,s=e[r].sv||e[r].id,t){if(-1!=t.indexOf(e[r].s2))return e[r].id}else if(n)return e[r].id}function n(e){var t=e.indexOf(s);if(-1!=t)return parseFloat(e.substring(t+s.length+1))}var r=[{s1:navigator.userAgent,s2:"Android",id:"Android Browser",sv:"Version"},{s1:navigator.userAgent,s2:"Chrome",id:"Chrome"},{s1:navigator.vendor,s2:"Apple",id:"Safari",sv:"Version"},{prop:window.opera&&window.opera.buildNumber,id:"Opera",sv:"Version"},{s1:navigator.vendor,s2:"KDE",id:"Konqueror"},{s1:navigator.userAgent,s2:"Firefox",id:"Firefox"},{s1:navigator.vendor,s2:"Camino",id:"Camino"},{s1:navigator.userAgent,s2:"Netscape",id:"Netscape"},{s1:navigator.userAgent,s2:"MSIE",id:"IE",sv:"MSIE"},{s1:navigator.userAgent,s2:"Gecko",id:"Mozilla",sv:"rv"}],i=[{s1:navigator.platform,s2:"Win",id:"Windows"},{s1:navigator.platform,s2:"Mac",id:"Mac"},{s1:navigator.userAgent,s2:"iPhone",id:"iOS"},{s1:navigator.userAgent,s2:"iPad",id:"iOS"},{s1:navigator.userAgent,s2:"Android",id:"Android"},{s1:navigator.platform,s2:"Linux",id:"Linux"}],s,o=function(){var t={define_property:function(){return!1}(),create_canvas:function(){var e=document.createElement("canvas");return!!e.getContext&&!!e.getContext("2d")}(),return_response_type:function(t){if(!window.XMLHttpRequest)return!1;try{var n=new XMLHttpRequest;if("undefined"!==e.typeOf(n.responseType))return n.open("get","infinity-8.me"),n.responseType=t,n.responseType!==t?!1:!0}catch(r){}return!1},use_data_uri:function(){var e=new Image;return e.onload=function(){t.use_data_uri=1===e.width&&1===e.height},setTimeout(function(){e.src="data:image/gif;base64,R0lGODlhAQABAIAAAP8AAAAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw=="},1),!1}(),use_data_uri_over32kb:function(){return t.use_data_uri&&("IE"!==u.browser||u.version>=9)},use_data_uri_of:function(e){return t.use_data_uri&&33e3>e||t.use_data_uri_over32kb()},use_fileinput:function(){var e=document.createElement("input");return e.setAttribute("type","file"),!e.disabled}};return function(n){var r=[].slice.call(arguments);return r.shift(),"function"===e.typeOf(t[n])?t[n].apply(this,r):!!t[n]}}(),u={can:o,browser:t(r),version:n(navigator.userAgent)||n(navigator.appVersion),OS:t(i),swf_url:"../flash/Moxie.swf",xap_url:"../silverlight/Moxie.xap",global_event_dispatcher:"moxie.core.EventTarget.instance.dispatchEvent"};return u}),r(h,[c],function(e){var t=function(e){return"string"!=typeof e?e:document.getElementById(e)},n=function(e,t){var n;return""===e.className?!1:(n=new RegExp("(^|\\s+)"+t+"(\\s+|$)"),n.test(e.className))},r=function(e,t){n(e,t)||(e.className=""===e.className?t:e.className.replace(/\s+$/,"")+" "+t)},i=function(e,t){var n=new RegExp("(^|\\s+)"+t+"(\\s+|$)");e.className=e.className.replace(n,function(e,t,n){return" "===t&&" "===n?" ":""})},s=function(e,t){return e.currentStyle?e.currentStyle[t]:window.getComputedStyle?window.getComputedStyle(e,null)[t]:void 0},o=function(t,n){function r(e){var t,n,r=0,i=0;return e&&(n=e.getBoundingClientRect(),t="CSS1Compat"===u.compatMode?u.documentElement:u.body,r=n.left+t.scrollLeft,i=n.top+t.scrollTop),{x:r,y:i}}var i=0,s=0,o,u=document,a,f;if(t=t,n=n||u.body,t&&t.getBoundingClientRect&&"IE"===e.browser&&(!u.documentMode||u.documentMode<8))return a=r(t),f=r(n),{x:a.x-f.x,y:a.y-f.y};for(o=t;o&&o!=n&&o.nodeType;)i+=o.offsetLeft||0,s+=o.offsetTop||0,o=o.offsetParent;for(o=t.parentNode;o&&o!=n&&o.nodeType;)i-=o.scrollLeft||0,s-=o.scrollTop||0,o=o.parentNode;return{x:i,y:s}},u=function(e){return{w:e.offsetWidth||e.clientWidth,h:e.offsetHeight||e.clientHeight}};return{get:t,hasClass:n,addClass:r,removeClass:i,getStyle:s,getPos:o,getSize:u}}),r(p,[a],function(e){function t(e,t){var n;for(n in e)if(e[n]===t)return n;return null}return{RuntimeError:function(){function n(e){this.code=e,this.name=t(r,e),this.message=this.name+": RuntimeError "+this.code}var r={NOT_INIT_ERR:1,NOT_SUPPORTED_ERR:9,JS_ERR:4};return e.extend(n,r),n.prototype=Error.prototype,n}(),OperationNotAllowedException:function(){function t(e){this.code=e,this.name="OperationNotAllowedException"}return e.extend(t,{NOT_ALLOWED_ERR:1}),t.prototype=Error.prototype,t}(),ImageError:function(){function n(e){this.code=e,this.name=t(r,e),this.message=this.name+": ImageError "+this.code}var r={WRONG_FORMAT:1};return e.extend(n,r),n.prototype=Error.prototype,n}(),FileException:function(){function n(e){this.code=e,this.name=t(r,e),this.message=this.name+": FileException "+this.code}var r={NOT_FOUND_ERR:1,SECURITY_ERR:2,ABORT_ERR:3,NOT_READABLE_ERR:4,ENCODING_ERR:5,NO_MODIFICATION_ALLOWED_ERR:6,INVALID_STATE_ERR:7,SYNTAX_ERR:8};return e.extend(n,r),n.prototype=Error.prototype,n}(),DOMException:function(){function n(e){this.code=e,this.name=t(r,e),this.message=this.name+": DOMException "+this.code}var r={INDEX_SIZE_ERR:1,DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,INVALID_ACCESS_ERR:15,VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25};return e.extend(n,r),n.prototype=Error.prototype,n}(),EventException:function(){function t(e){this.code=e,this.name="EventException"}return e.extend(t,{UNSPECIFIED_EVENT_TYPE_ERR:0}),t.prototype=Error.prototype,t}()}}),r(d,[p,a],function(e,n){function r(){var r={};n.extend(this,{uid:null,init:function(){this.uid||(this.uid=n.guid("uid_"))},addEventListener:function(e,t,i,s){var o=this,u;return e=n.trim(e),/\s/.test(e)?(n.each(e.split(/\s+/),function(e){o.addEventListener(e,t,i,s)}),void 0):(e=e.toLowerCase(),i=parseInt(i,10)||0,u=r[this.uid]&&r[this.uid][e]||[],u.push({fn:t,priority:i,scope:s||this}),r[this.uid]||(r[this.uid]={}),r[this.uid][e]=u,void 0)},hasEventListener:function(e){return e?!!r[this.uid]&&!!r[this.uid][e]:!!r[this.uid]},removeEventListener:function(e,t){e=e.toLowerCase();var i=r[this.uid]&&r[this.uid][e],s;if(i){if(t){for(s=i.length-1;s>=0;s--)if(i[s].fn===t){i.splice(s,1);break}}else i=[];i.length||(delete r[this.uid][e],n.isEmptyObj(r[this.uid])&&delete r[this.uid])}},removeAllEventListeners:function(){r[this.uid]&&delete r[this.uid]},dispatchEvent:function(t){var i,s,o,u,a={};if("string"!==n.typeOf(t)){if(u=t,"string"!==n.typeOf(u.type))throw new e.EventException(e.EventException.UNSPECIFIED_EVENT_TYPE_ERR);t=u.type,u.total&&u.loaded&&(a.total=u.total,a.loaded=u.loaded),a.async=u.async||!1}if(-1!==t.indexOf("::")?function(e){i=e[0],t=e[1]}(t.split("::")):i=this.uid,t=t.toLowerCase(),s=r[i]&&r[i][t]){s.sort(function(e,t){return t.priority-e.priority}),o=[].slice.call(arguments),o.shift(),a.type=t,o.unshift(a);var f=[];n.each(s,function(e){o[0].target=e.scope,a.async?f.push(function(t){setTimeout(function(){t(e.fn.apply(e.scope,o)===!1)},1)}):f.push(function(t){t(e.fn.apply(e.scope,o)===!1)})}),f.length&&n.inSeries(f)}return!0},bind:function(){this.addEventListener.apply(this,arguments)},unbind:function(){this.removeEventListener.apply(this,arguments)},unbindAll:function(){this.removeAllEventListeners.apply(this,arguments)},trigger:function(){this.dispatchEvent.apply(this,arguments)},convertEventPropsToHandlers:function(e){var r;"array"!==n.typeOf(e)&&(e=[e]);for(var i=0;i<e.length;i++)r="on"+e[i],"function"===n.typeOf(this[r])?this.addEventListener(e[i],this[r]):this[r]===t&&(this[r]=null)}})}return r.instance=new r,r}),r(v,[],function(){var e=function(e){return unescape(encodeURIComponent(e))},t=function(e){return decodeURIComponent(escape(e))},n=function(e,n){if("function"==typeof window.atob)return n?t(window.atob(e)):window.atob(e);var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i,s,o,u,a,f,l,c,h=0,p=0,d="",v=[];if(!e)return e;e+="";do u=r.indexOf(e.charAt(h++)),a=r.indexOf(e.charAt(h++)),f=r.indexOf(e.charAt(h++)),l=r.indexOf(e.charAt(h++)),c=u<<18|a<<12|f<<6|l,i=255&c>>16,s=255&c>>8,o=255&c,v[p++]=64==f?String.fromCharCode(i):64==l?String.fromCharCode(i,s):String.fromCharCode(i,s,o);while(h<e.length);return d=v.join(""),n?t(d):d},r=function(t,n){if(n&&e(t),"function"==typeof window.btoa)return window.btoa(t);var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i,s,o,u,a,f,l,c,h=0,p=0,d="",v=[];if(!t)return t;do i=t.charCodeAt(h++),s=t.charCodeAt(h++),o=t.charCodeAt(h++),c=i<<16|s<<8|o,u=63&c>>18,a=63&c>>12,f=63&c>>6,l=63&c,v[p++]=r.charAt(u)+r.charAt(a)+r.charAt(f)+r.charAt(l);while(h<t.length);d=v.join("");var m=t.length%3;return(m?d.slice(0,m-3):d)+"===".slice(m||3)};return{utf8_encode:e,utf8_decode:t,atob:n,btoa:r}}),r(m,[a,h,d],function(e,t,n){function r(n,r,i,o,u){function a(t,r){var i=this,s=n&&n.required_caps;return null!==h?h:(s&&!e.isEmptyObj(t)&&e.each(s,function(e,n){if(t.hasOwnProperty(n)){var r=i.can(n,e,t)?"client":"browser";if(h&&h!==r)return h=!1;h=r}}),null===h&&(h=r||"browser"),h&&s&&!this.can(s)&&(h=!1),void 0)}var f=this,l,c=e.guid(r+"_"),h=null;s[c]=this,i=e.extend({access_binary:!1,access_image_binary:!1,display_media:!1,do_cors:!1,drag_and_drop:!1,resize_image:!1,report_upload_progress:!1,return_response_headers:!1,return_response_type:!1,return_status_code:!0,send_custom_headers:!1,select_folder:!1,select_multiple:!0,send_binary_string:!1,send_browser_cookies:!0,send_multipart:!0,slice_blob:!1,stream_upload:!1,summon_file_dialog:!1,upload_filesize:!0,use_http_method:!0},i),l=function(){var t={};return{exec:function(e,n,r,i){return l[n]&&(t[e]||(t[e]={context:this,instance:new l[n]}),t[e].instance[r])?t[e].instance[r].apply(this,i):void 0},removeInstance:function(e){delete t[e]},removeAllInstances:function(){var n=this;e.each(t,function(t,r){"function"===e.typeOf(t.instance.destroy)&&t.instance.destroy.call(t.context),n.removeInstance(r)})}}}(),e.extend(this,{initialized:!1,uid:c,type:r,shimid:c+"_container",clients:0,options:n,can:function(t,n){var r=arguments[2]||i;if("string"===e.typeOf(t)&&"undefined"===e.typeOf(n)&&(t=function(t){var n={};return e.each(t,function(e){n[e]=!0}),n}(t.split(","))),"object"===e.typeOf(t)){for(var s in t)if(!this.can(s,t[s],r))return!1;return!0}return"function"===e.typeOf(r[t])?r[t].call(this,n):n===r[t]},getMode:function(){return h||!1},getShimContainer:function(){var n,r=t.get(this.shimid);return r||(n=this.options.container?t.get(this.options.container):document.body,r=document.createElement("div"),r.id=this.shimid,r.className="moxie-shim moxie-shim-"+this.type,e.extend(r.style,{position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"}),n.appendChild(r),n=null),r},getShim:function(){return l},shimExec:function(e,t){var n=[].slice.call(arguments,2);return f.getShim().exec.call(this,this.uid,e,t,n)},exec:function(e,t){var n=[].slice.call(arguments,2);return f[e]&&f[e][t]?f[e][t].apply(this,n):f.shimExec.apply(this,arguments)},destroy:function(){if(f){var e=t.get(this.shimid);e&&e.parentNode.removeChild(e),l&&l.removeAllInstances(),this.unbindAll(),delete s[this.uid],this.uid=null,c=f=l=h=e=null}}}),a.call(this,o,u)}var i={},s={};return r.order="html5,flash,silverlight,html4",r.getRuntime=function(e){return s[e]?s[e]:!1},r.addConstructor=function(e,t){t.prototype=n.instance,i[e]=t},r.getConstructor=function(e){return i[e]||null},r.getInfo=function(e){var t=r.getRuntime(e);return t?{uid:t.uid,type:t.type,can:t.can}:null},r.can=function(e,t){var n,i=r.getConstructor(e),s;return i?(n=new i({required_caps:t}),s=n.getMode(),n.destroy(),!!s):!1},r.thatCan=function(e,t){var n=(t||r.order).split(/\s*,\s*/);for(var i in n)if(r.can(n[i],e))return n[i];return null},r.capTrue=function(){return!0},r.capFalse=function(){return!1},r.capTest=function(e){return function(){return!!e}},r}),r(g,[p,a,m],function(e,t,n){return function r(){var r;t.extend(this,{connectRuntime:function(i){function s(t){var u,a;return t.length?(u=t.shift(),(a=n.getConstructor(u))?(r=new a(i),r.bind("Init",function(){r.initialized=!0,setTimeout(function(){r.clients++,o.trigger("RuntimeInit",r)},1)}),r.bind("Error",function(){r.destroy(),s(t)}),r.getMode()?(r.init(),void 0):(r.trigger("Error"),void 0)):(s(t),void 0)):(o.trigger("RuntimeError",new e.RuntimeError(e.RuntimeError.NOT_INIT_ERR)),r=null,void 0)}var o=this,u;if("string"===t.typeOf(i)?u=i:"string"===t.typeOf(i.ruid)&&(u=i.ruid),u){if(r=n.getRuntime(u))return r.clients++,r;throw new e.RuntimeError(e.RuntimeError.NOT_INIT_ERR)}s((i.runtime_order||n.order).split(/\s*,\s*/))},getRuntime:function(){return r&&r.uid?r:(r=null,null)},disconnectRuntime:function(){r&&--r.clients<=0&&(r.destroy(),r=null)}})}}),r(y,[a,v,g],function(e,t,n){function r(s,o){function u(t,n,s){var o,u=i[this.uid];return"string"===e.typeOf(u)&&u.length?(o=new r(null,{type:s,size:n-t}),o.detach(u.substr(t,o.size)),o):null}s&&(n.call(this),this.connectRuntime(s)),o?"string"===e.typeOf(o)&&(o={data:o}):o={},e.extend(this,{uid:o.uid||e.guid("uid_"),ruid:s,size:o.size||0,type:o.type||"",slice:function(e,t,n){return this.isDetached()?u.apply(this,arguments):this.getRuntime().exec.call(this,"Blob","slice",this.getSource(),e,t,n)},getSource:function(){return i[this.uid]?i[this.uid]:null},detach:function(e){this.ruid&&(this.getRuntime().exec.call(this,"Blob","destroy",i[this.uid]),this.disconnectRuntime(),this.ruid=null),e=e||"";var n=e.match(/^data:([^;]*);base64,/);n&&(this.type=n[1],e=t.atob(e.substring(e.indexOf("base64,")+7))),this.size=e.length,i[this.uid]=e},isDetached:function(){return!this.ruid&&"string"===e.typeOf(i[this.uid])},destroy:function(){this.detach(),delete i[this.uid]}}),o.data?this.detach(o.data):i[this.uid]=o}var i={};return r}),r(b,[a,l,y],function(e,t,n){function r(r,i){var s,o;if(i||(i={}),o=i.type&&""!==i.type?i.type:t.getFileMime(i.name),i.name)s=i.name.replace(/\\/g,"/"),s=s.substr(s.lastIndexOf("/")+1);else{var u=o.split("/")[0];s=e.guid((""!==u?u:"file")+"_"),t.extensions[o]&&(s+="."+t.extensions[o][0])}n.apply(this,arguments),e.extend(this,{type:o||"",name:s||e.guid("file_"),lastModifiedDate:i.lastModifiedDate||(new Date).toLocaleString()})}return r.prototype=n.prototype,r}),r(w,[a,l,h,p,d,f,b,g],function(e,t,n,r,i,s,o,u){function a(i){var a=this,l,c,h;if(-1!==e.inArray(e.typeOf(i),["string","node"])&&(i={browse_button:i}),c=n.get(i.browse_button),!c)throw new r.DOMException(r.DOMException.NOT_FOUND_ERR);h={accept:[{title:s.translate("All Files"),extensions:"*"}],name:"file",multiple:!1,required_caps:!1,container:c.parentNode||document.body},i="object"==typeof i?e.extend({},h,i):h,"string"==typeof i.accept&&(i.accept=t.mimes2extList(i.accept)),l=n.get(i.container),l||(l=document.body),"static"===n.getStyle(l,"position")&&(l.style.position="relative"),l=c=null,u.call(a),e.extend(a,{uid:e.guid("uid_"),ruid:null,files:null,init:function(){a.convertEventPropsToHandlers(f),a.bind("RuntimeInit",function(t,r){a.ruid=r.uid,a.bind("Ready",function(){a.trigger("Refresh")},999),a.bind("Change",function(){var t=r.exec.call(a,"FileInput","getFiles");a.files=[],e.each(t,function(e){a.files.push(new o(a.ruid,e))})},999),a.bind("Refresh",function(){var t,s,o,u;o=n.get(i.browse_button),u=n.get(r.shimid),o&&(t=n.getPos(o,n.get(i.container)),s=n.getSize(o),u&&e.extend(u.style,{top:t.y+"px",left:t.x+"px",width:s.w+"px",height:s.h+"px"})),u=o=null}),r.exec.call(a,"FileInput","init",i)}),a.connectRuntime(i)},disable:function(t){var n=this.getRuntime();n&&n.exec.call(this,"FileInput","disable","undefined"===e.typeOf(t)?!0:t)},refresh:function(){a.trigger("Refresh")},destroy:function(){var t=this.getRuntime();t&&(t.exec.call(this,"FileInput","destroy"),this.disconnectRuntime()),"array"===e.typeOf(this.files)&&e.each(this.files,function(e){e.destroy()}),this.files=null}})}var f=["ready","change","cancel","mouseenter","mouseleave","mousedown","mouseup"];return a.prototype=i.instance,a}),r(E,[f,h,p,a,b,g,d,l],function(e,t,n,r,i,s,o,u){function a(n){var o=this,a;"string"==typeof n&&(n={drop_zone:n}),a={accept:[{title:e.translate("All Files"),extensions:"*"}],required_caps:{drag_and_drop:!0}},n="object"==typeof n?r.extend({},a,n):a,n.container=t.get(n.drop_zone)||document.body,"static"===t.getStyle(n.container,"position")&&(n.container.style.position="relative"),"string"==typeof n.accept&&(n.accept=u.mimes2extList(n.accept)),s.call(o),r.extend(o,{uid:r.guid("uid_"),ruid:null,files:null,init:function(){o.convertEventPropsToHandlers(f),o.bind("RuntimeInit",function(e,t){o.ruid=t.uid,o.bind("Drop",function(){var e=t.exec.call(o,"FileDrop","getFiles");o.files=[],r.each(e,function(e){o.files.push(new i(o.ruid,e))})},999),t.exec.call(o,"FileDrop","init",n),o.dispatchEvent("ready")}),o.connectRuntime(n)},destroy:function(){var e=this.getRuntime();e&&(e.exec.call(this,"FileDrop","destroy"),this.disconnectRuntime()),this.files=null}})}var f=["ready","dragenter","dragleave","drop","error"];return a.prototype=o.instance,a}),r(S,[a,p,d,g],function(e,t,n,r){function i(){function n(e,n){if(this.readyState=i.EMPTY,this.error=null,this.readyState===i.LOADING||!n.ruid||!n.uid)throw new t.DOMException(t.DOMException.INVALID_STATE_ERR);this.convertEventPropsToHandlers(s),this.bind("Error",function(e,t){this.readyState=i.DONE,this.result=null,this.error=t,this.trigger("loadend")},999),this.bind("LoadStart",function(){this.readyState=i.LOADING},999),this.bind("Load",function(){this.readyState=i.DONE,this.trigger("loadend")},999),this.connectRuntime(n.ruid).exec.call(this,"FileReader","read",e,n)}r.call(this),e.extend(this,{uid:e.guid("uid_"),readyState:i.EMPTY,result:null,error:null,readAsBinaryString:function(e){this.result="",n.call(this,"readAsBinaryString",e)},readAsDataURL:function(e){n.call(this,"readAsDataURL",e)},readAsArrayBuffer:function(e){n.call(this,"readAsArrayBuffer",e)},readAsText:function(e){n.call(this,"readAsText",e)},abort:function(){if(this.result=null,!~e.inArray(this.readyState,[i.EMPTY,i.DONE])){this.readyState===i.LOADING&&(this.readyState=i.DONE);var t=this.getRuntime();t&&t.exec.call(this,"FileReader","abort"),this.bind("Abort",function(){this.trigger("loadend")})}},destroy:function(){this.abort();var e=this.getRuntime();e&&(e.exec.call(this,"FileReader","destroy"),this.disconnectRuntime())}})}var s=["loadstart","progress","load","abort","error","loadend"];return i.EMPTY=0,i.LOADING=1,i.DONE=2,i.prototype=n.instance,i}),r(x,[],function(){var e=function(e){for(var t=["source","scheme","authority","userInfo","user","pass","host","port","relative","path","directory","file","query","fragment"],n=t.length,r={http:80,https:443},i={},s=/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/,o=s.exec(e||"");n--;)o[n]&&(i[t[n]]=o[n]);if(/^[^\/]/.test(i.path)&&!i.scheme){var u=document.location.pathname;/(\/|\/[^\.]+)$/.test(u)||(u=u.replace(/[^\/]+$/,"")),i.host=document.location.hostname,i.path=u+(i.path||"")}return i.scheme||(i.scheme=document.location.protocol.replace(/:$/,"")),i.host||(i.host=document.location.hostname),i.port||(i.port=document.location.port||r[i.scheme]||80),i.port=parseInt(i.port,10),i.path||(i.path="/"),delete i.source,i},t=function(t){var n={http:80,https:443},r=e(t);return r.scheme+"://"+r.host+(r.port!==n[r.scheme]?":"+r.port:"")+r.path+(r.query?r.query:"")},n=function(t){function n(e){return[e.scheme,e.host,e.port].join("/")}return"string"==typeof t&&(t=e(t)),n(e())===n(t)};return{parseUrl:e,resolveUrl:t,hasSameOrigin:n}}),r(T,[a,g,d],function(e,t,n){function r(){this.uid=e.guid("uid_"),t.call(this),this.destroy=function(){this.disconnectRuntime(),this.unbindAll()}}return r.prototype=n.instance,r}),r(N,[a,g,v],function(e,t,n){return function(){function r(e,t){if(!t.isDetached()){var r=this.connectRuntime(t.ruid).exec.call(this,"FileReaderSync","read",e,t);return this.disconnectRuntime(),r}var i=t.getSource();switch(e){case"readAsBinaryString":return i;case"readAsDataURL":return"data:"+t.type+";base64,"+n.btoa(i);case"readAsText":for(var s="",o=0,u=i.length;u>o;o++)s+=String.fromCharCode(i[o]);return s}}t.call(this),e.extend(this,{uid:e.guid("uid_"),readAsBinaryString:function(e){return r.call(this,"readAsBinaryString",e)},readAsDataURL:function(e){return r.call(this,"readAsDataURL",e)},readAsText:function(e){return r.call(this,"readAsText",e)}})}}),r(C,[p,a,y],function(e,t,n){function r(){var e,r={},i="";t.extend(this,{append:function(i,s){var o=this,u=t.typeOf(s);s instanceof n?(e&&delete r[e],e=i,r[i]=[s]):"array"===u?(i+="[]",t.each(s,function(e){o.append.call(o,i,e)})):"object"===u?t.each(s,function(e,t){o.append.call(o,i+"["+t+"]",e)}):(s=s.toString(),r[i]||(r[i]=[]),r[i].push(s))},hasBlob:function(){return!!e},getBlob:function(){return r[e]&&r[e][0]||null},getBlobName:function(){return e||null},each:function(e){t.each(r,function(n,r){t.each(n,function(t){e(t,r)})})},destroy:function(){e=null,i="",r={}}})}return r}),r(k,[a,p,d,v,x,T,y,N,C,c,l],function(e,t,n,r,i,s,o,u,a,f,l){function c(){this.uid=e.guid("uid_")}function h(){function n(e,t){return T.hasOwnProperty(e)?1===arguments.length?f.can("define_property")?T[e]:x[e]:(f.can("define_property")?T[e]=t:x[e]=t,void 0):void 0}function u(){return!window.XMLHttpRequest||"IE"===f.browser&&f.version<8?function(){for(var e=["Msxml2.XMLHTTP.6.0","Microsoft.XMLHTTP"],t=0;t<e.length;t++)try{return new ActiveXObject(e[t])}catch(n){}}():new window.XMLHttpRequest}function g(e){var t=e.responseXML,n=e.responseText;return"IE"===f.browser&&n&&t&&!t.documentElement&&/[^\/]+\/[^\+]+\+xml/.test(e.getResponseHeader("Content-Type"))&&(t=new window.ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.validateOnParse=!1,t.loadXML(n)),t&&("IE"===f.browser&&0!==t.parseError||!t.documentElement||"parsererror"===t.documentElement.tagName)?null:t}function y(){var t=this,r=0;$=v,W=u(),W.onreadystatechange=function i(){switch(n("readyState")>h.HEADERS_RECEIVED&&(n("status",W.status),n("statusText",W.statusText)),n("readyState",W.readyState),W.readyState!==h.OPENED&&t.dispatchEvent("readystatechange"),n("readyState")){case h.OPENED:i.loadstartDispatched||(t.dispatchEvent("loadstart"),i.loadstartDispatched=!0);break;case h.HEADERS_RECEIVED:try{F&&(r=W.getResponseHeader("Content-Length")||0)}catch(e){}break;case h.LOADING:var s=0;try{W.responseText&&(s=W.responseText.length)}catch(e){s=0}t.dispatchEvent({type:"progress",lengthComputable:!!r,total:parseInt(r,10),loaded:s});break;case h.DONE:W.onreadystatechange=function(){},0===W.status?(j=!0,t.dispatchEvent("error")):(n("responseText",W.responseText),n("responseXML",g(W)),n("response","document"===n("responseType")?n("responseXML"):n("responseText")),X=W.getAllResponseHeaders(),t.dispatchEvent("load")),W=null,t.dispatchEvent("loadend")}},W.open(k,C,N,A,O),e.isEmptyObj(L)||e.each(L,function(e,t){W.setRequestHeader(t,e)}),W.send()}function b(t){function r(){W.destroy(),W=null,o.dispatchEvent("loadend"),o=null}function i(i){W.bind("LoadStart",function(e){n("readyState",h.LOADING),o.dispatchEvent(e),H&&o.upload.dispatchEvent(e)}),W.bind("Progress",function(e){n("readyState",h.LOADING),o.dispatchEvent("readystatechange"),o.dispatchEvent(e)}),W.bind("UploadProgress",function(e){H&&o.upload.dispatchEvent({type:"progress",lengthComputable:!1,total:e.total,loaded:e.loaded})}),W.bind("Load",function(t){n("readyState",h.DONE),n("status",Number(i.exec.call(W,"XMLHttpRequest","getStatus")||0)),n("statusText",p[n("status")]||""),n("response",i.exec.call(W,"XMLHttpRequest","getResponse",n("responseType"))),~e.inArray(n("responseType"),["text",""])?n("responseText",n("response")):"document"===n("responseType")&&n("responseXML",n("response")),X=i.exec.call(W,"XMLHttpRequest","getAllResponseHeaders"),o.dispatchEvent("readystatechange"),n("status")>0?(H&&o.upload.dispatchEvent(t),o.dispatchEvent(t)):(j=!0,o.dispatchEvent("error")),r()}),W.bind("Abort",function(e){o.dispatchEvent(e),r()}),W.bind("Error",function(e){j=!0,n("readyState",h.DONE),o.dispatchEvent("readystatechange"),B=!0,o.dispatchEvent(e),r()}),i.exec.call(W,"XMLHttpRequest","send",{url:C,method:k,async:N,user:A,password:O,headers:L,mimeType:_,encoding:M,responseType:o.responseType,withCredentials:o.withCredentials,options:z},t)}var o=this;$=m,W=new s,z.required_caps=e.extend({},z.required_caps,{return_response_type:o.responseType}),z.ruid?i(W.connectRuntime(z)):(W.bind("RuntimeInit",function(e,t){i(t)}),W.bind("RuntimeError",function(e,t){o.dispatchEvent("RuntimeError",t)}),W.connectRuntime(z))}function w(e){I=(new Date).getTime(),E.call(this)?y.call(this,e):b.call(this,e)}function E(){return F&&("HEAD"===k||"GET"===k&&!!~e.inArray(n("responseType"),["","text","document"])||"POST"===k&&"application/x-www-form-urlencoded"===L["Content-Type"])}function S(){n("responseText",""),n("responseXML",null),n("response",null),n("status",0),n("statusText",""),I=q=null}var x=this,T={timeout:0,readyState:h.UNSENT,withCredentials:!1,status:0,statusText:"",responseType:"",responseXML
:null,responseText:null,response:null},N=!0,C,k,L={},A,O,M=null,_=null,D=!1,P=!1,H=!1,B=!1,j=!1,F=!1,I,q,R=null,U=null,z={},W,X="",V,$=v;e.extend(this,T,{uid:e.guid("uid_"),upload:new c,open:function(s,o,u,a,f){var l;if(!s||!o)throw new t.DOMException(t.DOMException.SYNTAX_ERR);if(/[\u0100-\uffff]/.test(s)||r.utf8_encode(s)!==s)throw new t.DOMException(t.DOMException.SYNTAX_ERR);if(~e.inArray(s.toUpperCase(),["CONNECT","DELETE","GET","HEAD","OPTIONS","POST","PUT","TRACE","TRACK"])&&(k=s.toUpperCase()),~e.inArray(k,["CONNECT","TRACE","TRACK"]))throw new t.DOMException(t.DOMException.SECURITY_ERR);if(o=r.utf8_encode(o),l=i.parseUrl(o),F=i.hasSameOrigin(l),C=i.resolveUrl(o),(a||f)&&!F)throw new t.DOMException(t.DOMException.INVALID_ACCESS_ERR);if(A=a||l.user,O=f||l.pass,N=u||!0,N===!1&&(n("timeout")||n("withCredentials")||""!==n("responseType")))throw new t.DOMException(t.DOMException.INVALID_ACCESS_ERR);D=!N,P=!1,L={},S.call(this),n("readyState",h.OPENED),this.convertEventPropsToHandlers(["readystatechange"]),this.dispatchEvent("readystatechange")},setRequestHeader:function(i,s){var o=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","content-transfer-encoding","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"];if(n("readyState")!==h.OPENED||P)throw new t.DOMException(t.DOMException.INVALID_STATE_ERR);if(/[\u0100-\uffff]/.test(i)||r.utf8_encode(i)!==i)throw new t.DOMException(t.DOMException.SYNTAX_ERR);return i=e.trim(i).toLowerCase(),~e.inArray(i,o)||/^(proxy\-|sec\-)/.test(i)?!1:(L[i]?L[i]+=", "+s:L[i]=s,!0)},getAllResponseHeaders:function(){return X||""},getResponseHeader:function(t){return t=t.toLowerCase(),j||~e.inArray(t,["set-cookie","set-cookie2"])?null:X&&""!==X&&(V||(V={},e.each(X.split(/\r\n/),function(t){var n=t.split(/:\s+/);2===n.length&&(n[0]=e.trim(n[0]),V[n[0].toLowerCase()]={header:n[0],value:e.trim(n[1])})})),V.hasOwnProperty(t))?V[t].header+": "+V[t].value:null},overrideMimeType:function(r){var i,s;if(~e.inArray(n("readyState"),[h.LOADING,h.DONE]))throw new t.DOMException(t.DOMException.INVALID_STATE_ERR);if(r=e.trim(r.toLowerCase()),/;/.test(r)&&(i=r.match(/^([^;]+)(?:;\scharset\=)?(.*)$/))&&(r=i[1],i[2]&&(s=i[2])),!l.mimes[r])throw new t.DOMException(t.DOMException.SYNTAX_ERR);R=r,U=s},send:function(n,i){if(z="string"===e.typeOf(i)?{ruid:i}:i?i:{},this.convertEventPropsToHandlers(d),this.upload.convertEventPropsToHandlers(d),this.readyState!==h.OPENED||P)throw new t.DOMException(t.DOMException.INVALID_STATE_ERR);if(!E())if(n instanceof o)z.ruid=n.ruid,_=n.type;else if(n instanceof a){if(n.hasBlob()){var s=n.getBlob();z.ruid=s.ruid,_=s.type}}else"string"==typeof n&&(M="UTF-8",_="text/plain;charset=UTF-8",n=r.utf8_encode(n));this.withCredentials||(this.withCredentials=z.required_caps&&z.required_caps.send_browser_cookies&&!F),H=!D&&this.upload.hasEventListener(),j=!1,B=!n,D||(P=!0),w.call(this,n)},abort:function(){var r;if(j=!0,D=!1,~e.inArray(n("readyState"),[h.UNSENT,h.OPENED,h.DONE]))n("readyState",h.UNSENT);else{if(n("readyState",h.DONE),P=!1,$===v)W.abort(),this.dispatchEvent("readystatechange"),this.dispatchEvent("abort"),this.dispatchEvent("loadend"),B||(this.upload.dispatchEvent("abort"),this.upload.dispatchEvent("loadend"));else{if("function"!==e.typeOf(W.getRuntime)||!(r=W.getRuntime()))throw new t.DOMException(t.DOMException.INVALID_STATE_ERR);r.exec.call(W,"XMLHttpRequest","abort",B)}B=!0}},destroy:function(){W&&("function"===e.typeOf(W.destroy)&&W.destroy(),W=null),this.unbindAll(),this.upload&&(this.upload.unbindAll(),this.upload=null)}})}var p={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",306:"Reserved",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",426:"Upgrade Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",510:"Not Extended"};c.prototype=n.instance;var d=["loadstart","progress","abort","error","load","timeout","loadend"],v=1,m=2;return h.UNSENT=0,h.OPENED=1,h.HEADERS_RECEIVED=2,h.LOADING=3,h.DONE=4,h.prototype=n.instance,h}),r(L,[a,v,g,d],function(e,t,n,r){function i(){function r(){l=c=0,f=this.result=null}function s(t,n){var r=this;a=n,r.bind("TransportingProgress",function(t){c=t.loaded,l>c&&-1===e.inArray(r.state,[i.IDLE,i.DONE])&&o.call(r)},999),r.bind("TransportingComplete",function(){c=l,r.state=i.DONE,f=null,r.result=a.exec.call(r,"Transporter","getAsBlob",t||"")},999),r.state=i.BUSY,r.trigger("TransportingStarted"),o.call(r)}function o(){var e=this,n,r=l-c;h>r&&(h=r),n=t.btoa(f.substr(c,h)),a.exec.call(e,"Transporter","receive",n,l)}var u,a,f,l,c,h;n.call(this),e.extend(this,{uid:e.guid("uid_"),state:i.IDLE,result:null,transport:function(t,n,i){var o=this;if(i=e.extend({chunk_size:204798},i),(u=i.chunk_size%3)&&(i.chunk_size+=3-u),h=i.chunk_size,r.call(this),f=t,l=t.length,"string"===e.typeOf(i)||i.ruid)s.call(o,n,this.connectRuntime(i));else{var a=function(e,t){o.unbind("RuntimeInit",a),s.call(o,n,t)};this.bind("RuntimeInit",a),this.connectRuntime(i)}},abort:function(){var e=this;e.state=i.IDLE,a&&(a.exec.call(e,"Transporter","clear"),e.trigger("TransportingAborted")),r.call(e)},destroy:function(){this.unbindAll(),a=null,this.disconnectRuntime(),r.call(this)}})}return i.IDLE=0,i.BUSY=1,i.DONE=2,i.prototype=r.instance,i}),r(A,[],function(){return!!window.JSON&&JSON.parse||function(){var e,n,r={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"	"},i,s=function(t){throw{name:"SyntaxError",message:t,at:e,text:i}},o=function(t){return t&&t!==n&&s("Expected '"+t+"' instead of '"+n+"'"),n=i.charAt(e),e+=1,n},u=function(){var e,t="";for("-"===n&&(t="-",o("-"));n>="0"&&"9">=n;)t+=n,o();if("."===n)for(t+=".";o()&&n>="0"&&"9">=n;)t+=n;if("e"===n||"E"===n)for(t+=n,o(),("-"===n||"+"===n)&&(t+=n,o());n>="0"&&"9">=n;)t+=n,o();return e=+t,isFinite(e)?e:(s("Bad number"),void 0)},a=function(){var e,t,i="",u;if('"'===n)for(;o();){if('"'===n)return o(),i;if("\\"===n)if(o(),"u"===n){for(u=0,t=0;4>t&&(e=parseInt(o(),16),isFinite(e));t+=1)u=16*u+e;i+=String.fromCharCode(u)}else{if("string"!=typeof r[n])break;i+=r[n]}else i+=n}s("Bad string")},f=function(){for(;n&&" ">=n;)o()},l=function(){switch(n){case"t":return o("t"),o("r"),o("u"),o("e"),!0;case"f":return o("f"),o("a"),o("l"),o("s"),o("e"),!1;case"n":return o("n"),o("u"),o("l"),o("l"),null}s("Unexpected '"+n+"'")},c,h=function(){var e=[];if("["===n){if(o("["),f(),"]"===n)return o("]"),e;for(;n;){if(e.push(c()),f(),"]"===n)return o("]"),e;o(","),f()}}s("Bad array")},p=function(){var e,t={};if("{"===n){if(o("{"),f(),"}"===n)return o("}"),t;for(;n;){if(e=a(),f(),o(":"),Object.hasOwnProperty.call(t,e)&&s('Duplicate key "'+e+'"'),t[e]=c(),f(),"}"===n)return o("}"),t;o(","),f()}}s("Bad object")};return c=function(){switch(f(),n){case"{":return p();case"[":return h();case'"':return a();case"-":return u();default:return n>="0"&&"9">=n?u():l()}},function(r,o){var u;return i=r,e=0,n=" ",u=c(),f(),n&&s("Syntax error"),"function"==typeof o?function a(e,n){var r,i,s=e[n];if(s&&"object"==typeof s)for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(i=a(s,r),i!==t?s[r]=i:delete s[r]);return o.call(e,n,s)}({"":u},""):u}}()}),r(O,[a,h,p,N,k,g,L,c,d,y,b,v,A],function(e,t,n,r,i,s,o,u,a,f,l,c,h){function p(){function r(t){if(t||(t=this.getRuntime().exec.call(this,"Image","getInfo")),t)if("string"===e.typeOf(t.meta))try{this.meta=h(t.meta)}catch(n){}else this.meta=t.meta;e.extend(this,{size:parseInt(t.size,10),width:parseInt(t.width,10),height:parseInt(t.height,10),type:t.type}),""===this.name&&(this.name=t.name)}function a(t){var r=e.typeOf(t);try{if(t instanceof p){if(!t.size)throw new n.DOMException(n.DOMException.INVALID_STATE_ERR);v.apply(this,arguments)}else if(t instanceof f){if(!~e.inArray(t.type,["image/jpeg","image/png"]))throw new n.ImageError(n.ImageError.WRONG_FORMAT);m.apply(this,arguments)}else if(-1!==e.inArray(r,["blob","file"]))a.call(this,new l(null,t),arguments[1]);else if("string"===r)/^data:[^;]*;base64,/.test(t)?a.call(this,new f(null,{data:t}),arguments[1]):g.apply(this,arguments);else{if("node"!==r||"img"!==t.nodeName)throw new n.DOMException(n.DOMException.TYPE_MISMATCH_ERR);a.call(this,t.src,arguments[1])}}catch(i){this.trigger("error")}}function v(t,n){var r=this.connectRuntime(t.ruid);this.ruid=r.uid,r.exec.call(this,"Image","loadFromImage",t,"undefined"===e.typeOf(n)?!0:n)}function m(t,n){function r(e){i.ruid=e.uid,e.exec.call(i,"Image","loadFromBlob",t)}var i=this;i.name=t.name||"",t.isDetached()?(this.bind("RuntimeInit",function(e,t){r(t)}),this.connectRuntime(e.extend({required_caps:{access_image_binary:!0,resize_image:!0}},n))):r(this.connectRuntime(t.ruid))}function g(e,t){var n=this,r;r=new i,r.open("get",e),r.responseType="blob",r.onprogress=function(e){n.trigger(e)},r.onload=function(){m.call(n,r.response,!0)},r.onerror=function(e){n.trigger(e)},r.onloadend=function(){r.destroy()},r.bind("RuntimeError",function(e,t){n.trigger("RuntimeError",t)}),r.send(null,t)}s.call(this),e.extend(this,{uid:e.guid("uid_"),ruid:null,name:"",size:0,width:0,height:0,type:"",meta:{},clone:function(){this.load.apply(this,arguments)},load:function(){this.bind("Load Resize",function(){r.call(this)},999),this.convertEventPropsToHandlers(d),a.apply(this,arguments)},downsize:function(t,r,i,s){if(!this.size)throw new n.DOMException(n.DOMException.INVALID_STATE_ERR);(!t&&!r||"undefined"===e.typeOf(i))&&(i=!1),t=t||this.width,r=r||this.height,s="undefined"===e.typeOf(s)?!0:!!s,this.getRuntime().exec.call(this,"Image","downsize",t,r,i,s)},crop:function(e,t,n){this.downsize(e,t,!0,n)},getAsCanvas:function(){if(!u.can("create_canvas"))throw new n.RuntimeError(n.RuntimeError.NOT_SUPPORTED_ERR);var e=this.connectRuntime(this.ruid);return e.exec.call(this,"Image","getAsCanvas")},getAsBlob:function(e,t){if(!this.size)throw new n.DOMException(n.DOMException.INVALID_STATE_ERR);return e||(e="image/jpeg"),"image/jpeg"!==e||t||(t=90),this.getRuntime().exec.call(this,"Image","getAsBlob",e,t)},getAsDataURL:function(e,t){if(!this.size)throw new n.DOMException(n.DOMException.INVALID_STATE_ERR);return this.getRuntime().exec.call(this,"Image","getAsDataURL",e,t)},getAsBinaryString:function(e,t){var n=this.getAsDataURL(e,t);return c.atob(n.substring(n.indexOf("base64,")+7))},embed:function(r){function i(){if(u.can("create_canvas")){var t=a.getAsCanvas();if(t)return r.appendChild(t),t=null,a.destroy(),s.trigger("embedded"),void 0}var i=a.getAsDataURL(f,l);if(!i)throw new n.ImageError(n.ImageError.WRONG_FORMAT);if(u.can("use_data_uri_of",i.length))r.innerHTML='<img src="'+i+'" width="'+a.width+'" height="'+a.height+'" />',a.destroy(),s.trigger("embedded");else{var h=new o;h.bind("TransportingComplete",function(){g=s.connectRuntime(this.result.ruid),s.bind("Embedded",function(){e.extend(g.getShimContainer().style,{top:"0px",left:"0px",width:a.width+"px",height:a.height+"px"}),g=null},999),g.exec.call(s,"ImageView","display",this.result.uid,v,m),a.destroy()}),h.transport(c.atob(i.substring(i.indexOf("base64,")+7)),f,e.extend({},d,{required_caps:{display_media:!0},runtime_order:"flash,silverlight",container:r}))}}var s=this,a,f,l,h,d=arguments[1]||{},v=this.width,m=this.height,g;if(!(r=t.get(r)))throw new n.DOMException(n.DOMException.INVALID_NODE_TYPE_ERR);if(!this.size)throw new n.DOMException(n.DOMException.INVALID_STATE_ERR);if(f=d.type||this.type||"image/jpeg",l=d.quality||90,h="undefined"!==e.typeOf(d.crop)?d.crop:!1,d.width)v=d.width,m=d.height||v;else{var y=t.getSize(r);y.w&&y.h&&(v=y.w,m=y.h)}return a=new p,a.bind("Resize",function(){i.call(s)}),a.bind("Load",function(){a.downsize(v,m,h,!1)}),a.clone(this,!1),a},destroy:function(){this.ruid&&(this.getRuntime().exec.call(this,"Image","destroy"),this.disconnectRuntime()),this.unbindAll()}})}var d=["progress","load","error","resize","embedded"];return p.prototype=a.instance,p}),r(M,[a,p,m,c],function(e,t,n,r){function i(i){var u=this,a=n.capTest,f=n.capTrue,l=e.extend({access_binary:a(window.FileReader||window.File&&window.File.getAsDataURL),access_image_binary:function(){return u.can("access_binary")&&!!o.Image},display_media:a(r.can("create_canvas")||r.can("use_data_uri_over32kb")),do_cors:a(window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest),drag_and_drop:a(function(){var e=document.createElement("div");return("draggable"in e||"ondragstart"in e&&"ondrop"in e)&&("IE"!==r.browser||r.version>9)}()),return_response_headers:f,return_response_type:function(e){return"json"===e?!0:r.can("return_response_type",e)},report_upload_progress:a(window.XMLHttpRequest&&(new XMLHttpRequest).upload),resize_image:function(){return u.can("access_binary")&&r.can("create_canvas")},select_folder:a("Chrome"===r.browser&&r.version>=21),select_multiple:a("Safari"!==r.browser||"Windows"!==r.OS),send_binary_string:a(window.XMLHttpRequest&&((new XMLHttpRequest).sendAsBinary||window.Uint8Array&&window.ArrayBuffer)),send_custom_headers:a(window.XMLHttpRequest),send_multipart:function(){return!!(window.XMLHttpRequest&&(new XMLHttpRequest).upload&&window.FormData)||u.can("send_binary_string")},slice_blob:a(window.File&&(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice)),stream_upload:function(){return u.can("slice_blob")&&u.can("send_multipart")},summon_file_dialog:a(function(){return"Firefox"===r.browser&&r.version>=4||"Opera"===r.browser&&r.version>=12||"IE"===r.browser&&r.version>=10||!!~e.inArray(r.browser,["Chrome","Safari"])}()),upload_filesize:f},arguments[2]);n.call(this,i,arguments[1]||s,l),e.extend(this,{init:function(){return window.File&&r.can("use_fileinput")?(this.trigger("Init"),void 0):(this.trigger("Error",new t.RuntimeError(t.RuntimeError.NOT_INIT_ERR)),void 0)},destroy:function(e){return function(){e.call(u),e=u=null}}(this.destroy)}),e.extend(this.getShim(),o)}var s="html5",o={};return n.addConstructor(s,i),o}),r(_,[M,y],function(e,t){function n(){function e(e,t,n){var r;if(!window.File.prototype.slice)return(r=window.File.prototype.webkitSlice||window.File.prototype.mozSlice)?r.call(e,t,n):null;try{return e.slice(),e.slice(t,n)}catch(i){return e.slice(t,n-t)}}this.slice=function(){return new t(this.getRuntime().uid,e.apply(this,arguments))}}return e.Blob=n}),r(D,[a],function(e){function t(){this.returnValue=!1}function n(){this.cancelBubble=!0}var r={},i="moxie_"+e.guid(),s=function(s,o,u,a){var f,l;o=o.toLowerCase(),s.addEventListener?(f=u,s.addEventListener(o,f,!1)):s.attachEvent&&(f=function(){var e=window.event;e.target||(e.target=e.srcElement),e.preventDefault=t,e.stopPropagation=n,u(e)},s.attachEvent("on"+o,f)),s[i]||(s[i]=e.guid()),r.hasOwnProperty(s[i])||(r[s[i]]={}),l=r[s[i]],l.hasOwnProperty(o)||(l[o]=[]),l[o].push({func:f,orig:u,key:a})},o=function(t,n,s){var o,u;if(n=n.toLowerCase(),t[i]&&r[t[i]]&&r[t[i]][n]){o=r[t[i]][n];for(var a=o.length-1;a>=0&&(o[a].orig!==s&&o[a].key!==s||(t.removeEventListener?t.removeEventListener(n,o[a].func,!1):t.detachEvent&&t.detachEvent("on"+n,o[a].func),o[a].orig=null,o[a].func=null,o.splice(a,1),s===u));a--);if(o.length||delete r[t[i]][n],e.isEmptyObj(r[t[i]])){delete r[t[i]];try{delete t[i]}catch(f){t[i]=u}}}},u=function(t,n){t&&t[i]&&e.each(r[t[i]],function(e,r){o(t,r,n)})};return{addEvent:s,removeEvent:o,removeAllEvents:u}}),r(P,[M,a,h,D,l],function(e,t,n,r,i){function s(){var e=[],s;t.extend(this,{init:function(o){var u=this,a=u.getRuntime(),f,l,c;s=o,e=[],c=s.accept.mimes||i.extList2mimes(s.accept),l=a.getShimContainer(),l.innerHTML='<input id="'+a.uid+'" type="file" style="font-size:999px;opacity:0;"'+(s.multiple&&a.can("select_multiple")?"multiple":"")+(s.directory&&a.can("select_folder")?"webkitdirectory directory":"")+' accept="'+c.join(",")+'" />',f=n.get(a.uid),t.extend(f.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"}),function(){var e,t,i;e=n.get(s.browse_button),a.can("summon_file_dialog")&&("static"===n.getStyle(e,"position")&&(e.style.position="relative"),t=parseInt(n.getStyle(e,"z-index"),10)||1,e.style.zIndex=t,l.style.zIndex=t-1,r.addEvent(e,"click",function(e){f&&!f.disabled&&f.click(),e.preventDefault()},u.uid)),i=a.can("summon_file_dialog")?e:l,r.addEvent(i,"mouseover",function(){u.trigger("mouseenter")},u.uid),r.addEvent(i,"mouseout",function(){u.trigger("mouseleave")},u.uid),r.addEvent(i,"mousedown",function(){u.trigger("mousedown")},u.uid),r.addEvent(n.get(s.container),"mouseup",function(){u.trigger("mouseup")},u.uid)}(),f.onchange=function(){e=[],s.directory?t.each(this.files,function(t){"."!==t.name&&e.push(t)}):e=[].slice.call(this.files),this.value="",u.trigger("change")},u.trigger({type:"ready",async:!0})},getFiles:function(){return e},disable:function(e){var t=this.getRuntime(),r;(r=n.get(t.uid))&&(r.disabled=!!e)},destroy:function(){var t=this.getRuntime(),i=t.getShimContainer();r.removeAllEvents(i,this.uid),r.removeAllEvents(s&&n.get(s.container),this.uid),r.removeAllEvents(s&&n.get(s.browse_button),this.uid),i&&(i.innerHTML=""),e=s=null}})}return e.FileInput=s}),r(H,[M,a,h,D,l],function(e,t,n,r,i){function s(){function e(e){var n=f.accept.mimes||i.extList2mimes(f.accept),r=e.type||i.getFileMime(e.name)||"";return n.length&&-1===t.inArray(r,n)?!1:!0}function s(e,n){var r=[];t.each(e,function(e){r.push(function(t){o(e,t)})}),t.inSeries(r,function(){n()})}function o(t,n){t.isFile?t.file(function(t){e(t)&&a.push(t),n()},function(){n()}):t.isDirectory?u(t,n):n()}function u(e,t){function n(e){i.readEntries(function(t){t.length?([].push.apply(r,t),n(e)):e()},e)}var r=[],i=e.createReader();n(function(){s(r,t)})}var a=[],f;t.extend(this,{init:function(n){var i=this,o;f=n,o=f.container,r.addEvent(o,"dragover",function(e){e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="copy"},i.uid),r.addEvent(o,"drop",function(n){if(n.preventDefault(),n.stopPropagation(),a=[],n.dataTransfer.items&&n.dataTransfer.items[0].webkitGetAsEntry){var r=[];t.each(n.dataTransfer.items,function(e){r.push(e.webkitGetAsEntry())}),s(r,function(){i.trigger("drop")})}else t.each(n.dataTransfer.files,function(t){e(t)&&a.push(t)}),i.trigger("drop")},i.uid),r.addEvent(o,"dragenter",function(e){e.preventDefault(),e.stopPropagation(),i.trigger("dragenter")},i.uid),r.addEvent(o,"dragleave",function(e){e.preventDefault(),e.stopPropagation(),i.trigger("dragleave")},i.uid)},getFiles:function(){return a},destroy:function(){r.removeAllEvents(f&&n.get(f.container),this.uid),a=f=null}})}return e.FileDrop=s}),r(B,[M,a],function(e,t){function n(){this.read=function(e,n){var r=this,i=new window.FileReader;!function(){function e(e){~t.inArray(e.type,["progress","load"])&&(r.result=i.result),r.trigger(e)}function n(){t.each(s,function(t){i.removeEventListener(t,e)}),i.removeEventListener("loadend",n)}var s=["loadstart","progress","load","abort","error"];t.each(s,function(t){i.addEventListener(t,e)}),i.addEventListener("loadend",n)}(),"function"===t.typeOf(i[e])&&i[e](n.getSource())}}return e.FileReader=n}),r(j,[M,a,b,y,C,p,c,A],function(e,t,n,r,i,s,o,u){function a(){function e(e){var t="----moxieboundary"+(new Date).getTime(),n="--",i="\r\n",o="",u=this.getRuntime();if(!u.can("send_binary_string"))throw new s.RuntimeError(s.RuntimeError.NOT_SUPPORTED_ERR);return f.setRequestHeader("Content-Type","multipart/form-data; boundary="+t),e.each(function(e,s){o+=e instanceof r?n+t+i+'Content-Disposition: form-data; name="'+s+'"; filename="'+unescape(encodeURIComponent(e.name||"blob"))+'"'+i+"Content-Type: "+e.type+i+i+e.getSource()+i:n+t+i+'Content-Disposition: form-data; name="'+s+'"'+i+i+unescape(encodeURIComponent(e))+i}),o+=n+t+n+i}var a=this,f,l;t.extend(this,{send:function(n,s){var u=this,c=!1,h,p,d,v="Mozilla"===o.browser&&o.version>=4&&o.version<7,m="Android Browser"===o.browser;return(v||m)&&s instanceof i&&s.hasBlob()&&!s.getBlob().isDetached()&&(p=s.getBlob().getSource(),p instanceof window.Blob&&window.FileReader)?(d=new window.FileReader,d.onload=function(){s.append(s.getBlobName(),new r(null,{type:p.type,data:d.result})),a.send.call(u,n,s)},d.readAsBinaryString(p),void 0):(f=new window.XMLHttpRequest,l=n.url.replace(/^.+?\/([\w\-\.]+)$/,"$1").toLowerCase(),f.open(n.method,n.url,n.async,n.user,n.password),t.isEmptyObj(n.headers)||t.each(n.headers,function(e,t){f.setRequestHeader(t,e)}),""!==n.responseType&&(f.responseType="json"!==n.responseType||o.can("return_response_type","json")?n.responseType:"text"),n.withCredentials&&(f.withCredentials=!0),function(){function e(e){u.trigger(e)}function n(e){u.trigger({type:"UploadProgress",loaded:e.loaded,total:e.total})}function r(){t.each(i,function(t){f.removeEventListener(t,e)}),f.removeEventListener("loadend",r),f.upload&&f.upload.removeEventListener("progress",n),f=null}var i=["loadstart","progress","abort","error","load","timeout"];t.each(i,function(t){f.addEventListener(t,e)}),f.upload&&f.upload.addEventListener("progress",n),f.addEventListener("loadend",r)}(),s instanceof r?(s.isDetached()&&(c=!0),s=s.getSource()):s instanceof i&&(s.hasBlob()&&s.getBlob().isDetached()?(s=e.call(u,s),c=!0):(h=new window.FormData,s.each(function(e,t){e instanceof r?h.append(t,e.getSource()):h.append(t,e)}),s=h)),c?f.sendAsBinary?f.sendAsBinary(s):function(){for(var e=new Uint8Array(s.length),t=0;t<s.length;t++)e[t]=255&s.charCodeAt(t);f.send(e.buffer)}():f.send(s),void 0)},getStatus:function(){try{if(f)return f.status}catch(e){}},getResponse:function(e){var t=this.getRuntime();try{if(f){if("blob"===e){var r=new n(t.uid,f.response);try{var i=f.getResponseHeader("Content-Disposition");if(i){var s=i.match(/filename=([\'\"'])([^\1]+)\1/);s&&(l=s[2])}}catch(a){}return r.name=l,r}return"json"!==e||o.can("return_response_type","json")?f.response:200===f.status?u(f.response):null}}catch(a){}},getAllResponseHeaders:function(){try{return f.getAllResponseHeaders()}catch(e){}return""},abort:function(){f&&f.abort()},destroy:function(){a=l=null}})}return e.XMLHttpRequest=a}),r(F,[],function(){return function(){function e(e,t){var n=i?0:-8*(t-1),r=0,o;for(o=0;t>o;o++)r|=s.charCodeAt(e+o)<<Math.abs(n+8*o);return r}function n(e,t,n){n=3===arguments.length?n:s.length-t-1,s=s.substr(0,t)+e+s.substr(n+t)}function r(e,t,r){var s="",o=i?0:-8*(r-1),u;for(u=0;r>u;u++)s+=String.fromCharCode(255&t>>Math.abs(o+8*u));n(s,e,r)}var i=!1,s;return{II:function(e){return e===t?i:(i=e,void 0)},init:function(e){i=!1,s=e},SEGMENT:function(e,t,r){switch(arguments.length){case 1:return s.substr(e,s.length-e-1);case 2:return s.substr(e,t);case 3:n(r,e,t);break;default:return s}},BYTE:function(t){return e(t,1)},SHORT:function(t){return e(t,2)},LONG:function(n,i){return i===t?e(n,4):(r(n,i,4),void 0)},SLONG:function(t){var n=e(t,4);return n>2147483647?n-4294967296:n},STRING:function(t,n){var r="";for(n+=t;n>t;t++)r+=String.fromCharCode(e(t,1));return r}}}}),r(I,[F],function(e){return function t(n){var r=[],i,s,o,u=0;if(i=new e,i.init(n),65496===i.SHORT(0)){for(s=2;s<=n.length;)if(o=i.SHORT(s),o>=65488&&65495>=o)s+=2;else{if(65498===o||65497===o)break;u=i.SHORT(s+2)+2,o>=65505&&65519>=o&&r.push({hex:o,name:"APP"+(15&o),start:s,length:u,segment:i.SEGMENT(s,u)}),s+=u}return i.init(null),{headers:r,restore:function(e){var t,n;for(i.init(e),s=65504==i.SHORT(2)?4+i.SHORT(4):2,n=0,t=r.length;t>n;n++)i.SEGMENT(s,0,r[n].segment),s+=r[n].length;return e=i.SEGMENT(),i.init(null),e},strip:function(e){var n,r,s;for(r=new t(e),n=r.headers,r.purge(),i.init(e),s=n.length;s--;)i.SEGMENT(n[s].start,n[s].length,"");return e=i.SEGMENT(),i.init(null),e},get:function(e){for(var t=[],n=0,i=r.length;i>n;n++)r[n].name===e.toUpperCase()&&t.push(r[n].segment);return t},set:function(e,t){var n=[],i,s,o;for("string"==typeof t?n.push(t):n=t,i=s=0,o=r.length;o>i&&(r[i].name===e.toUpperCase()&&(r[i].segment=n[s],r[i].length=n[s].length,s++),!(s>=n.length));i++);},purge:function(){r=[],i.init(null),i=null}}}}}),r(q,[a,F],function(e,n){return function r(){function r(e,n){var r=o.SHORT(e),i,s,u,a,c,h,p,d,v=[],m={};for(i=0;r>i;i++)if(p=h=e+12*i+2,u=n[o.SHORT(p)],u!==t){switch(a=o.SHORT(p+=2),c=o.LONG(p+=2),p+=4,v=[],a){case 1:case 7:for(c>4&&(p=o.LONG(p)+f.tiffHeader),s=0;c>s;s++)v[s]=o.BYTE(p+s);break;case 2:c>4&&(p=o.LONG(p)+f.tiffHeader),m[u]=o.STRING(p,c-1);continue;case 3:for(c>2&&(p=o.LONG(p)+f.tiffHeader),s=0;c>s;s++)v[s]=o.SHORT(p+2*s);break;case 4:for(c>1&&(p=o.LONG(p)+f.tiffHeader),s=0;c>s;s++)v[s]=o.LONG(p+4*s);break;case 5:for(p=o.LONG(p)+f.tiffHeader,s=0;c>s;s++)v[s]=o.LONG(p+4*s)/o.LONG(p+4*s+4);break;case 9:for(p=o.LONG(p)+f.tiffHeader,s=0;c>s;s++)v[s]=o.SLONG(p+4*s);break;case 10:for(p=o.LONG(p)+f.tiffHeader,s=0;c>s;s++)v[s]=o.SLONG(p+4*s)/o.SLONG(p+4*s+4);break;default:continue}d=1==c?v[0]:v,m[u]=l.hasOwnProperty(u)&&"object"!=typeof d?l[u][d]:d}return m}function i(){var e=f.tiffHeader;return o.II(18761==o.SHORT(e)),42!==o.SHORT(e+=2)?!1:(f.IFD0=f.tiffHeader+o.LONG(e+=2),a=r(f.IFD0,u.tiff),"ExifIFDPointer"in a&&(f.exifIFD=f.tiffHeader+a.ExifIFDPointer,delete a.ExifIFDPointer),"GPSInfoIFDPointer"in a&&(f.gpsIFD=f.tiffHeader+a.GPSInfoIFDPointer,delete a.GPSInfoIFDPointer),!0)}function s(e,t,n){var r,i,s,a=0;if("string"==typeof t){var l=u[e.toLowerCase()];for(var c in l)if(l[c]===t){t=c;break}}r=f[e.toLowerCase()+"IFD"],i=o.SHORT(r);for(var h=0;i>h;h++)if(s=r+12*h+2,o.SHORT(s)==t){a=s+8;break}return a?(o.LONG(a,n),!0):!1}var o,u,a,f={},l;return o=new n,u={tiff:{274:"Orientation",270:"ImageDescription",271:"Make",272:"Model",305:"Software",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"}},l={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire.",1:"Flash fired.",5:"Strobe return light not detected.",7:"Strobe return light detected.",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}},{init:function(e){return f={tiffHeader:10},e!==t&&e.length?(o.init(e),65505===o.SHORT(0)&&"EXIF\0"===o.STRING(4,5).toUpperCase()?i():!1):!1},TIFF:function(){return a},EXIF:function(){var t;if(t=r(f.exifIFD,u.exif),t.ExifVersion&&"array"===e.typeOf(t.ExifVersion)){for(var n=0,i="";n<t.ExifVersion.length;n++)i+=String.fromCharCode(t.ExifVersion[n]);t.ExifVersion=i}return t},GPS:function(){var t;return t=r(f.gpsIFD,u.gps),t.GPSVersionID&&"array"===e.typeOf(t.GPSVersionID)&&(t.GPSVersionID=t.GPSVersionID.join(".")),t},setExif:function(e,t){return"PixelXDimension"!==e&&"PixelYDimension"!==e?!1:s("exif",e,t)},getBinary:function(){return o.SEGMENT()},purge:function(){o.init(null),o=a=null,f={}}}}}),r(R,[a,p,I,F,q],function(e,t,n,r,i){function s(s){function o(){for(var e=0,t,n;e<=a.length;){if(t=f.SHORT(e+=2),t>=65472&&65475>=t)return e+=5,{height:f.SHORT(e),width:f.SHORT(e+=2)};n=f.SHORT(e+=2),e+=n-2}return null}function u(){c&&l&&f&&(c.purge(),l.purge(),f.init(null),a=h=l=c=f=null)}var a,f,l,c,h,p;if(a=s,f=new r,f.init(a),65496!==f.SHORT(0))throw new t.ImageError(t.ImageError.WRONG_FORMAT);l=new n(s),c=new i,p=!!c.init(l.get("app1")[0]),h=o.call(this),e.extend(this,{type:"image/jpeg",size:a.length,width:h&&h.width||0,height:h&&h.height||0,setExif:function(t,n){return p?("object"===e.typeOf(t)?e.each(t,function(e,t){c.setExif(t,e)}):c.setExif(t,n),l.set("app1",c.getBinary()),void 0):!1},writeHeaders:function(){return arguments.length?l.restore(arguments[0]):a=l.restore(a)},stripHeaders:function(e){return l.strip(e)},purge:function(){u.call(this)}}),p&&(this.meta={tiff:c.TIFF(),exif:c.EXIF(),gps:c.GPS()})}return s}),r(U,[p,a,F],function(e,t,n){function r(r){function i(){var e,t;return e=o.call(this,8),"IHDR"==e.type?(t=e.start,{width:a.LONG(t),height:a.LONG(t+=4)}):null}function s(){a&&(a.init(null),u=c=f=l=a=null)}function o(e){var t,n,r,i;return t=a.LONG(e),n=a.STRING(e+=4,4),r=e+=4,i=a.LONG(e+t),{length:t,type:n,start:r,CRC:i}}var u,a,f,l,c;u=r,a=new n,a.init(u),function(){var t=0,n=0,r=[35152,20039,3338,6666];for(n=0;n<r.length;n++,t+=2)if(r[n]!=a.SHORT(t))throw new e.ImageError(e.ImageError.WRONG_FORMAT)}(),c=i.call(this),t.extend(this,{type:"image/png",size:u.length,width:c.width,height:c.height,purge:function(){s.call(this)}}),s.call(this)}return r}),r(z,[a,p,R,U],function(e,t,n,r){return function(i){var s=[n,r],o;o=function(){for(var e=0;e<s.length;e++)try{return new s[e](i)}catch(n){}throw new t.ImageError(t.ImageError.WRONG_FORMAT)}(),e.extend(this,{type:"",size:0,width:0,height:0,setExif:function(){},writeHeaders:function(e){return e},stripHeaders:function(e){return e},purge:function(){}}),e.extend(this,o),this.purge=function(){o.purge(),o=null}}}),r(W,[],function(){function e(e,r,i){var s=e.naturalWidth,o=e.naturalHeight,u=i.width,a=i.height,f=i.x||0,l=i.y||0,c=r.getContext("2d");t(e)&&(s/=2,o/=2);var h=1024,p=document.createElement("canvas");p.width=p.height=h;for(var d=p.getContext("2d"),v=n(e,s,o),m=0;o>m;){for(var g=m+h>o?o-m:h,y=0;s>y;){var b=y+h>s?s-y:h;d.clearRect(0,0,h,h),d.drawImage(e,-y,-m);var w=y*u/s+f<<0,E=Math.ceil(b*u/s),S=m*a/o/v+l<<0,x=Math.ceil(g*a/o/v);c.drawImage(p,0,0,b,g,w,S,E,x),y+=h}m+=h}p=d=null}function t(e){var t=e.naturalWidth,n=e.naturalHeight;if(t*n>1048576){var r=document.createElement("canvas");r.width=r.height=1;var i=r.getContext("2d");return i.drawImage(e,-t+1,0),0===i.getImageData(0,0,1,1).data[3]}return!1}function n(e,t,n){var r=document.createElement("canvas");r.width=1,r.height=n;var i=r.getContext("2d");i.drawImage(e,0,0);for(var s=i.getImageData(0,0,1,n).data,o=0,u=n,a=n;a>o;){var f=s[4*(a-1)+3];0===f?u=a:o=a,a=u+o>>1}r=null;var l=a/n;return 0===l?1:l}return{isSubsampled:t,renderTo:e}}
),r(X,[M,a,p,v,y,z,W,l,c],function(e,t,n,r,i,s,o,u,a){function f(){function e(){if(!w&&!y)throw new n.ImageError(n.DOMException.INVALID_STATE_ERR);return w||y}function f(e){return r.atob(e.substring(e.indexOf("base64,")+7))}function l(e,t){return"data:"+(t||"")+";base64,"+r.btoa(e)}function c(e){var t=this;y=new Image,y.onerror=function(){throw m.call(this),new n.ImageError(n.ImageError.WRONG_FORMAT)},y.onload=function(){t.trigger("load")},y.src=/^data:[^;]*;base64,/.test(e)?e:l(e,S.type)}function h(e,t){var n;return window.FileReader?(n=new FileReader,n.onload=function(){t(this.result)},n.readAsDataURL(e),void 0):t(e.getAsDataURL())}function p(n,r,i,s){var o=this,u,a,f,l,c,h,p,m,g;if(T=s,g=this.meta&&this.meta.tiff&&this.meta.tiff.Orientation||1,-1!==t.inArray(g,[5,6,7,8])){var y=n;n=r,r=y}return h=e(),f=i?Math.max:Math.min,a=f(n/h.width,r/h.height),a>1&&(!i||s)?(this.trigger("Resize"),void 0):(p=Math.round(h.width*a),m=Math.round(h.height*a),w||(w=document.createElement("canvas")),u=w.getContext("2d"),i?(w.width=n,w.height=r):(w.width=p,w.height=m),l=p>w.width?Math.round((p-w.width)/2):0,c=m>w.height?Math.round((m-w.height)/2):0,T||v(w.width,w.height,g),d.call(this,h,w,-l,-c,p,m),this.width=w.width,this.height=w.height,x=!0,o.trigger("Resize"),void 0)}function d(e,t,n,r,i,s){if("iOS"===a.OS)o.renderTo(e,t,{width:i,height:s,x:n,y:r});else{var u=t.getContext("2d");u.drawImage(e,n,r,i,s)}}function v(e,t,n){switch(n){case 5:case 6:case 7:case 8:w.width=t,w.height=e;break;default:w.width=e,w.height=t}var r=w.getContext("2d");switch(n){case 2:r.translate(e,0),r.scale(-1,1);break;case 3:r.translate(e,t),r.rotate(Math.PI);break;case 4:r.translate(0,t),r.scale(1,-1);break;case 5:r.rotate(.5*Math.PI),r.scale(1,-1);break;case 6:r.rotate(.5*Math.PI),r.translate(0,-t);break;case 7:r.rotate(.5*Math.PI),r.translate(e,-t),r.scale(-1,1);break;case 8:r.rotate(-0.5*Math.PI),r.translate(-e,0)}}function m(){b&&(b.purge(),b=null),E=y=w=null,x=!1}var g=this,y,b,w,E,S,x=!1,T=!0;t.extend(this,{loadFromBlob:function(e){var t=this,r=t.getRuntime(),i=arguments.length>1?arguments[1]:!0;if(!r.can("access_binary"))throw new n.RuntimeError(n.RuntimeError.NOT_SUPPORTED_ERR);return e.isDetached()?(S={name:e.name,size:e.size,type:e.type},E=e.getSource(),c.call(this,E),void 0):(S=e.getSource(),h(S,function(e){i&&(E=f(e)),c.call(t,e)}),void 0)},loadFromImage:function(e,t){this.meta=e.meta,S={name:e.name,size:e.size,type:e.type},c.call(this,t?E=e.getAsBinaryString():e.getAsDataURL())},getInfo:function(){var t=this.getRuntime(),n;return!b&&E&&t.can("access_image_binary")&&(b=new s(E)),n={width:e().width||0,height:e().height||0,type:S.type||u.getFileMime(S.name),size:E&&E.length||S.size||0,name:S.name||"",meta:b&&b.meta||this.meta||{}}},downsize:function(){p.apply(this,arguments)},getAsCanvas:function(){return w&&(w.id=this.uid+"_canvas"),w},getAsBlob:function(e,t){return e!==this.type&&p.call(this,this.width,this.height,!1),new i(null,{type:e,data:g.getAsBinaryString.call(this,e,t)})},getAsDataURL:function(e){var t=arguments[1]||90;if(!x)return y.src;if("image/jpeg"!==e)return w.toDataURL("image/png");try{return w.toDataURL("image/jpeg",t/100)}catch(n){return w.toDataURL("image/jpeg")}},getAsBinaryString:function(e,t){if(!x)return E||(E=f(g.getAsDataURL(e,t))),E;if("image/jpeg"!==e)E=f(g.getAsDataURL(e,t));else{var n;t||(t=90);try{n=w.toDataURL("image/jpeg",t/100)}catch(r){n=w.toDataURL("image/jpeg")}E=f(n),b&&(E=b.stripHeaders(E),T&&(b.meta&&b.meta.exif&&b.setExif({PixelXDimension:this.width,PixelYDimension:this.height}),E=b.writeHeaders(E)),b.purge(),b=null)}return x=!1,E},destroy:function(){g=null,m.call(this),this.getRuntime().getShim().removeInstance(this.uid)}})}return e.Image=f}),r(V,[a,c,h,p,m],function(e,t,n,r,i){function s(s){function a(){var e;try{e=navigator.plugins["Shockwave Flash"],e=e.description}catch(t){try{e=(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")}catch(n){e="0.0"}}return e=e.match(/\d+/g),parseFloat(e[0]+"."+e[1])}var f=this,l;s=e.extend({swf_url:t.swf_url},s),i.call(this,s,o,{access_binary:function(e){return e&&"browser"===f.getMode()},access_image_binary:function(e){return e&&"browser"===f.getMode()},display_media:i.capTrue,do_cors:i.capTrue,drag_and_drop:!1,report_upload_progress:function(){return"client"===f.getMode()},resize_image:i.capTrue,return_response_headers:!1,return_response_type:function(t){return!e.arrayDiff(t,["","text","json","document"])||"browser"===f.getMode()},return_status_code:function(t){return"browser"===f.getMode()||!e.arrayDiff(t,[200,404])},select_multiple:i.capTrue,send_binary_string:function(e){return e&&"browser"===f.getMode()},send_browser_cookies:function(e){return e&&"browser"===f.getMode()},send_custom_headers:function(e){return e&&"browser"===f.getMode()},send_multipart:i.capTrue,slice_blob:i.capTrue,stream_upload:function(e){return e&&"browser"===f.getMode()},summon_file_dialog:!1,upload_filesize:function(t){return e.parseSizeStr(t)<=2097152||"client"===f.getMode()},use_http_method:function(t){return!e.arrayDiff(t,["GET","POST"])}},{access_binary:!1,access_image_binary:!1,return_response_type:function(t){return!e.arrayDiff(t,["","text","json","document"])},return_status_code:function(t){return!e.arrayDiff(t,[200,404])},send_binary_string:!1,send_browser_cookies:!1,send_custom_headers:!1,stream_upload:!0,upload_filesize:function(t){return e.parseSizeStr(t)>=2097152}},"client"),e.extend(this,{getShim:function(){return n.get(this.uid)},shimExec:function(e,t){var n=[].slice.call(arguments,2);return f.getShim().exec(this.uid,e,t,n)},init:function(){var n,i,o;return a()<10?(this.trigger("Error",new r.RuntimeError(r.RuntimeError.NOT_INIT_ERR)),void 0):(o=this.getShimContainer(),e.extend(o.style,{position:"absolute",top:"-8px",left:"-8px",width:"9px",height:"9px",overflow:"hidden"}),n='<object id="'+this.uid+'" type="application/x-shockwave-flash" data="'+s.swf_url+'" ',"IE"===t.browser&&(n+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" '),n+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+s.swf_url+'" />'+'<param name="flashvars" value="uid='+escape(this.uid)+"&target="+t.global_event_dispatcher+'" />'+'<param name="wmode" value="transparent" />'+'<param name="allowscriptaccess" value="always" />'+"</object>","IE"===t.browser?(i=document.createElement("div"),o.appendChild(i),i.outerHTML=n,i=o=null):o.innerHTML=n,l=setTimeout(function(){f&&!f.initialized&&f.trigger("Error",new r.RuntimeError(r.RuntimeError.NOT_INIT_ERR))},5e3),void 0)},destroy:function(e){return function(){e.call(f),clearTimeout(l),s=l=e=f=null}}(this.destroy)},u)}var o="flash",u={};return i.addConstructor(o,s),u}),r($,[V,y],function(e,t){var n={slice:function(e,n,r,i){var s=this.getRuntime();return 0>n?n=Math.max(e.size+n,0):n>0&&(n=Math.min(n,e.size)),0>r?r=Math.max(e.size+r,0):r>0&&(r=Math.min(r,e.size)),e=s.shimExec.call(this,"Blob","slice",n,r,i||""),e&&(e=new t(s.uid,e)),e}};return e.Blob=n}),r(J,[V],function(e){var t={init:function(e){this.getRuntime().shimExec.call(this,"FileInput","init",{name:e.name,accept:e.accept,multiple:e.multiple}),this.trigger("ready")}};return e.FileInput=t}),r(K,[V,v],function(e,t){function n(e,n){switch(n){case"readAsText":return t.atob(e,"utf8");case"readAsBinaryString":return t.atob(e);case"readAsDataURL":return e}return null}var r={read:function(e,t){var r=this,i=r.getRuntime();return"readAsDataURL"===e&&(r.result="data:"+(t.type||"")+";base64,"),r.bind("Progress",function(t,i){i&&(r.result+=n(i,e))},999),i.shimExec.call(this,"FileReader","readAsBase64",t.uid)}};return e.FileReader=r}),r(Q,[V,v],function(e,t){function n(e,n){switch(n){case"readAsText":return t.atob(e,"utf8");case"readAsBinaryString":return t.atob(e);case"readAsDataURL":return e}return null}var r={read:function(e,t){var r,i=this.getRuntime();return(r=i.shimExec.call(this,"FileReaderSync","readAsBase64",t.uid))?("readAsDataURL"===e&&(r="data:"+(t.type||"")+";base64,"+r),n(r,e,t.type)):null}};return e.FileReaderSync=r}),r(G,[V,a,y,b,N,C,L,A],function(e,t,n,r,i,s,o,u){var a={send:function(e,r){function i(){e.transport=l.getMode(),l.shimExec.call(f,"XMLHttpRequest","send",e,r)}function u(e,t){l.shimExec.call(f,"XMLHttpRequest","appendBlob",e,t.uid),r=null,i()}function a(e,t){var n=new o;n.bind("TransportingComplete",function(){u(e,this.result)}),n.transport(t.getSource(),t.type,{ruid:l.uid})}var f=this,l=f.getRuntime();if(t.isEmptyObj(e.headers)||t.each(e.headers,function(e,t){l.shimExec.call(f,"XMLHttpRequest","setRequestHeader",t,e.toString())}),r instanceof s){var c;if(r.each(function(e,t){e instanceof n?c=t:l.shimExec.call(f,"XMLHttpRequest","append",t,e)}),r.hasBlob()){var h=r.getBlob();h.isDetached()?a(c,h):u(c,h)}else r=null,i()}else r instanceof n?(l.shimExec.call(f,"XMLHttpRequest","setRequestHeader","Content-Type",r.type||"application/octet-stream"),r=r.uid,i()):i()},getResponse:function(e){var n,s,o=this.getRuntime();if(s=o.shimExec.call(this,"XMLHttpRequest","getResponseAsBlob")){if(s=new r(o.uid,s),"blob"===e)return s;if(~t.inArray(e,["","text"]))return n=new i,n.readAsText(s);if("arraybuffer"!==e&&"json"===e){n=new i;try{return u(n.readAsText(s))}catch(a){return null}}}return null},abort:function(e){var t=this.getRuntime();t.shimExec.call(this,"XMLHttpRequest","abort"),this.dispatchEvent("readystatechange"),this.dispatchEvent("abort")}};return e.XMLHttpRequest=a}),r(Y,[V,y],function(e,t){var n={getAsBlob:function(e){var n=this.getRuntime(),r=n.shimExec.call(this,"Transporter","getAsBlob",e);return r?new t(n.uid,r):null}};return e.Transporter=n}),r(Z,[V,a,L,y,N],function(e,t,n,r,i){var s={loadFromBlob:function(e){function t(e){i.shimExec.call(r,"Image","loadFromBlob",e.uid),r=i=null}var r=this,i=r.getRuntime();if(e.isDetached()){var s=new n;s.bind("TransportingComplete",function(){t(s.result.getSource())}),s.transport(e.getSource(),e.type,{ruid:i.uid})}else t(e.getSource())},loadFromImage:function(e){var t=this.getRuntime();return t.shimExec.call(this,"Image","loadFromImage",e.uid)},getAsBlob:function(e,t){var n=this.getRuntime(),i=n.shimExec.call(this,"Image","getAsBlob",e,t);return i?new r(n.uid,i):null},getAsDataURL:function(){var e=this.getRuntime(),t=e.Image.getAsBlob.apply(this,arguments),n;return t?(n=new i,n.readAsDataURL(t)):null}};return e.Image=s}),r(et,[a,c,h,p,m],function(e,t,n,r,i){function s(s){function a(e){var t=!1,n=null,r,i,s,o,u,a=0;try{try{n=new ActiveXObject("AgControl.AgControl"),n.IsVersionSupported(e)&&(t=!0),n=null}catch(f){var l=navigator.plugins["Silverlight Plug-In"];if(l){for(r=l.description,"1.0.30226.2"===r&&(r="2.0.30226.2"),i=r.split(".");i.length>3;)i.pop();for(;i.length<4;)i.push(0);for(s=e.split(".");s.length>4;)s.pop();do o=parseInt(s[a],10),u=parseInt(i[a],10),a++;while(a<s.length&&o===u);u>=o&&!isNaN(o)&&(t=!0)}}}catch(c){t=!1}return t}var f=this,l;s=e.extend({xap_url:t.xap_url},s),i.call(this,s,o,{access_binary:i.capTrue,access_image_binary:i.capTrue,display_media:i.capTrue,do_cors:i.capTrue,drag_and_drop:!1,report_upload_progress:i.capTrue,resize_image:i.capTrue,return_response_headers:function(e){return e&&"client"===f.getMode()},return_response_type:i.capTrue,return_status_code:function(t){return"client"===f.getMode()||!e.arrayDiff(t,[200,404])},select_multiple:i.capTrue,send_binary_string:i.capTrue,send_browser_cookies:function(e){return e&&"browser"===f.getMode()},send_custom_headers:function(e){return e&&"client"===f.getMode()},send_multipart:i.capTrue,slice_blob:i.capTrue,stream_upload:!0,summon_file_dialog:!1,upload_filesize:i.capTrue,use_http_method:function(t){return"client"===f.getMode()||!e.arrayDiff(t,["GET","POST"])}},{return_response_headers:!0,return_status_code:function(t){return e.arrayDiff(t,[200,404])},send_browser_cookies:!1,send_custom_headers:!0,use_http_method:function(t){return e.arrayDiff(t,["GET","POST"])}}),e.extend(this,{getShim:function(){return n.get(this.uid).content.Moxie},shimExec:function(e,t){var n=[].slice.call(arguments,2);return f.getShim().exec(this.uid,e,t,n)},init:function(){var e;return a("2.0.31005.0")&&"Opera"!==t.browser?(e=this.getShimContainer(),e.innerHTML='<object id="'+this.uid+'" data="data:application/x-silverlight," type="application/x-silverlight-2" width="100%" height="100%" style="outline:none;">'+'<param name="source" value="'+s.xap_url+'"/>'+'<param name="background" value="Transparent"/>'+'<param name="windowless" value="true"/>'+'<param name="enablehtmlaccess" value="true"/>'+'<param name="initParams" value="uid='+this.uid+",target="+t.global_event_dispatcher+'"/>'+"</object>",l=setTimeout(function(){f&&!f.initialized&&f.trigger("Error",new r.RuntimeError(r.RuntimeError.NOT_INIT_ERR))},"Windows"!==t.OS?1e4:5e3),void 0):(this.trigger("Error",new r.RuntimeError(r.RuntimeError.NOT_INIT_ERR)),void 0)},destroy:function(e){return function(){e.call(f),clearTimeout(l),s=l=e=f=null}}(this.destroy)},u)}var o="silverlight",u={};return i.addConstructor(o,s),u}),r(tt,[et,a,$],function(e,t,n){return e.Blob=t.extend({},n)}),r(nt,[et],function(e){var t={init:function(e){function t(e){for(var t="",n=0;n<e.length;n++)t+=(""!==t?"|":"")+e[n].title+" | *."+e[n].extensions.replace(/,/g,";*.");return t}this.getRuntime().shimExec.call(this,"FileInput","init",t(e.accept),e.name,e.multiple),this.trigger("ready")}};return e.FileInput=t}),r(rt,[et,h,D],function(e,t,n){var r={init:function(){var e=this,r=e.getRuntime(),i;return i=r.getShimContainer(),n.addEvent(i,"dragover",function(e){e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="copy"},e.uid),n.addEvent(i,"dragenter",function(e){e.preventDefault();var n=t.get(r.uid).dragEnter(e);n&&e.stopPropagation()},e.uid),n.addEvent(i,"drop",function(e){e.preventDefault();var n=t.get(r.uid).dragDrop(e);n&&e.stopPropagation()},e.uid),r.shimExec.call(this,"FileDrop","init")}};return e.FileDrop=r}),r(it,[et,a,K],function(e,t,n){return e.FileReader=t.extend({},n)}),r(st,[et,a,Q],function(e,t,n){return e.FileReaderSync=t.extend({},n)}),r(ot,[et,a,G],function(e,t,n){return e.XMLHttpRequest=t.extend({},n)}),r(ut,[et,a,Y],function(e,t,n){return e.Transporter=t.extend({},n)}),r(at,[et,a,Z],function(e,t,n){return e.Image=t.extend({},n)}),r(ft,[a,p,m,c],function(e,t,n,r){function i(i){var u=this,a=n.capTest,f=n.capTrue;n.call(this,i,s,{access_binary:a(window.FileReader||window.File&&File.getAsDataURL),access_image_binary:!1,display_media:a(o.Image&&(r.can("create_canvas")||r.can("use_data_uri_over32kb"))),do_cors:!1,drag_and_drop:!1,resize_image:function(){return o.Image&&u.can("access_binary")&&r.can("create_canvas")},report_upload_progress:!1,return_response_headers:!1,return_response_type:function(t){return!!~e.inArray(t,["json","text","document",""])},return_status_code:function(t){return!e.arrayDiff(t,[200,404])},select_multiple:!1,send_binary_string:!1,send_custom_headers:!1,send_multipart:!0,slice_blob:!1,stream_upload:!0,summon_file_dialog:a(function(){return"Firefox"===r.browser&&r.version>=4||"Opera"===r.browser&&r.version>=12||"IE"===r.browser&&r.version>=10||!!~e.inArray(r.browser,["Chrome","Safari"])}()),upload_filesize:f,use_http_method:function(t){return!e.arrayDiff(t,["GET","POST"])}}),e.extend(this,{init:function(){return r.can("use_fileinput")?(this.trigger("Init"),void 0):(this.trigger("Error",new t.RuntimeError(t.RuntimeError.NOT_INIT_ERR)),void 0)},destroy:function(e){return function(){e.call(u),e=u=null}}(this.destroy)}),e.extend(this.getShim(),o)}var s="html4",o={};return n.addConstructor(s,i),o}),r(lt,[ft,a,h,D,l,c],function(e,t,n,r,i,s){function o(){function e(){var i=this,l=i.getRuntime(),c,h,p,d,v,m;m=t.guid("uid_"),c=l.getShimContainer(),o&&(p=n.get(o+"_form"),p&&t.extend(p.style,{top:"100%"})),d=document.createElement("form"),d.setAttribute("id",m+"_form"),d.setAttribute("method","post"),d.setAttribute("enctype","multipart/form-data"),d.setAttribute("encoding","multipart/form-data"),t.extend(d.style,{overflow:"hidden",position:"absolute",top:0,left:0,width:"100%",height:"100%"}),v=document.createElement("input"),v.setAttribute("id",m),v.setAttribute("type","file"),v.setAttribute("name","Filedata"),v.setAttribute("accept",a.join(",")),t.extend(v.style,{fontSize:"999px",opacity:0}),d.appendChild(v),c.appendChild(d),t.extend(v.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"}),"IE"===s.browser&&s.version<10&&t.extend(v.style,{filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=0)"}),v.onchange=function(){var t;this.value&&(t=this.files?this.files[0]:{name:this.value},u=[t],this.onchange=function(){},e.call(i),i.bind("change",function(){var e=n.get(m),t=n.get(m+"_form"),r;i.files.length&&e&&t&&(r=i.files[0],e.setAttribute("id",r.uid),t.setAttribute("id",r.uid+"_form"),t.setAttribute("target",r.uid+"_iframe")),e=t=null},998),v=d=null,i.trigger("change"))},l.can("summon_file_dialog")&&(h=n.get(f.browse_button),r.removeEvent(h,"click",i.uid),r.addEvent(h,"click",function(e){v&&!v.disabled&&v.click(),e.preventDefault()},i.uid)),o=m,c=p=h=null,i.trigger({type:"ready",async:!0})}var o,u=[],a=[],f;t.extend(this,{init:function(t){var s=this,o=s.getRuntime(),u;f=t,a=t.accept.mimes||i.extList2mimes(t.accept),u=o.getShimContainer(),function(){var e,i,a;e=n.get(t.browse_button),o.can("summon_file_dialog")&&("static"===n.getStyle(e,"position")&&(e.style.position="relative"),i=parseInt(n.getStyle(e,"z-index"),10)||1,e.style.zIndex=i,u.style.zIndex=i-1),a=o.can("summon_file_dialog")?e:u,r.addEvent(a,"mouseover",function(){s.trigger("mouseenter")},s.uid),r.addEvent(a,"mouseout",function(){s.trigger("mouseleave")},s.uid),r.addEvent(a,"mousedown",function(){s.trigger("mousedown")},s.uid),r.addEvent(n.get(t.container),"mouseup",function(){s.trigger("mouseup")},s.uid),e=null}(),e.call(this),u=null},getFiles:function(){return u},disable:function(e){var t;(t=n.get(o))&&(t.disabled=!!e)},destroy:function(){var e=this.getRuntime(),t=e.getShimContainer();r.removeAllEvents(t,this.uid),r.removeAllEvents(f&&n.get(f.container),this.uid),r.removeAllEvents(f&&n.get(f.browse_button),this.uid),t&&(t.innerHTML=""),o=u=a=f=null}})}return e.FileInput=o}),r(ct,[ft,B],function(e,t){return e.FileReader=t}),r(ht,[ft,a,h,x,p,D,y,C,A],function(e,t,n,r,i,s,o,u,a){function f(){function e(e){var t=this,r,i,o,u,a=!1;if(c){if(r=c.id.replace(/_iframe$/,""),i=n.get(r+"_form")){for(o=i.getElementsByTagName("input"),u=o.length;u--;)switch(o[u].getAttribute("type")){case"hidden":o[u].parentNode.removeChild(o[u]);break;case"file":a=!0}o=[],a||i.parentNode.removeChild(i),i=null}setTimeout(function(){s.removeEvent(c,"load",t.uid),c.parentNode&&c.parentNode.removeChild(c);var n=t.getRuntime().getShimContainer();n.children.length||n.parentNode.removeChild(n),n=c=null,e()},1)}}var f,l,c;t.extend(this,{send:function(a,h){function p(){var n=v.getShimContainer()||document.body,i=document.createElement("div");i.innerHTML='<iframe id="'+m+'_iframe" name="'+m+'_iframe" src="javascript:&quot;&quot;" style="display:none"></iframe>',c=i.firstChild,n.appendChild(c),s.addEvent(c,"load",function(){var n;try{n=c.contentWindow.document||c.contentDocument||window.frames[c.id].document,/^4\d{2}\s/.test(n.title)&&n.getElementsByTagName("address").length?f=n.title.replace(/^(\d+).*$/,"$1"):(f=200,l=t.trim(n.body.innerHTML),d.trigger({type:"progress",loaded:l.length,total:l.length}),b&&d.trigger({type:"uploadprogress",loaded:b.size||1025,total:b.size||1025}))}catch(i){if(!r.hasSameOrigin(a.url))return e.call(d,function(){d.trigger("error")}),void 0;f=404}e.call(d,function(){d.trigger("load")})},d.uid)}var d=this,v=d.getRuntime(),m,g,y,b;if(f=l=null,h instanceof u&&h.hasBlob()){if(b=h.getBlob(),m=b.uid,y=n.get(m),g=n.get(m+"_form"),!g)throw new i.DOMException(i.DOMException.NOT_FOUND_ERR)}else m=t.guid("uid_"),g=document.createElement("form"),g.setAttribute("id",m+"_form"),g.setAttribute("method",a.method),g.setAttribute("enctype","multipart/form-data"),g.setAttribute("encoding","multipart/form-data"),g.setAttribute("target",m+"_iframe"),v.getShimContainer().appendChild(g);h instanceof u&&h.each(function(e,n){if(e instanceof o)y&&y.setAttribute("name",n);else{var r=document.createElement("input");t.extend(r,{type:"hidden",name:n,value:e}),g.appendChild(r)}}),g.setAttribute("action",a.url),p(),g.submit(),d.trigger("loadstart")},getStatus:function(){return f},getResponse:function(e){if("json"===e&&"string"===t.typeOf(l))try{return a(l.replace(/^\s*<pre[^>]*>/,"").replace(/<\/pre>\s*$/,""))}catch(n){return null}return l},abort:function(){var t=this;c&&c.contentWindow&&(c.contentWindow.stop?c.contentWindow.stop():c.contentWindow.document.execCommand?c.contentWindow.document.execCommand("Stop"):c.src="about:blank"),e.call(this,function(){t.dispatchEvent("abort")})}})}return e.XMLHttpRequest=f}),r(pt,[ft,X],function(e,t){return e.Image=t}),o([a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,D])}(this);(function(){"use strict";var e={},t=moxie.core.utils.Basic.inArray;return function n(r){var i,s;for(i in r)s=typeof r[i],s==="object"&&!~t(i,["Exceptions","Env","Mime"])?n(r[i]):s==="function"&&(e[i]=r[i])}(window.moxie),e.Env=window.moxie.core.utils.Env,e.Mime=window.moxie.core.utils.Mime,e.Exceptions=window.moxie.core.Exceptions,window.mOxie=e,window.o||(window.o=e),e})();(function(e,t,n){function r(e){function t(e,t,n){var i={chunks:"slice_blob",resize:"send_binary_string",jpgresize:"send_binary_string",pngresize:"send_binary_string",progress:"report_upload_progress",multi_selection:"select_multiple",canSendBinary:"send_binary"};i[e]?r[i[e]]=t:n||(r[e]=t)}var n=e.required_features,r={};return typeof n=="string"?s.each(n.split(/\s*,\s*/),function(e){t(e,!0)}):typeof n=="object"&&s.each(n,function(e,n){t(n,e)}),e.multipart||(r.send_binary_string=!0),e.chunks.size||delete e.chunks,s.each(e,function(e,n){t(n,!!e,!0)}),r}var i=e.setTimeout,s={VERSION:"2.0a",STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,FILE_DUPLICATE_ERROR:-602,IMAGE_FORMAT_ERROR:-700,IMAGE_MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,mimeTypes:t.mimes,ua:t.ua,typeOf:t.typeOf,extend:t.extend,guid:t.guid,each:t.each,getPos:t.getPos,getSize:t.getSize,xmlEncode:function(e){var t={"<":"lt",">":"gt","&":"amp",'"':"quot","'":"#39"},n=/[<>&\"\']/g;return e?(""+e).replace(n,function(e){return t[e]?"&"+t[e]+";":e}):e},toArray:t.toArray,inArray:t.inArray,addI18n:t.addI18n,translate:t.translate,isEmptyObj:t.isEmptyObj,hasClass:t.hasClass,addClass:t.addClass,removeClass:t.removeClass,getStyle:t.getStyle,addEvent:t.addEvent,removeEvent:t.removeEvent,removeAllEvents:t.removeAllEvents,cleanName:function(e){var t,n;n=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,"O",/[\362-\370]/g,"o",/[\331-\334]/g,"U",/[\371-\374]/g,"u"];for(t=0;t<n.length;t+=2)e=e.replace(n[t],n[t+1]);return e=e.replace(/\s+/g,"_"),e=e.replace(/[^a-z0-9_\-\.]+/gi,""),e},buildUrl:function(e,t){var n="";return s.each(t,function(e,t){n+=(n?"&":"")+encodeURIComponent(t)+"="+encodeURIComponent(e)}),n&&(e+=(e.indexOf("?")>0?"&":"?")+n),e},formatSize:function(e){return e===n||/\D/.test(e)?s.translate("N/A"):e>1099511627776?Math.round(e/1099511627776,1)+" "+s.translate("tb"):e>1073741824?Math.round(e/1073741824,1)+" "+s.translate("gb"):e>1048576?Math.round(e/1048576,1)+" "+s.translate("mb"):e>1024?Math.round(e/1024,1)+" "+s.translate("kb"):e+" "+s.translate("b")},parseSize:t.parseSizeStr,predictRuntime:function(e){return t.Runtime.thatCan(r(s.extend({},e)))}};s.Uploader=function(e){function o(){var e,t=0,n;if(this.state==s.STARTED){for(n=0;n<p.length;n++)!e&&p[n].status==s.QUEUED?(e=p[n],this.trigger("BeforeUpload",e)&&(e.status=s.UPLOADING,this.trigger("UploadFile",e))):t++;t==p.length&&(this.state!==s.STOPPED&&(this.state=s.STOPPED,this.trigger("StateChanged")),this.trigger("UploadComplete",p))}}function u(e){e.percent=e.size>0?Math.ceil(e.loaded/e.size*100):100,a()}function a(){var e,t;g.reset();for(e=0;e<p.length;e++)t=p[e],t.size!==n?(g.size+=t.origSize,g.loaded+=t.loaded*t.origSize/t.size):g.size=n,t.status==s.DONE?g.uploaded++:t.status==s.FAILED?g.failed++:g.queued++;g.size===n?g.percent=p.length>0?Math.ceil(g.uploaded/p.length*100):0:(g.bytesPerSec=Math.ceil(g.loaded/((+(new Date)-m||1)/1e3)),g.percent=g.size>0?Math.ceil(g.loaded/g.size*100):0)}function f(e){var t,n=[];for(t=0;t<e.length;t++)n.push(new s.File(e[t]));n.length&&this.trigger("FilesAdded",n)}function l(){var n=this,r=0,i={accept:e.filters,runtime_order:e.runtimes,required_caps:v,swf_url:e.flash_swf_url,xap_url:e.silverlight_xap_url};s.each(e.runtimes.split(/\s*,\s*/),function(t){e[t]&&(i[t]=e[t])}),t.inSeries([function(o){e.browse_button?(b=new t.FileInput(s.extend({},i,{name:e.file_data_name,multiple:e.multi_selection,container:e.container,browse_button:e.browse_button})),b.onready=function(){var e=t.Runtime.getInfo(this.ruid);t.extend(n.features,{chunks:e.can("slice_blob"),multipart:e.can("send_multipart"),multi_selection:e.can("select_multiple")}),r++,o()},b.onchange=function(){f.call(n,this.files)},b.bind("mouseenter mouseleave mousedown mouseup",function(n){if(!y){var r=t.get(e.browse_button);r&&(e.browse_button_hover&&("mouseenter"===n.type?t.addClass(r,e.browse_button_hover):"mouseleave"===n.type&&t.removeClass(r,e.browse_button_hover)),e.browse_button_active&&("mousedown"===n.type?t.addClass(r,e.browse_button_active):"mouseup"===n.type&&t.removeClass(r,e.browse_button_active)),r=null)}}),b.bind("error runtimeerror",function(){o()}),b.init()):o()},function(o){e.drop_element?(w=new t.FileDrop(s.extend({},i,{drop_zone:e.drop_element})),w.onready=function(){var e=t.Runtime.getInfo(this.ruid);n.features.dragdrop=e.can("drag_and_drop"),r++,o()},w.ondrop=function(){f.call(n,this.files)},w.bind("error runtimeerror",function(){o()}),w.init()):o()}],function(){r?(n.trigger("PostInit"),typeof e.init=="function"?e.init(n):s.each(e.init,function(e,t){n.bind(t,e)})):n.trigger("Error",{code:s.INIT_ERROR,message:s.translate("Init error.")})})}function c(e,n){if(e.ruid){var r=t.Runtime.getInfo(e.ruid);if(r)return r.can(n)}return!1}function h(e,n,r){var i=new t.Image;try{i.onload=function(){i.downsize(n.width,n.height,n.crop,n.preserve_headers)},i.onresize=function(){r(this.getAsBlob(e.type,n.quality)),this.destroy()},i.onerror=function(){r(e)},i.load(e)}catch(s){r(e)}}var p=[],d={},v={},m,g,y=!1,b,w,E;g=new s.QueueProgress,e=s.extend({max_retries:0,multipart:!0,multi_selection:!0,file_data_name:"file",filters:[],prevent_duplicates:!1},e),e.resize&&(e.resize=s.extend({preserve_headers:!0,crop:!1},e.resize)),e.chunks=s.extend({size:e.chunk_size||0,send_chunk_number:!1},e.chunks),v=r(s.extend({},e)),s.extend(this,{id:s.guid(),state:s.STOPPED,features:{},files:p,settings:e,total:g,init:function(){var r=this;e.chunks.size=s.parseSize(e.chunks.size),e.max_file_size=s.parseSize(e.max_file_size),e.drop_element=t.get(e.drop_element),typeof e.preinit=="function"?e.preinit(r):s.each(e.preinit,function(e,t){r.bind(t,e)}),r.bind("FilesAdded",function(t,o){var u,a,f,l=0,c,h=e.filters;h&&h.length&&(c=[],s.each(h,function(e){s.each(e.extensions.split(/,/),function(e){/^\s*\*\s*$/.test(e)?c.push("\\.*"):c.push("\\."+e.replace(new RegExp("["+"/^$.*+?|()[]{}\\".replace(/./g,"\\$&")+"]","g"),"\\$&"))})}),c=new RegExp("("+c.join("|")+")$","i"));e:for(u=0;u<o.length;u++){f=o[u],f.loaded=0,f.percent=0,f.status=s.QUEUED;if(c&&!c.test(f.name)){t.trigger("Error",{code:s.FILE_EXTENSION_ERROR,message:s.translate("File extension error."),file:f});continue}if(f.size!==n&&f.size>e.max_file_size){t.trigger("Error",{code:s.FILE_SIZE_ERROR,message:s.translate("File size error."),file:f});continue}if(e.prevent_duplicates){a=t.files.length;while(a--)if(f.name===t.files[a].name&&f.size===t.files[a].size){t.trigger("Error",{code:s.FILE_DUPLICATE_ERROR,message:s.translate("Duplicate file error."),file:f});continue e}}p.push(f),l++}if(!l)return!1;i(function(){r.trigger("QueueChanged"),r.refresh()},1)}),r.bind("CancelUpload",function(){E&&E.abort()}),e.unique_names&&r.bind("UploadFile",function(e,t){var n=t.name.match(/\.([^.]+)$/),r="part";n&&(r=n[1]),t.target_name=t.id+"."+r}),r.bind("UploadFile",function(n,r){function o(){p-->0?i(u,1):(r.loaded=m,n.trigger("Error",{code:s.HTTP_ERROR,message:s.translate("HTTP Error."),file:r,status:E.status}))}function u(){var c,h,p,g;if(r.status==s.DONE||r.status==s.FAILED||n.state==s.STOPPED)return;p={name:r.target_name||r.name},l&&f.chunks&&d.size>l?(g=Math.min(l,d.size-m),c=d.slice(m,m+g),e.chunks.send_chunk_number?(p.chunk=Math.ceil(m/l),p.chunks=Math.ceil(d.size/l)):(p.offset=m,p.total=d.size)):(g=d.size,c=d),E=new t.XMLHttpRequest,E.upload&&(E.upload.onprogress=function(e){r.loaded=Math.min(r.size,m+e.loaded),n.trigger("UploadProgress",r)}),E.onload=function(){if(E.status>=400){o();return}g<d.size?(c.destroy(),m+=g,r.loaded=Math.min(m,d.size),n.trigger("ChunkUploaded",r,{offset:r.loaded,total:d.size,response:E.responseText,status:E.status})):r.loaded=r.size,n.trigger("UploadProgress",r),c=h=null,!m||m>=d.size?(r.size!=r.origSize&&(d.destroy(),d=null),r.status=s.DONE,n.trigger("FileUploaded",r,{response:E.responseText,status:E.status})):i(u,1)},E.onerror=function(){o()},E.onloadend=function(){this.destroy(),E=null},n.settings.multipart&&f.multipart?(p.name=r.target_name||r.name,E.open("post",a,!0),s.each(n.settings.headers,function(e,t){E.setRequestHeader(t,e)}),h=new t.FormData,s.each(s.extend(p,n.settings.multipart_params),function(e,t){h.append(t,e)}),h.append(n.settings.file_data_name,c),E.send(h,{runtime_order:n.settings.runtimes,required_caps:v,swf_url:n.settings.flash_swf_url,xap_url:n.settings.silverlight_xap_url})):(a=s.buildUrl(n.settings.url,s.extend(p,n.settings.multipart_params)),E.open("post",a,!0),E.setRequestHeader("Content-Type","application/octet-stream"),s.each(n.settings.headers,function(e,t){E.setRequestHeader(t,e)}),E.send(c,{runtime_order:n.settings.runtimes,required_caps:v,swf_url:n.settings.flash_swf_url,xap_url:n.settings.silverlight_xap_url}))}var a=n.settings.url,f=n.features,l=e.chunks.size,p=e.max_retries,d,m=0;r.loaded&&(m=r.loaded=l*Math.floor(r.loaded/l)),d=r.getSource(),!t.isEmptyObj(n.settings.resize)&&c(d,"send_binary_string")&&!!~t.inArray(d.type,["image/jpeg","image/png"])?h.call(this,d,n.settings.resize,function(e){d=e,r.size=e.size,u()}):u()}),r.bind("UploadProgress",function(e,t){u(t)}),r.bind("StateChanged",function(e){if(e.state==s.STARTED)m=+(new Date);else if(e.state==s.STOPPED)for(var t=e.files.length-1;t>=0;t--)e.files[t].status==s.UPLOADING&&(e.files[t].status=s.QUEUED,a())}),r.bind("QueueChanged",a),r.bind("Error",function(e,t){t.file&&(t.file.status=s.FAILED,u(t.file),e.state==s.STARTED&&i(function(){o.call(r)},1))}),r.bind("FileUploaded",function(e,t){t.status=s.DONE,t.loaded=t.size,u(t),i(function(){o.call(r)},1)}),r.trigger("Init",{runtime:"Generic"}),l.call(this)},refresh:function(){b.trigger("Refresh"),this.trigger("Refresh")},start:function(){this.state!=s.STARTED&&(this.state=s.STARTED,this.trigger("StateChanged"),o.call(this))},stop:function(){this.state!=s.STOPPED&&(this.state=s.STOPPED,this.trigger("StateChanged"),this.trigger("CancelUpload"))},disableBrowse:function(){y=arguments[0]!==n?arguments[0]:!0,b&&b.disable(y),this.trigger("DisableBrowse",y)},getFile:function(e){var t;for(t=p.length-1;t>=0;t--)if(p[t].id===e)return p[t]},addFile:function(e){function n(e){var u=t.typeOf(e);if(e instanceof t.Blob)i.push(e);else if(e instanceof s.File)i.push(e.getSource());else{if(u==="file"){o.push(function(i){var o=new t.RuntimeTarget;o.bind("RuntimeInit",function(r,s){n(new t.File(s.uid,e)),i()});try{o.connectRuntime({runtime_order:"html5"})}catch(u){r.trigger("Error",{code:s.FILE_EXTENSION_ERROR,message:s.translate("File extension error."),file:e}),i()}});return}u==="node"&&t.typeOf(e.files)==="filelist"?t.each(e.files,n):u==="array"&&t.each(e,n)}}var r=this,i=[],o=[];n(e),t.inSeries(o,function(){f.call(r,i)})},removeFile:function(e){for(var t=p.length-1;t>=0;t--)if(p[t].id===e.id)return this.splice(t,1)[0]},splice:function(e,t){var r=p.splice(e===n?0:e,t===n?p.length:t);return this.trigger("FilesRemoved",r),this.trigger("QueueChanged"),s.each(r,function(e){e.destroy()}),r},trigger:function(e){var t=d[e.toLowerCase()],n,r;if(t){r=Array.prototype.slice.call(arguments),r[0]=this;for(n=0;n<t.length;n++)if(t[n].func.apply(t[n].scope,r)===!1)return!1}return!0},hasEventListener:function(e){return!!d[e.toLowerCase()]},bind:function(e,t,n){var r;e=e.toLowerCase(),r=d[e]||[],r.push({func:t,scope:n||this}),d[e]=r},unbind:function(e){e=e.toLowerCase();var t=d[e],r,i=arguments[1];if(t){if(i!==n){for(r=t.length-1
;r>=0;r--)if(t[r].func===i){t.splice(r,1);break}}else t=[];t.length||delete d[e]}},unbindAll:function(){var e=this;s.each(d,function(t,n){e.unbind(n)})},destroy:function(){this.stop(),b&&b.destroy(),w&&w.destroy(),this.trigger("Destroy"),this.unbindAll()}})},s.File=function(){function e(e){s.extend(this,{id:s.guid(),name:e.name||e.fileName,type:e.type||"",size:e.size||e.fileSize,origSize:e.size||e.fileSize,loaded:0,percent:0,status:0,getNative:function(){var e=this.getSource().getSource();return t.inArray(t.typeOf(e),["blob","file"])!==-1?e:null},getSource:function(){return n[this.id]?n[this.id]:null},destroy:function(){var e=this.getSource();e&&(e.destroy(),delete n[this.id])}}),n[this.id]=e}var n={};return e}(),s.QueueProgress=function(){var e=this;e.size=0,e.loaded=0,e.uploaded=0,e.failed=0,e.queued=0,e.percent=0,e.bytesPerSec=0,e.reset=function(){e.size=e.loaded=e.uploaded=e.failed=e.queued=e.percent=e.bytesPerSec=0}},e.plupload=s})(window,mOxie);